<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curse of Strahd: Shadows of Barovia</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Crimson+Text:ital,wght@0,400;0,700;1,400&family=IM+Fell+English:ital@0;1&display=swap');
        @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css');
    
    :root {
        --background-main: #ffffff;
        --background-dark: #f0f0f0;
        --box-bg: #f8f8f8;
        --border-color: #8b0000;
        --border-light: #d4af37;
        --title-color: #8b0000;
        --subtitle-color: #5c5c5c;
        --text-color: #333333;
        --accent-gold: #d4af37;
        --font-header: 'Cinzel Decorative', serif;
        --font-main: 'Crimson Text', serif;
        --font-accent: 'IM Fell English', serif;
        --shadow-dark: 0 4px 8px rgba(0, 0, 0, 0.3);
        --shadow-light: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
        
        body {
            background-color: var(--background-main);
            font-family: var(--font-main);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background-image: url('https://www.transparenttextures.com/patterns/black-paper.png');
            background-blend-mode: multiply;
            background-opacity: 0.03;
        }
        
        .container {
            background-color: var(--background-main);
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            box-shadow: var(--shadow-dark);
        }
        
        .header-container {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 20px;
            position: relative;
        }
        
        .logo-container {
            max-width: 500px;
            margin: 0 auto 20px;
            padding: 20px;
        }
        
        .logo-container img {
            max-width: 100%;
            height: auto;
            filter: drop-shadow(0 0 5px rgba(139, 0, 0, 0.3));
        }
        
        .page-title {
            font-family: var(--font-header);
            color: var(--title-color);
            font-size: 42px;
            font-weight: bold;
            margin: 10px 0 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            letter-spacing: 1px;
        }
        
        .page-subtitle {
            font-family: var(--font-accent);
            color: var(--subtitle-color);
            font-size: 24px;
            font-style: italic;
            margin: 0 0 20px;
        }
        
        .divider {
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--border-color), transparent);
            margin: 30px auto;
            width: 80%;
            border: none;
        }
        
        .divider-thin {
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border-light), transparent);
            margin: 20px auto;
            width: 60%;
            border: none;
        }
        
        .section-title {
    font-family: var(--font-header);
    color: var(--title-color);
    font-size: 22px;
    font-weight: bold;
    margin-top: 40px;
    margin-bottom: 20px;
    padding: 10px 15px;
    background: linear-gradient(90deg, rgba(139,0,0,0.1) 0%, rgba(212,175,55,0.05) 100%);
    border-left: 4px solid var(--border-color);
    position: relative;
    letter-spacing: 0.5px;
    cursor: pointer;
    transition: all 0.3s ease;
    border-radius: 0 4px 4px 0;
    box-shadow: var(--shadow-light);
}

.section-title:hover {
    color: #6b0000;
    background: linear-gradient(90deg, rgba(139,0,0,0.15) 0%, rgba(212,175,55,0.08) 100%);
}
        
.section-title:after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 1px;
    background: linear-gradient(90deg, var(--border-color), var(--border-light), transparent);
    opacity: 0.5;
}
        
        .row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -15px;
        }
        
        .col {
            flex: 1;
            padding: 0 15px;
            min-width: 300px;
            margin-bottom: 30px;
        }
        
        .box {
            background-color: var(--box-bg);
            border-left: 4px solid var(--border-color);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-light);
            position: relative;
            transition: all 0.3s ease;
        }
        
        .box:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .box:before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(212,175,55,0.05) 0%, rgba(139,0,0,0.05) 100%);
            pointer-events: none;
        }
        
        .box-title {
            font-family: var(--font-header);
            color: var(--title-color);
            font-size: 20px;
            font-weight: bold;
            margin-top: 0;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-light);
            padding-bottom: 8px;
            letter-spacing: 0.5px;
        }
        
        .box-subtitle {
            font-family: var(--font-header);
            color: var(--title-color);
            font-weight: bold;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .box-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px dotted #ddd;
        }
        
        .box-row:last-child {
            border-bottom: none;
        }
        
        ul, ol {
            padding-left: 25px;
            margin: 15px 0;
        }
        
        ul {
            list-style-type: none;
        }
        
        li {
            margin-bottom: 12px;
            position: relative;
            line-height: 1.5;
        }
        
        ul li::before {
            content: "‚ùñ";
            position: absolute;
            left: -20px;
            color: var(--border-color);
            font-size: 12px;
            top: 5px;
        }
        
        ol {
            counter-reset: item;
        }
        
        ol li {
            counter-increment: item;
            margin-bottom: 15px;
            padding-left: 25px;
        }
        
        ol li::before {
            content: counter(item) ".";
            position: absolute;
            left: 0;
            color: var(--border-color);
            font-weight: bold;
            font-family: var(--font-header);
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            color: var(--title-color);
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-light);
            padding-bottom: 8px;
            font-family: var(--font-header);
        }
        
        .table-col-1 {
            flex: 2;
        }
        
        .table-col-2, .table-col-3 {
            flex: 1;
            text-align: center;
        }
        
        table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            color: var(--title-color);
            font-family: var(--font-header);
            font-weight: bold;
            background-color: rgba(139, 0, 0, 0.05);
        }
        
        tr:hover {
            background-color: rgba(212, 175, 55, 0.05);
        }
        
        p {
            margin-bottom: 16px;
        }
        
        em {
            font-style: italic;
            color: var(--subtitle-color);
        }
        
        strong {
            color: var(--title-color);
            font-weight: bold;
        }
        
        a.nav-link {
            color: var(--title-color);
            text-decoration: none;
            padding: 8px 15px;
            border: 1px solid var(--border-light);
            border-radius: 3px;
            margin: 0 5px;
            transition: all 0.3s ease;
            font-family: var(--font-header);
            font-size: 14px;
            display: inline-block;
            background-color: rgba(212, 175, 55, 0.1);
        }
        
        a.nav-link:hover {
            background-color: var(--border-color);
            color: white;
            border-color: var(--border-color);
        }
        
        .quick-nav {
            margin-bottom: 30px;
            text-align: center;
            padding: 20px;
            background-color: var(--box-bg);
            border: 1px solid #eee;
            border-left: 4px solid var(--border-color);
        }
        
        .quick-nav h3 {
            margin-top: 0;
            color: var(--title-color);
            font-family: var(--font-header);
        }
        
        .nav-links {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        
        /* Tab System */
        .tab-system {
            margin: 30px 0;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid var(--border-light);
            margin-bottom: 20px;
        }
        
        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-family: var(--font-header);
            color: var(--title-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-button:hover {
            color: #6b0000;
        }
        
        .tab-button.active {
            border-bottom: 3px solid var(--border-color);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Tooltip System */
        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted var(--border-color);
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--title-color);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-family: var(--font-main);
            font-size: 14px;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Collapsible Sections */
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        /* Search System */
        .search-container {
            margin: 20px 0;
            text-align: center;
        }
        
        #search-input {
            padding: 10px 15px;
            width: 60%;
            border: 1px solid var(--border-light);
            border-radius: 3px;
            font-family: var(--font-main);
        }
        
        .highlight {
            background-color: rgba(212, 175, 55, 0.3);
        }
        
        /* Quick Roll Buttons */
        .roll-button {
            background-color: var(--border-color);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-family: var(--font-header);
            font-size: 12px;
            margin-left: 10px;
            transition: all 0.3s ease;
        }
        
        .roll-button:hover {
            background-color: #6b0000;
        }
        
        /* Dark Mode Toggle */
        .dark-mode-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--border-color);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow-dark);
            z-index: 1000;
        }
        
        /* Dark Mode Styles */
        body.dark-mode {
            --background-main: #1a1a1a;
            --background-dark: #0d0d0d;
            --box-bg: #262626;
            --border-color: #a30000;
            --border-light: #d4af37;
            --title-color: #d4af37;
            --subtitle-color: #a3a3a3;
            --text-color: #e6e6e6;
            background-image: url('https://www.transparenttextures.com/patterns/dark-wood.png');
        }
        
        body.dark-mode .box {
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }
        
        body.dark-mode th {
            background-color: rgba(163, 0, 0, 0.1);
        }
        
        @media (max-width: 768px) {
            .col {
                flex: 100%;
            }
            
            .box-row {
                flex-direction: column;
            }
            
            .table-header, .box-row {
                font-size: 14px;
            }
            
            .box {
                padding: 20px;
            }
            
            .page-title {
                font-size: 32px;
            }
            
            .page-subtitle {
                font-size: 20px;
            }
            
            .section-title {
                font-size: 24px;
            }
            
            #search-input {
                width: 80%;
            }
        }
        
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #6b0000;
        }
        
        body.dark-mode ::-webkit-scrollbar-track {
            background: #262626;
        }
        
        body.dark-mode ::-webkit-scrollbar-thumb {
            background: #a30000;
        }
        
        body.dark-mode ::-webkit-scrollbar-thumb:hover {
            background: #8b0000;
        }

	/* Collapsible Section Styles */
.collapsible {
    position: relative;
    cursor: pointer;
    padding-left: 25px;
}

.collapsible::before {
    content: "+";
    position: absolute;
    left: 0;
    color: var(--border-color);
    font-weight: bold;
    font-size: 1.2em;
    transition: transform 0.3s ease;
}

.collapsible.active::before {
    content: "-";
    transform: rotate(0deg);
}

.collapsible-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
    margin-left: 15px;
    border-left: 2px solid var(--border-light);
    padding-left: 10px;
}

/* Add some margin to section titles for better spacing */
.section-title {
    margin-bottom: 15px !important;
}

/* Sidebar Styles */
.sidebar {
    position: fixed;
    top: 0;
    right: -250px; /* Start off-screen */
    width: 250px;
    height: 100vh;
    background-color: var(--box-bg);
    padding: 20px;
    box-shadow: -2px 0 5px rgba(0,0,0,0.1);
    overflow-y: auto;
    z-index: 1000;
    transition: transform 0.3s ease;
    border-left: 3px solid var(--border-color);
}

.sidebar.open {
    transform: translateX(-250px); /* Slide in when open */
}

.sidebar-toggle {
    position: fixed;
    right: 20px;
    top: 20px;
    background-color: var(--border-color);
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 3px;
    cursor: pointer;
    z-index: 1001;
    font-family: var(--font-header);
    transition: all 0.3s ease;
}

.sidebar h3 {
    color: var(--title-color);
    font-family: var(--font-header);
    border-bottom: 1px solid var(--border-light);
    padding-bottom: 8px;
    margin-top: 0;
}

.player-card {
    background-color: var(--background-dark);
    padding: 10px;
    margin-bottom: 10px;
    border-left: 3px solid var(--border-color);
    border-radius: 3px;
}

.player-card input {
    width: 100%;
    margin-bottom: 5px;
    background-color: var(--background-main);
    border: 1px solid var(--border-light);
    color: var(--text-color);
    padding: 5px;
    font-family: var(--font-main);
}

.player-status {
    display: flex;
    justify-content: space-between;
    margin-top: 5px;
    gap: 5px;
}

.status-toggle {
    background: none;
    border: 1px solid var(--border-light);
    color: var(--text-color);
    cursor: pointer;
    padding: 2px 5px;
    font-size: 12px;
    flex-grow: 1;
    transition: all 0.3s ease;
}

.status-toggle.active {
    background-color: var(--border-color);
    color: white;
}

.player-card button:last-child {
    background-color: #8b0000;
    color: white;
    border: none;
    border-radius: 3px;
    padding: 2px 5px;
    cursor: pointer;
}

body.dark-mode .sidebar {
    box-shadow: -2px 0 5px rgba(0,0,0,0.3);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .sidebar {
        width: 200px;
        right: -200px;
    }
    
    .sidebar.open {
        transform: translateX(-200px);
    }
    
    .player-card input {
        padding: 3px;
        font-size: 14px;
    }
}    


/* Update collapsible section styles */
.section-title {
    position: relative;
    padding-left: 25px;
    cursor: pointer;
}

.section-title::before {
    content: "+";
    position: absolute;
    left: 10px;
    color: var(--border-color);
    font-weight: bold;
    transition: transform 0.3s ease;
}

.section-title.active::before {
    content: "-";
}

.back-to-top {
  position: fixed;
  bottom: 80px;
  right: 60px;
  background-color: var(--border-color);
  color: white;
  border: none;
  padding: 10px;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: var(--shadow-dark);
  z-index: 1000;
  display: none;
}

.tab-button.dragging {
  opacity: 0.5;
  background: rgba(139, 0, 0, 0.1);
}

.tab-buttons {
  user-select: none;
}

/* Add these styles to your existing CSS */
.section-title.dragging {
  opacity: 0.5;
  background: rgba(139, 0, 0, 0.1);
  border: 2px dashed var(--border-color);
}

.section-title {
  user-select: none;
  cursor: grab;
}

.section-title:active {
  cursor: grabbing;
}


.relationship-table {
  width: 100%;
  border-collapse: collapse;
}
.relationship-table th, .relationship-table td {
  border: 1px solid #444;
  padding: 8px;
  text-align: left;
}
.relationship-table th {
  background-color: #2a2a2a;
}
.relationship-table tr:nth-child(even) {
  background-color: #1e1e1e;
}

.dm-notes {
    background-color: #f8f8f8;
    border-left: 4px solid #c7254e;
    padding: 10px;
    margin: 10px 0;
    font-size: 0.9em;
}
.dm-notes h4 {
    color: #c7254e;
    margin-top: 0;
}
.box-highlight {
    background-color: #fff9e6;
    border: 1px solid #ffe0b2;
    border-radius: 5px;
    padding: 15px;
    margin: 15px 0;
}
.mood-table {
    width: 100%;
    border-collapse: collapse;
}
.mood-table th, .mood-table td {
    border: 1px solid #ddd;
    padding: 8px;
}
.mood-table th {
    background-color: #f2f2f2;
}

.npc-relationship-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}
.npc-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    overflow: hidden;
}
.npc-header {
    background: #4a2c82;
    color: white;
    padding: 12px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.npc-header h3 {
    margin: 0;
    font-size: 1.2em;
}
.npc-status {
    background: #2a1a4a;
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 0.8em;
}
.npc-body {
    padding: 15px;
}
.npc-body p {
    margin-top: 0;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
}
.dm-notes {
    background-color: #f8f8f8;
    border-left: 4px solid #c7254e;
    padding: 10px;
    margin: 10px 0;
    font-size: 0.9em;
}
.dm-notes h4 {
    color: #c7254e;
    margin: 8px 0 5px 0;
}
.box-highlight {
    background-color: #fff9e6;
    border: 1px solid #ffe0b2;
    border-radius: 5px;
    padding: 15px;
    margin: 15px 0;
}

.legendary-actions-help {
    background-color: #f0f7ff;
    border-left: 3px solid #4a90e2;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 0 4px 4px 0;
}
.legendary-note {
    margin: 0;
    font-size: 0.9em;
    color: #2c3e50;
}
.action-example {
    font-size: 0.8em;
    color: #666;
    font-style: italic;
    margin: 3px 0 10px 20px;
}
.dice-result {
    margin: 5px 0;
}

/* NPC Mini-Card Styles - Updated to match your theme */
    .npc-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 15px;
    }
    
    .npc-card-mini {
        background: var(--box-bg);
        border: 1px solid var(--border-light);
        border-left: 4px solid var(--border-color);
        border-radius: 4px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: var(--shadow-light);
    }
    
    .npc-card-mini:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        border-left-color: #a30000;
    }
    
    .npc-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--border-light);
    }
    
    .npc-header h4 {
        margin: 0;
        color: white;
        font-family: 'Crimson Text', serif;
        font-size: 18px;
        letter-spacing: 0.5px;
    }
    
    .npc-tag {
        font-size: 0.75em;
        padding: 3px 8px;
        border-radius: 12px;
        color: white;
        font-family: var(--font-header);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .npc-tag.obsession { background: #8b0000; }
    .npc-tag.protector { background: #1a5276; }
    .npc-tag.broken { background: #6c757d; }
    .npc-tag.enemy { background: #c0392b; }
    .npc-tag.pawn { background: #d35400; }
    .npc-tag.cultist { background: #6c3483; }
    .npc-tag.experiment { background: #138d75; }
    .npc-tag.loyal { background: #196f3d; }
    .npc-tag.consort { background: #7d6608; }
    
    .npc-quote {
        font-style: italic;
        color: var(--subtitle-color);
        margin: 10px 0;
        padding-left: 10px;
        border-left: 2px solid var(--border-light);
        font-family: var(--font-accent);
    }
    
    .npc-status-line {
        color: var(--text-color);
        margin: 8px 0;
        font-size: 0.95em;
    }
    
    .npc-link {
        display: inline-block;
        color: var(--border-color);
        font-size: 0.85em;
        margin-top: 10px;
        text-decoration: none;
        font-family: var(--font-header);
        transition: all 0.3s ease;
    }
    
    .npc-link:hover {
        color: #a30000;
        text-decoration: underline;
    }
    
    .clickable {
        cursor: pointer;
        user-select: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .clickable:hover {
        color: var(--title-color);
    }
    
/* Locations Tab System Styles */
.tab-system {
    margin: 30px 0;
}

.tab-buttons {
    display: flex;
    border-bottom: 1px solid var(--border-light);
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.tab-button {
    padding: 10px 20px;
    background: none;
    border: none;
    border-bottom: 3px solid transparent;
    font-family: var(--font-header);
    color: var(--title-color);
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
    margin-right: 5px;
}

.tab-button:hover {
    color: #6b0000;
}

.tab-button.active {
    border-bottom: 3px solid var(--border-color);
    font-weight: bold;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* Map Image Styles */
.tab-content img {
    width: 100%;
    max-height: 300px;
    object-fit: cover;
    border-radius: 5px;
    margin-bottom: 15px;
    box-shadow: var(--shadow-light);
}

/* NPC Grid Styles */
.npc-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
    margin-top: 15px;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
    .tab-buttons {
        flex-direction: column;
    }
    
    .tab-button {
        margin-bottom: 5px;
        text-align: left;
    }
    
    .npc-grid {
        grid-template-columns: 1fr;
    }
    
    .tab-content img {
        max-height: 200px;
    }
}

.npc-full-card {
    background: var(--box-bg);
    border-left: 4px solid var(--border-color);
    padding: 20px;
    margin-bottom: 20px;
    position: relative;
    overflow: visible; /* Ensure content isn't clipped */
}
    

    .npc-portrait {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 5px;
        float: right;
        margin-left: 15px;
        border: 2px solid var(--border-light);
    }
    
.npc-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin: 15px 0;
    }
    
.stat-box {
        background: rgba(139, 0, 0, 0.1);
        padding: 8px;
        text-align: center;
        border-radius: 5px;
    }


    .stat-label {
        font-size: 0.8em;
        color: var(--title-color);
    }
    .stat-value {
        font-weight: bold;
    }
    .npc-loot {
        background: rgba(212, 175, 55, 0.1);
        padding: 10px;
        margin-top: 15px;
        border-left: 3px solid var(--accent-gold);
    }
    .save-npc-btn {
        background: var(--border-color);
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
        margin-top: 10px;
    }

    .music-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    .music-card {
        background: var(--box-bg);
        border-left: 4px solid var(--border-color);
        padding: 15px;
        display: flex;
        transition: transform 0.3s ease;
    }
    .music-card:hover {
        transform: translateY(-3px);
    }
    .music-cover {
        width: 80px;
        height: 80px;
        object-fit: cover;
        margin-right: 15px;
    }
    .music-info {
        flex: 1;
    }
    .music-info h4 {
        margin: 0 0 5px 0;
        color: var(--title-color);
    }
    .music-info p {
        margin: 0 0 10px 0;
        font-size: 0.9em;
    }
    .music-link {
        background: var(--border-color);
        color: white;
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 0.8em;
        text-decoration: none;
        display: inline-block;
    }


  /* NPC Generator Styling */
#npc-generator {
    position: relative;
    z-index: 2; /* Ensure it stays above other content */
}

#npc-generator .box {
    min-height: 300px; /* Give it enough initial space */
    overflow: visible !important; /* Critical: Allow content to extend beyond */
    margin-bottom: 40px; /* Extra space below */
    transition: min-height 0.5s ease; /* Smooth expansion */
}

.npc-full-card {
    display: flex;
    flex-direction: column;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 5px;
    padding: 20px;
    margin-top: 20px;
    position: relative;
    z-index: 1;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    border-left: 3px solid var(--border-color);
}

.npc-portrait {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
    margin: 0 auto 15px;
    border: 2px solid var(--border-color);
}

.npc-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin: 15px 0;
}

.stat-box {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 4px;
    padding: 8px;
    text-align: center;
    border: 1px solid var(--border-light);
}

.stat-label {
    font-weight: bold;
    font-size: 14px;
    margin-bottom: 5px;
}

.stat-value {
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
}

#npc-result {
    clear: both;
    position: relative;
    z-index: 1;
    transition: opacity 0.3s ease, transform 0.3s ease;
    width: 100%;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .npc-stats {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 480px) {
    .npc-stats {
        grid-template-columns: 1fr;
    }
}

/* Button styling enhancement */
.roll-button {
    background-color: var(--accent-color, #8b0000);
    color: #fff;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s ease, transform 0.1s ease;
}

.roll-button:hover {
    background-color: var(--accent-hover, #a00000);
    transform: translateY(-1px);
}

.roll-button:active {
    transform: translateY(1px);
}

/* Add animation for content appearance */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.npc-full-card {
    animation: fadeIn 0.4s ease-out;
}

/* just added */
 /* ================= BLOOD DRIP TABS ================= */
.tab-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 30px 0;
    position: relative;
}

.roll-button:hover, .roll-button.active {
    background-color: transparent; /* Changed from #2a0000 */
    color: #856262;
}

/* Blood drip effect */
.roll-button:before {
    content: "";
    position: absolute;
    width: 100%;
    height: 0;
    top: 0;
    left: 0;
    background-color: #9c0e0e;
    transition: height 0.3s ease;
    z-index: -1;
}

.roll-button:hover:before, .roll-button.active:before {
    height: 5px;
}

.roll-button:after {
    content: "";
    position: absolute;
    width: 10px;
    height: 0;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    background-color: #9c0e0e;
    transition: height 0.5s ease-out;
    transition-delay: 0.2s;
    z-index: -1;
}

.roll-button:hover:after, .roll-button.active:after {
    height: 15px;
    border-bottom-left-radius: 50%;
    border-bottom-right-radius: 50%;
}

/* Tab content */
.tab-content {
    display: none;
    padding: 20px;
    border: 1px solid #6e0000;
    margin-top: 10px;
    animation: fadeIn 0.5s;
}

.tab-content.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}


/* ================= ENHANCED STRAHD EYES ================= */
footer {
  position: relative;
  text-align: center;
  padding: 60px 20px 80px; /* Extra space for eyes */
  font-family: Arial, sans-serif;
  min-height: 120px;
  overflow: hidden;
  border-top: 1px solid #6e0000;
}

/* Improved fog effect */
footer .footer-fog {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(ellipse at center, rgba(0,0,0,0) 0%, rgba(20,0,0,0.7) 100%),
    url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><filter id="fog"><feTurbulence type="fractalNoise" baseFrequency="0.02" numOctaves="3" /><feComponentTransfer><feFuncR type="linear" slope="0.1" intercept="0" /><feFuncG type="linear" slope="0.1" intercept="0" /><feFuncB type="linear" slope="0.1" intercept="0" /></feComponentTransfer><feBlend mode="screen" /></filter><rect width="100%" height="100%" filter="url(%23fog)" opacity="0.15" /></svg>');
  pointer-events: none;
  z-index: 1;
  mix-blend-mode: multiply;
}

/* Eyes container */
footer .strahd-eyes-container {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 50px;
  z-index: 2;
  pointer-events: none;
}

/* Realistic eye styling */
footer .strahd-eye {
  position: absolute;
  width: 36px;
  height: 24px;
  background: 
    radial-gradient(circle at 30% 30%, #fff 0%, #e0e0e0 45%, #c0c0c0 100%);
  border-radius: 50%;
  overflow: hidden;
  box-shadow: 
    0 0 10px rgba(156, 14, 14, 0.8),
    inset 0 0 15px rgba(0, 0, 0, 0.5);
  border: 1px solid #400;
}

footer .strahd-eye-left {
  left: 5px;
}

footer .strahd-eye-right {
  right: 5px;
}

/* Enhanced pupil with glow */
footer .strahd-pupil {
  position: absolute;
  width: 12px;
  height: 12px;
  background: 
    radial-gradient(circle at 30% 30%, #9c0e0e 0%, #600 70%, #300 100%);
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  box-shadow: 
    0 0 5px rgba(156, 14, 14, 0.8),
    inset 0 0 3px rgba(255, 255, 255, 0.3);
}

/* More realistic eye details */
footer .strahd-pupil::after {
  content: "";
  position: absolute;
  width: 4px;
  height: 4px;
  background: #000;
  border-radius: 50%;
  top: 30%;
  left: 30%;
}

footer .strahd-pupil::before {
  content: "";
  position: absolute;
  width: 2px;
  height: 2px;
  background: rgba(255, 255, 255, 0.8);
  border-radius: 50%;
  top: 25%;
  left: 25%;
}

/* Eyelid for blinking */
footer .eyelid {
  position: absolute;
  width: 100%;
  height: 100%;
  background: #200;
  top: -100%;
  left: 0;
  border-radius: 50%;
  transition: top 0.2s ease;
}

/* Blink animation */
footer .blink {
  animation: strahdBlink 8s infinite;
}

@keyframes strahdBlink {
  0%, 96%, 100% { transform: translateX(-50%) scaleY(1); }
  97%, 99% { transform: translateX(-50%) scaleY(0.05); }
}

/* Mouse follow effect - will be added via JavaScript */

/* Update the fangs SVG in your CSS */
footer .strahd-fangs {
  position: absolute;
  bottom: -15px;
  left: 50%;
  transform: translateX(-50%);
  width: 40px;
  height: 20px;
  background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 20"><path d="M10,20 L12,5 L8,5 Z" fill="white" stroke="%23400" stroke-width="0.5"/><path d="M30,20 L28,5 L32,5 Z" fill="white" stroke="%23400" stroke-width="0.5"/></svg>') no-repeat center;
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 3;
  filter: drop-shadow(0 0 2px rgba(156,14,14,0.8));
}

footer .strahd-eyes-container.squinting .strahd-eye {
  height: 8px;
  transition: height 0.3s ease;
}

footer .strahd-eyes-container.squinting .strahd-pupil {
  transform: translate(-50%, -50%) scaleY(1.5);
}

footer .strahd-eyes-container.showing-fangs .strahd-fangs {
  opacity: 1;
}

/* Add these new styles */
.strahd-eyes-container.disappearing {
  animation: disappear 0.5s forwards;
}

@keyframes disappear {
  0% { opacity: 1; transform: translateX(-50%) scale(1); }
  100% { opacity: 0; transform: translateX(-50%) scale(0.5); }
}

.strahd-eyes-container.laughing .strahd-eye {
  background: radial-gradient(circle at 30% 30%, #ff0000 0%, #800000 45%, #400000 100%);
  box-shadow: 0 0 20px rgba(255, 0, 0, 0.8);
}

.strahd-eyes-container.threatening {
  animation: threaten 0.5s infinite alternate;
}

@keyframes threaten {
  0% { transform: translateX(-50%) scale(1); }
  100% { transform: translateX(-50%) scale(1.1); }
}

.strahd-eyes-container.threatening .strahd-eye {
  background: radial-gradient(circle at 30% 30%, #ff0000 0%, #600000 70%, #300000 100%);
}

.strahd-eyes-container.threatening .strahd-pupil {
  background: #000;
}

.strahd-eyes-container.transforming {
  animation: transform 2s forwards;
}

@keyframes transform {
  0% { transform: translateX(-50%) scale(1); opacity: 1; }
  50% { transform: translateX(-50%) scale(0.1); opacity: 0; }
  100% { transform: translateX(-50%) scale(1); opacity: 1; }
}

/* FOG! */

/* ================= STRAHD'S ENHANCED FOG ================= */
.page-fog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    /* Blood-red animated fog */
    url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="400"><filter id="fog"><feTurbulence type="fractalNoise" baseFrequency="0.03" numOctaves="3" stitchTiles="stitch"/><feColorMatrix type="matrix" values="0.3 0 0 0 0.1 0 0.1 0 0 0 0 0 0.1 0 0 0 0 0 0.3 0"/></filter><rect width="100%" height="100%" filter="url(%23fog)"/></svg>'),
    /* Gradient for depth */
    radial-gradient(ellipse at center, rgba(20,0,0,0.1) 40%, rgba(50,0,0,0.6) 100%);
  opacity: 0.5;
  pointer-events: none;
  z-index: 1000;
  mix-blend-mode: overlay;
  animation: 
    fogDrift 60s infinite linear,
    fogPulse 30s infinite alternate;
}

/* SVG-based fog animation (better performance than GIF) */
@keyframes fogDrift {
  0% { background-position: 0 0, 0 0; }
  100% { background-position: 400px 400px, 0 0; }
}

@keyframes fogPulse {
  0% { opacity: 0.4; }
  100% { opacity: 0.7; }
}

/* Enhanced vignette with blood moon effect */
.page-vignette {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 999;
  background: 
    radial-gradient(ellipse at center, rgba(0,0,0,0) 60%, 
    rgba(20,0,0,0.7) 100%),
    url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.01" numOctaves="2"/></filter><rect width="100%" height="100%" filter="url(%23noise)" opacity="0.05"/></svg>');
  mix-blend-mode: multiply;
  box-shadow: inset 0 0 200px rgba(40,0,0,0.9);
}


/* ADDED 5/25 */
/* ================ PRINT FUNCTIONALITY STYLES ================ */
/* Section Header Structure */
.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    padding-right: 15px;
}

.section-title {
    position: relative;
    padding-right: 40px; /* Space for print controls */
}

/* Checkbox Selector */
.print-selector {
    position: relative;
    width: 24px;
    height: 24px;
    margin-left: 15px;
    cursor: pointer;
    flex-shrink: 0;
}

.print-selector input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
}

.checkmark {
    position: absolute;
    top: 0;
    left: 0;
    height: 24px;
    width: 24px;
    background-color: transparent;
    border: 2px solid var(--border-color);
    border-radius: 4px;
    transition: all 0.3s ease;
}

.print-selector:hover .checkmark {
    background-color: rgba(139, 0, 0, 0.1);
}

.print-selector input:checked ~ .checkmark {
    background-color: var(--border-color);
}

.checkmark:after {
    content: "";
    position: absolute;
    display: none;
    left: 8px;
    top: 4px;
    width: 6px;
    height: 12px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
}

.print-selector input:checked ~ .checkmark:after {
    display: block;
}

/* Alternative Button Selector */
.section-title .print-section-btn {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--border-color);
    cursor: pointer;
    font-size: 16px;
    opacity: 0.7;
    transition: all 0.3s ease;
}

.section-title .print-section-btn:hover {
    opacity: 1;
    color: var(--title-color);
}

.section-title .print-section-btn::after {
    content: "‚úì";
    margin-left: 5px;
    font-size: 14px;
    vertical-align: middle;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.section-title .print-section-btn.selected::after {
    opacity: 1;
}

/* Print Control Button */
.print-control {
    position: fixed;
    bottom: 20px;
    left: 20px; /* Changed from right to left */
    z-index: 1000;
    background-color: var(--border-color);
    color: white;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 20px;
    cursor: pointer;
    box-shadow: var(--shadow-dark);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.print-control:hover {
    background-color: #6B0000;
    transform: scale(1.1);
}

/* Dark Mode Adjustments */
body.dark-mode {
    /* Checkbox */
    .checkmark {
        border-color: var(--accent-gold);
    }
    
    .print-selector input:checked ~ .checkmark {
        background-color: var(--accent-gold);
    }
    
    .print-selector:hover .checkmark {
        background-color: rgba(212, 175, 55, 0.1);
    }
    
    /* Button Selector */
    .print-section-btn {
        color: var(--accent-gold);
    }
    
    /* Footer */
    .site-footer {
        background-color: var(--background-dark);
    }
    
    .qr-code {
        background: var(--box-bg);
        border-color: var(--border-color);
    }
}

/* Print-specific styles */
@media print {
    body * {
        visibility: hidden;
    }
    
    .section-title, .section-title *,
    .collapsible-content, .collapsible-content * {
        visibility: visible;
    }
    
    .section-title {
        page-break-after: avoid;
    }
    
    .collapsible-content {
        page-break-inside: avoid;
    }
    
    /* Hide interactive elements */
    .print-selector, .print-control, .print-section-btn,
    .tab-buttons, .nav-links, .roll-button, 
    .tooltip, .dark-mode-toggle {
        display: none !important;
    }
    
    /* Show only selected sections */
    .section-title:not(.print-selected),
    .section-title:not(.print-selected) + .collapsible-content {
        display: none !important;
    }
    
    /* Footer styling for print */
    .print-footer {
        display: block !important;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        text-align: center;
        font-size: 10px;
        padding: 10px;
        border-top: 1px solid #ccc;
        font-family: var(--font-main);
    }
    
    .print-footer img.qr-code {
        height: 50px;
        margin: 0 10px;
        vertical-align: middle;
    }
    
    /* Ensure content prints cleanly */
    .box {
        break-inside: avoid;
        box-shadow: none !important;
        border: 1px solid #ddd !important;
    }
}

/* ================ UPDATED FOOTER WITH QR CODE ================ */
.site-footer {
    text-align: center;
    padding: 20px;
    margin-top: 40px;
    border-top: 2px solid var(--border-color);
    font-size: 14px;
    position: relative;
    background-color: var(--box-bg);
}

.footer-content {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
}

.qr-code {
    height: 80px;
    opacity: 0.9;
    transition: opacity 0.3s ease;
    border: 1px solid var(--border-light);
    padding: 5px;
    background: white;
}

.qr-code:hover {
    opacity: 1;
}

.print-footer {
    display: none;
}

/* ================ ENHANCED PRINT FUNCTIONALITY ================ */
/* Enhanced Print Styles */
/* Box selection styles */
.box {
    position: relative;
    padding-top: 30px;
}

.box-checkbox {
    position: absolute;
    top: 10px;
    right: 10px;
    transform: scale(1.5);
    z-index: 10;
    cursor: pointer;
}

.box-checkbox:checked + .box {
    outline: 2px solid #8B0000;
    background-color: rgba(139, 0, 0, 0.05);
}

@media print {
  * {
    overflow: visible !important;
    position: static !important;
  }
}

body {
    margin: 0 !important;
    padding: 0 !important;
  }



    #print-container {
        display: block !important;
        visibility: visible !important;
    }

    #print-container * {
        visibility: visible !important;
    }


    .box {
        border: 1px solid #000 !important;
        background: white !important;
        padding: 3mm !important;
    }

    @page {
    margin: 0;
  }

/* Remove any page-breaks at the top */
    .print-spacer, .page-break {
    display: none !important;
  }


    ol li::before {
    content: "" !important; /* Removes CSS-added numbers */
}


</style>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90' fill='%238b0000'>üßõ</text></svg>">
</head>
<body>
    <div class="page-fog-overlay"></div>
<div class="page-vignette"></div>
    <div class="container">
        <div class="header-container">
            <div class="logo-container">
                <img src="https://www.tribality.com/wp-content/uploads/2016/01/Curse-of-Strahd-Logo.png" alt="Curse of Strahd Logo">
            </div>
            <h1 class="page-title">Curse of Strahd</h1>
            <h2 class="page-subtitle">Shadows of Barovia: Enhanced Cheat Sheet</h2>
        </div>


        

        
<div class="quick-nav">
  <h3>QUICK NAVIGATION</h3>

  <!-- Tab Selectors -->
  <div class="tab-buttons">
    <button class="roll-button" onclick="showTab('core')">Core Mechanics</button>
    <button class="roll-button" onclick="showTab('madness')">Madness & Horror</button>
    <button class="roll-button" onclick="showTab('survival')">Survival Rules</button>
    <button class="roll-button" onclick="showTab('world')">World Lore</button>
    <button class="roll-button" onclick="showTab('strahd')">Strahd Lore</button>
    <button class="roll-button" onclick="showTab('misc')">Music & Misc Tools</button>
    <button class="roll-button print-selections-btn" onclick="preparePrint()" title="Print Selected Sections">
        <i class="fas fa-print"></i> Print Selections
    </button>
</div>


  <!-- Core Mechanics Tab -->
  <div class="nav-links tab-content" id="core">
    <a href="#core-mechanics" class="nav-link">Core Mechanics</a>
    <a href="#cover" class="nav-link">Cover</a>
    <a href="#conditions" class="nav-link">Conditions</a>
    <a href="#exhaustion" class="nav-link">Exhaustion Tracker</a>
    <a href="#combat" class="nav-link">Combat Quick Reference</a>
  </div>

  <!-- Madness & Horror Tab -->
  <div class="nav-links tab-content" id="madness" style="display:none;">
    <a href="#psychological-warfare" class="nav-link">Psychological Warfare</a>
    <a href="#fear-horror" class="nav-link">Fear & Horror</a>
    <a href="#despair" class="nav-link">Despair</a>
    <a href="#nightmares" class="nav-link">Nightmares</a>
    <a href="#corruption" class="nav-link">Corruption</a>
  </div>

  <!-- Survival Rules Tab -->
  <div class="nav-links tab-content" id="survival" style="display:none;">
    <a href="#weather" class="nav-link">Weather</a>
    <a href="#light" class="nav-link">Mundane Light Source</a>
    <a href="#foraging" class="nav-link">Foraging & Starvation</a>
    <a href="#food" class="nav-link">Food Prices</a>
    <a href="#environment" class="nav-link">Environmental Rules</a>
  </div>

  <!-- World Lore Tab -->
  <div class="nav-links tab-content" id="world" style="display:none;">
    <a href="#locations" class="nav-link">Locations</a>
    <a href="#curse-removal" class="nav-link">Curse Removal</a>
    <a href="#vistani" class="nav-link">Vistani / Encounters</a>
    <a href="#calendar" class="nav-link">Calendar</a>
    <a href="#descriptors" class="nav-link">Descriptors</a>
  </div>

<!-- Strahd Nav -->
<div class="nav-links tab-content" id="strahd" style="display:none;">
  <a href="#strahd-profile" class="nav-link">Strahd Profile</a>
  <a href="#strahd-abilities" class="nav-link">Strahd's Abilities</a>
  <a href="#npc-relationships" class="nav-link">NPC Relationships</a>
  <a href="#barovian-lore" class="nav-link">Barovian Lore</a>
</div>

<div class="nav-links tab-content" id="misc" style="display:none;">
    <a href="#atmosphere-music" class="nav-link">Music & Tools</a>
    <a href="#npc-generator" class="nav-link">NPC Generator</a>
</div>

</div>

         
        <div class="divider"></div>
        <div class="divider-thin"></div>
        
        <!-- Core Mechanics -->
        <h2 class="section-title" id="core-mechanics">
            <div class="section-header">
                <span>CORE MECHANICS</span>
                <label class="print-selector">
                    <input type="checkbox" class="section-checkbox" data-section="core-mechanics">
                </label>
            </div>
        </h2>
        <div class="collapsible-content">
            <div class="row">
                <div class="col">
                    <div class="box">
                        <h3 class="box-title">DIFFICULTY CLASS RANGES</h3>
                        <div class="table-header">
                            <div class="table-col-1">DIFFICULTY</div>
                            <div class="table-col-2">DC</div>
                            <div class="table-col-3">PROF DICE</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Very Easy</div>
                            <div class="table-col-2">5-9</div>
                            <div class="table-col-3">+2 ‚Üí d4</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Easy</div>
                            <div class="table-col-2">10-14</div>
                            <div class="table-col-3">+3 ‚Üí d6</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Moderate</div>
                            <div class="table-col-2">15-19</div>
                            <div class="table-col-3">+4 ‚Üí d8</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Hard</div>
                            <div class="table-col-2">20-24</div>
                            <div class="table-col-3">+5 ‚Üí d10</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Very Hard</div>
                            <div class="table-col-2">25-29</div>
                            <div class="table-col-3">+6 ‚Üí d12</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Nearly Impossible</div>
                            <div class="table-col-2">30+</div>
                            <div class="table-col-3"></div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="box">
                        <h3 class="box-title">SECRET DCs</h3>
                        <p>Never reveal exact <span class="tooltip">DCs<span class="tooltiptext">Difficulty Class: The target number a player must meet or exceed on a d20 roll to succeed at a task.</span></span> for checks or saves. Instead, inform players if a task is easy, moderate, hard, etc.</p>

<p>Rather than flat bonuses, use <span class="tooltip">proficiency dice<span class="tooltiptext">Instead of a fixed bonus, roll a die (d4-d12 based on level) adding to checks. This adds variability to skilled actions.</span></span> (d4-d12 based on level) to add volatility to skill checks.</p>
                        <h3 class="box-subtitle">PROFICIENCY DICE:</h3>
                        <p>Rather than flat bonuses, use proficiency dice (d4-d12 based on level) to add volatility to skill checks.</p>
                        
                        <h3 class="box-subtitle">STRAHD'S GAZE <span class="tooltip">‚ÑπÔ∏è<span class="tooltiptext">When Strahd is scrying on the party</span></span></h3>
                        <p>When Strahd is watching through magical means or spies:</p>
                        <ul>
                            <li>Disadvantage on Perception checks to notice hidden threats</li>
                            <li>Subtle changes in environment (shadows move oddly, reflections show someone behind you)</li>
                            <li>Animal behavior changes (ravens watch intently, wolves avoid the area)</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col">
                    <div class="box">
                        <h3 class="box-title">ADVANCED SANITY SYSTEM (OPTIONAL)</h3>
                        <p>Track Sanity Points (SP) starting at 10 + WIS modifier. Lose SP when encountering horrors. At 0 SP, gain indefinite madness.</p>
                        
                        <h3 class="box-subtitle">SANITY LOSS:</h3>
                        <div class="table-header">
                            <div class="table-col-1">EVENT</div>
                            <div class="table-col-2">SANITY LOSS</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Witnessing a brutal death</div>
                            <div class="table-col-2">1d4</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Seeing a ghost</div>
                            <div class="table-col-2">1d6</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Encountering Strahd</div>
                            <div class="table-col-2">1d8</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Experiencing a nightmare</div>
                            <div class="table-col-2">1d4</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Learning a terrible truth</div>
                            <div class="table-col-2">1d6</div>
                        </div>
                        
                        <h3 class="box-subtitle">RECOVERY:</h3>
	
                        <p>After <span class="tooltip">short rest<span class="tooltiptext">A period of downtime (at least 1 hour) where characters tend wounds and regain some resources.</span></span>, attempt WIS save to end despair. <span class="tooltip">Calm emotions<span class="tooltiptext">2nd-level spell: Suppresses strong emotions or removes frightened/charmed conditions.</span></span>, <span class="tooltip">lesser/greater restoration<span class="tooltiptext">Lesser: 2nd-level, ends conditions like paralyzed or poisoned. Greater: 5th-level, reduces exhaustion or removes curses.</span></span> remove despair.</p>
                        <ul>
                            <li>Regain 1 SP after a safe long rest</li>
                            <li>Greater Restoration restores all SP</li>
                            <li>Calm Emotions restores 1d4 SP</li>
                        </ul>
                    </div>
                </div>
                <div class="col">
                    <div class="box">
                        <h3 class="box-title">REST MECHANICS</h3>
                        <h3 class="box-subtitle">SHORT REST:</h3>
                        <ul>
                            <li>Roll only 1 Hit Die + CON modifier</li>
                        </ul>
                        
                        <h3 class="box-subtitle">LONG REST (UNSECURED):</h3>
                        <ul>
                            <li>Roll remaining Hit Dice + CON modifier</li>
                            <li>Regain 1 Hit Die</li>
                            <li>Prepare spells</li>
                        </ul>
                        
                        <h3 class="box-subtitle">LONG REST (SECURED):</h3>
                        <ul>
                            <li>Regain all hit points</li>
                            <li>Regain half Hit Dice</li>
                            <li>Prepare spells</li>
                        </ul>
                        
                        <h3 class="box-subtitle">EXHAUSTION:</h3>
                        <p>Gain 1 level every 12 hours without long rest</p>
                        
                        <h3 class="box-subtitle">HOPE POINTS <span class="tooltip">‚ÑπÔ∏è<span class="tooltiptext">Counterbalance to despair mechanics</span></span></h3>
                        <p>Players can earn Hope Points through:</p>
                        <ul>
                            <li>Helping NPCs (1 point)</li>
                            <li>Defeating major threats (1-3 points)</li>
                            <li>Discovering comforting truths (1 point)</li>
                        </ul>
                        <p>Spend Hope Points to:</p>
                        <ul>
                            <li>Reroll a failed save (1 point)</li>
                            <li>Remove 1 level of exhaustion (2 points)</li>
                            <li>End despair effects (3 points)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Psychological Warfare -->
        <h2 class="section-title" id="psychological-warfare">
            <div class="section-header">
                <span>PSYCHOLOGICAL WARFARE</span>
                <label class="print-selector">
                    <input type="checkbox" class="section-checkbox" data-section="psychological-warfare">
                    
                </label>
            </div>
        </h2>
        <div class="collapsible-content">
            <div class="row">
                <div class="col">
                    <div class="box">
                        <h3 class="box-title">PERSONALIZED TORMENT</h3>
                        <p>Strahd tailors his psychological attacks based on character backgrounds and classes:</p>
                        
                        <h3 class="box-subtitle">CLASS-SPECIFIC TORMENTS:</h3>
                        <div class="table-header">
                            <div class="table-col-1">CLASS</div>
                            <div class="table-col-2">TORMENT</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Fighter</div>
                            <div class="table-col-2">Dreams of being powerless while loved ones die</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Rogue</div>
                            <div class="table-col-2">Framed for crimes they didn't commit</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Wizard</div>
                            <div class="table-col-2">Spells fail at critical moments</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Cleric</div>
                            <div class="table-col-2">Divine connection feels distant or silent</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Paladin</div>
                            <div class="table-col-2">Forced to compromise ideals to save others</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Ranger</div>
                            <div class="table-col-2">Animals turn against them</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Bard</div>
                            <div class="table-col-2">Performances fall flat or inspire horror</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Barbarian</div>
                            <div class="table-col-2">Rage leads to accidental harm of allies</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Druid</div>
                            <div class="table-col-2">Nature itself seems corrupted</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Monk</div>
                            <div class="table-col-2">Meditation reveals disturbing visions</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Warlock</div>
                            <div class="table-col-2">Patron demands questionable acts</div>
                        </div>
                        <div class="box-row">
                            <div class="table-col-1">Sorcerer</div>
                            <div class="table-col-2">Magic feels tainted or unstable</div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="box">
                        <h3 class="box-title">GASLIGHTING TECHNIQUES</h3>
                        <p>Strahd makes players question their reality:</p>
                        
                        <h3 class="box-subtitle">GASLIGHTING METHODS:</h3>
                        <ol>
                            <li><strong>False Memories:</strong> NPCs recall events differently than players</li>
                            <li><strong>Changing Environments:</strong> Subtle shifts in room layouts or decorations</li>
                            <li><strong>Time Distortion:</strong> Players lose/gain time unexpectedly</li>
                            <li><strong>Doppelg√§ngers:</strong> NPCs claim they saw a PC somewhere else</li>
                            <li><strong>Fabricated Evidence:</strong> Letters or items appear with false information</li>
                        </ol>
                        
                        <h3 class="box-subtitle">STRAHD'S MESSAGES (d6): <button class="roll-button" onclick="rollDice('1d6')">Roll</button></h3>
                        <ol>
                            <li><strong>"I tasted your fear last night."</strong> PC wakes with two puncture wounds but no HP loss.</li>
                            <li><strong>Blood-written note:</strong> "Your [loved one] begged for mercy. They lied." (No proof this happened)</li>
                            <li><strong>Dream of dinner:</strong> Strahd toasts the PC while their party lies dead at the table.</li>
                            <li><strong>Animal messenger:</strong> A raven drops a lock of hair matching a PC's style.</li>
                            <li><strong>Mirror writing:</strong> "Your reflection blinks. You don't." (Lasts 1d4 days)</li>
                            <li><strong>Personal jab:</strong> References a backstory detail Strahd shouldn't know... yet.</li>
                        </ol>
                        <p><em>Usage:</em> Roll when players rest or enter key locations. Never more than 1/day.</p>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col">
                    <div class="box">
                        <h3 class="box-title">STRAHD'S CHESSBOARD</h3>
                        <p>Strahd manipulates players by:</p>
                        <ul>
                            <li><strong>Seeding Mistrust:</strong> Forged letters "from allies" with false warnings.</li>
                            <li><strong>False Safety:</strong> Lets players "overhear" his plans (50% are traps).</li>
                            <li><strong>Petty Cruelty:</strong> Burns down a shelter after they upgrade it.</li>
                            <li><strong>Gifts with Hooks:</strong> Magic items that report their location.</li>
                            <li><strong>Divide and Conquer:</strong> Spreads rumors to turn NPCs against PCs.</li>
                            <li><strong>False Hope:</strong> Allows small victories before crushing them.</li>
                        </ul>
                        <p><em>Rule:</em> Never more than 1 major manipulation per 2 sessions.</p>
                        
                        <h3 class="box-subtitle">STRAHD'S ROMANCE TACTICS <span class="tooltip">‚ÑπÔ∏è<span class="tooltiptext">For campaigns involving Ireena/Tatyana</span></span></h3>
                        <ol>
                            <li><strong>Chivalrous Acts:</strong> Appears to rescue NPCs from danger</li>
                            <li><strong>Gifts:</strong> Leaves rare books, fine wines, or sentimental items</li>
                            <li><strong>Poetic Flattery:</strong> Compliments in iambic pentameter</li>
                            <li><strong>Jealousy:</strong> Shows displeasure when PC interacts with others</li>
                            <li><strong>Isolation:</strong> Separates target from allies "for their safety"</li>
                        </ol>
                    </div>
                </div>
                <div class="col">
                    <div class="box">
                        <h3 class="box-title">PSYCHOLOGICAL WARFARE TRACKER</h3>
                        <p>Track Strahd's psychological attacks on each PC:</p>
                        
                        <h3 class="box-subtitle">ESCALATION PHASES:</h3>
                        <ol>
                            <li><strong>Observation:</strong> Strahd learns fears and weaknesses (scrying, spies)</li>
                            <li><strong>Testing:</strong> Minor torments to gauge reactions (1-2 sessions)</li>
                            <li><strong>Targeted Attacks:</strong> Personalizes torments based on reactions (3-5 sessions)</li>
                            <li><strong>Breaking Point:</strong> Major psychological assault (after significant progress)</li>
                            <li><strong>Offering Dark Gift:</strong> Presents "solution" to their torment</li>
                        </ol>
                        
                        <h3 class="box-subtitle">PSYCHOLOGICAL EFFECTS TABLE (d8): <button class="roll-button" onclick="rollDice('1d8')">Roll</button></h3>
                        <ol>
                            <li><strong>Paranoia:</strong> Disadvantage on Insight checks</li>
                            <li><strong>Hypervigilance:</strong> Advantage on Perception, disadvantage on Concentration</li>
                            <li><strong>Emotional Numbing:</strong> Disadvantage on Persuasion, advantage on Intimidation</li>
                            <li><strong>Flashbacks:</strong> Chance to freeze in combat (DC 15 WIS save)</li>
                            <li><strong>Insomnia:</strong> Long rests only count as short rests</li>
                            <li><strong>Substance Abuse:</strong> Seeks escape in alcohol/drugs (disadvantage on DEX)</li>
                            <li><strong>Self-Harm:</strong> Takes 1d4 damage when stressed (voluntary)</li>
                            <li><strong>Dissociation:</strong> Occasionally unresponsive (DM controls for brief periods)</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Fear & Horror -->
        <h2 class="section-title" id="fear-horror">
            <div class="section-header">
                <span>FEAR & HORROR</span>
                <label class="print-selector">
                    <input type="checkbox" class="section-checkbox" data-section="fear-horror">
                    
                </label>
            </div>
        </h2>
        <div class="collapsible-content">
            <div class="row">
                <div class="col">
                    <div class="box">
                        <h3 class="box-subtitle">FEAR:</h3>
                        <p>When confronting overwhelming threats, a failed WIS save causes the frightened condition for 1 minute.</p>
                        
                        <h3 class="box-subtitle">HORROR:</h3>
<p>When experiencing something horrific, a failed <span class="tooltip">CHA save<span class="tooltiptext">Charisma saving throws represent resistance to effects that would force a change in personality or challenge your sense of self.</span></span> results in <span class="tooltip">madness<span class="tooltiptext">Madness can be short-term (1d10 minutes), long-term (1d10 hours), or indefinite until cured by magic or rest.</span></span>.</p>
                        <p><em>Examples:</em> Seeing a mangled body, witnessing a creature devouring a human, learning a terrible truth, watching a horrible death.</p>

                        <div class="box" style="margin-top: 25px;">
                            <h3 class="box-subtitle">CALM EMOTIONS:</h3>
                            <p>Removes frightened condition, short-term madness (long-term if combined with short rest), and despair (if combined with short rest).</p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="box">
                        <h3 class="box-title">EXPANDED MADNESS TABLES</h3>
                        
                        <h3 class="box-subtitle">SHORT-TERM MADNESS (d10): <button class="roll-button" onclick="rollDice('1d10')">Roll</button></h3>
                        <ol>
                            <li><strong>Incorrigible Flirt:</strong> Must compliment everyone excessively</li>
                            <li><strong>Nervous Laughter:</strong> Can't stop giggling inappropriately</li>
                            <li><strong>Selective Mutism:</strong> Can only whisper for 1d10 minutes</li>
                            <li><strong>Paranoia:</strong> Convinced someone is watching (might be true)</li>
                            <li><strong>Flashbacks:</strong> Relives traumatic event (disadvantage on next check)</li>
			    <li><strong>Hyperactivity:</strong> Can't stop moving/talking (disadvantage on Stealth)</li>
			    <li><strong>Catatonia:</strong> Stares blankly for 1d10 minutes</li>
			    <li><strong>Phobia:</strong> Develops temporary fear of something nearby</li>
			    <li><strong>Echolalia:</strong> Repeats last words heard (disadvantage on social checks)</li>
			    <li><strong>Synesthesia:</strong> Experiences crossed senses ("I can taste the color red")</li>
			</ol>

                    <h3 class="box-subtitle">LONG-TERM MADNESS (d10): <button class="roll-button" onclick="rollDice('1d10')">Roll</button></h3>
                    <ol>
                        <li><strong>Phantom Pain:</strong> Random limbs hurt (disadvantage on physical checks 1/day)</li>
                        <li><strong>Face Blindness:</strong> Can't recognize friends (Wisdom check to identify)</li>
                        <li><strong>Time Skips:</strong> Loses minutes/hours with no memory</li>
                        <li><strong>Compulsive Ritual:</strong> Must perform specific action when stressed</li>
                        <li><strong>Emotional Inversion:</strong> Laughs at sad things, cries at happy things</li>
                        <li><strong>Doppelg√§nger Fear:</strong> Convinced someone has been replaced</li>
                        <li><strong>Blood Fascination:</strong> Compelled to touch/stare at blood</li>
                        <li><strong>Mirror Phobia:</strong> Can't look at reflections without panic</li>
                        <li><strong>Sleepwalker:</strong> Acts out dreams with no memory</li>
                        <li><strong>Psychic Echo:</strong> Hears thoughts of nearby creatures occasionally</li>
                    </ol>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col">
                <div class="box">
                    <h3 class="box-title">INDEFINITE MADNESS (d10): <button class="roll-button" onclick="rollDice('1d10')">Roll</button></h3>
                    <ol>
                        <li><strong>Split Personality:</strong> Alternate identity emerges under stress</li>
                        <li><strong>Reality Fracture:</strong> Sees ghosts of possible futures/pasts</li>
                        <li><strong>Corpse Empathy:</strong> Believes dead bodies are just "resting"</li>
                        <li><strong>Vampiric Delusion:</strong> Convinced they're becoming a vampire</li>
                        <li><strong>Strahd Worship:</strong> Develops twisted admiration for the Count</li>
                        <li><strong>Body Dysmorphia:</strong> Convinced body parts aren't theirs</li>
                        <li><strong>Pica:</strong> Craves eating non-food items (dirt, bones, etc.)</li>
                        <li><strong>Savior Complex:</strong> Believes they alone can redeem Strahd</li>
                        <li><strong>Death Seeker:</strong> Takes increasingly reckless risks</li>
                        <li><strong>Living Nightmare:</strong> Can't distinguish dreams from reality</li>
                    </ol>
                    
                    <h3 class="box-subtitle">MADNESS RECOVERY:</h3>
                    <ul>
                        <li><strong>Short-term:</strong> Ends after 1d10 minutes</li>
                        <li><strong>Long-term:</strong> Save ends after 1d10 hours</li>
                        <li><strong>Indefinite:</strong> Requires Greater Restoration or quest resolution</li>
                    </ul>
                </div>
            </div>
            <div class="col">
                <div class="box">
                    <h3 class="box-title">PHYSICAL MANIFESTATIONS OF FEAR</h3>
                    <p>When failing fear saves by 5+:</p>
                    
                    <h3 class="box-subtitle">PHYSICAL EFFECTS (d8): <button class="roll-button" onclick="rollDice('1d8')">Roll</button></h3>
                    <ol>
                        <li><strong>Hair Whitening:</strong> Patch of hair turns white permanently</li>
                        <li><strong>Nervous Tic:</strong> Eye twitch, lip biting, etc.</li>
                        <li><strong>Cold Sweat:</strong> Permanently clammy hands</li>
                        <li><strong>Facial Spasm:</strong> Occasional uncontrollable grimace</li>
                        <li><strong>Voice Crack:</strong> Voice breaks when stressed</li>
                        <li><strong>Tremors:</strong> Hands shake during fine motor tasks</li>
                        <li><strong>Scarring:</strong> Psychosomatic wounds appear</li>
                        <li><strong>Aging:</strong> Visibly look older from stress</li>
                    </ol>
                    
                    <h3 class="box-subtitle">FEAR-BASED FLAWS (d6): <button class="roll-button" onclick="rollDice('1d6')">Roll</button></h3>
                    <ol>
                        <li>"I can't sleep without a light source"</li>
                        <li>"I must check corners for hidden threats"</li>
                        <li>"I refuse to be the last one in a group"</li>
                        <li>"I compulsively count objects when nervous"</li>
                        <li>"I can't enter a room without weapons drawn"</li>
                        <li>"I hear whispers in the wind"</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Despair -->
    <h2 class="section-title" id="despair">
        <div class="section-header">
            <span>DESPAIR</span>
            <label class="print-selector">
                <input type="checkbox" class="section-checkbox" data-section="despair">
                
            </label>
        </div>
    </h2>
    <div class="collapsible-content">
        <div class="row">
            <div class="col">
                <div class="box">
                    <h3 class="box-subtitle">TRIGGERS:</h3>
                    <p>Make a WIS save when:</p>
                    <ul>
                        <li>Taking rest in unsecured location</li>
                        <li>Waking after losing a party member</li>
                        <li>Suffering lingering injury</li>
                        <li>Seeing madness in a party member</li>
                        <li>Encountering major setback</li>
                        <li>Failing important objective</li>
                        <li>Witnessing Strahd's power firsthand</li>
                    </ul>
                    
                    <h3 class="box-subtitle">EFFECTS:</h3>
                    <ol>
                        <li><strong>Apathy</strong> - Disadvantage on death saves and initiative. Flaw: "I don't believe I can make a difference."</li>
                        <li><strong>Dread</strong> - Disadvantage on all saving throws. Flaw: "I'm convinced this place will kill me."</li>
                        <li><strong>Insanity</strong> - Disadvantage on INT/WIS/CHA checks & saves. Flaw: "I can't tell what's real anymore."</li>
                        <li><strong>Paranoia</strong> - Disadvantage on Insight. Flaw: "I trust no one, not even my allies."</li>
                        <li><strong>Nihilism</strong> - Disadvantage on Persuasion. Flaw: "Nothing we do matters anyway."</li>
                    </ol>
                </div>
            </div>
            <div class="col">
                <div class="box">
                    <h3 class="box-subtitle">RECOVERY:</h3>
                    <ul>
                        <li>After short rest, attempt WIS save to end despair</li>
                        <li>Calm emotions, lesser/greater restoration remove despair</li>
                        <li>3 Hope Points can remove despair</li>
                        <li>Major victory over Strahd's forces removes all despair</li>
                    </ul>
                    
                    <h3 class="box-subtitle">DESPAIR ESCALATION:</h3>
                    <p>For each consecutive day with despair:</p>
                    <ol>
                        <li><strong>Day 1:</strong> Disadvantage on one type of roll</li>
                        <li><strong>Day 3:</strong> Disadvantage expands to related rolls</li>
                        <li><strong>Day 5:</strong> Physical symptoms appear (tremors, etc.)</li>
                        <li><strong>Day 7+:</strong> Risk of indefinite madness</li>
                    </ol>
                    
                    <h3 class="box-subtitle">HOPE RESTORATION ACTIONS:</h3>
                    <ul>
                        <li>Protecting innocents: 1d4 Hope Points to party</li>
                        <li>Discovering Strahd's weakness: 1d6 Hope Points</li>
                        <li>Major victory: 1d8 Hope Points</li>
                        <li>Finding a safe haven: 1d4 Hope Points</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

<!-- Environmental Hazards -->
<h2 class="section-title" id="environment">
    <div class="section-header">
        <span>ENVIRONMENTAL RULES</span>
        <label class="print-selector">
            <input type="checkbox" class="section-checkbox" data-section="environment">
            
        </label>
    </div>
</h2>
<div class="collapsible-content">
    <div class="row">
        <div class="col">
            <div class="box">
                <h3 class="box-subtitle">SUFFOCATION:</h3>
                <ul>
                    <li><strong>Hold Breath:</strong> 1 + CON mod minutes (min. 30 sec). <em>Struggling in Barovia's choking fog or Strahd's grasp.</em></li>
                    <li><strong>Choking:</strong> +1 Exhaustion level/turn until air is restored. <em>Vampire spawn dragging victims underwater.</em></li>
                    <li><strong>Barovian Examples:</strong> Swamps of Berez, crypts beneath Castle Ravenloft, Strahd‚Äôs telekinetic strangulation.</li>
                </ul>
                
                <h3 class="box-subtitle">BURNING:</h3>
                <ul>
                    <li><strong>On Fire:</strong> 1d4 fire damage/start of turn until doused. <em>Flames spread unnaturally fast in Barovia.</em></li>
                    <li><strong>Dousing:</strong> Action to roll prone + DC 10 DEX check. <em>Panicked flailing rarely helps.</em></li>
                    <li><strong>Barovian Examples:</strong> Burning windmill in Vallaki, oil traps in the Amber Temple, <em>Wall of Fire</em> from Strahd‚Äôs spells.</li>
                </ul>

                <h3 class="box-subtitle">POISONOUS MISTS:</h3>
                <ul>
                    <li><strong>Inhaled Toxins:</strong> CON save DC 12 or take 1d6 poison damage and become Poisoned for 1 hour. <em>The land itself rejects the living.</em></li>
                    <li><strong>Barovian Examples:</strong> Death House‚Äôs basement, the swamps near Argynvostholt, Strahd‚Äôs cursed vineyards.</li>
                </ul>
            </div>
        </div>
        <div class="col">
            <div class="box">
                <h3 class="box-subtitle">FALLING:</h3>
                <ul>
                    <li><strong>Damage:</strong> 1d6 per 10 ft. (max 20d6). Prone if damage taken. <em>Ravenloft‚Äôs heights are unforgiving.</em></li>
                    <li><strong>Liquid Landing:</strong> Reaction DC 15 STR/DEX save to halve damage. <em>The River Ivlis is cold and treacherous.</em></li>
                    <li><strong>Barovian Examples:</strong> Ravenloft‚Äôs crumbling towers, elevator traps in the castle, the broken bridge to Tsolenka Pass.</li>
                </ul>
                
                <h3 class="box-subtitle">IMPROVISED DAMAGE:</h3>
                <ul>
                    <li><strong>Burning Coals:</strong> 5 (1d10) fire. <em>Baba Lysaga‚Äôs hearth or the Amber Temple‚Äôs braziers.</em></li>
                    <li><strong>Vat of Acid:</strong> 22 (4d10) acid. <em>The Abbot‚Äôs "experiments" or alchemical mishaps.</em></li>
                    <li><strong>Crushed by Rubble:</strong> 55 (10d10) bludgeoning. <em>Strahd collapsing a tunnel or animated statues.</em></li>
                    <li><strong>Barovian Examples:</strong> Falling chandeliers in Ravenloft‚Äôs dining hall, animated furniture in Death House.</li>
                </ul>

                <h3 class="box-subtitle">CURSED TERRAIN:</h3>
                <ul>
                    <li><strong>Bloodthorn Vines:</strong> 2d6 piercing damage per 5 ft. moved through. <em>The land hungers for blood.</em></li>
                    <li><strong>Haunted Ground:</strong> WIS save DC 13 or be Frightened. <em>Whispers of the dead rise from the soil.</em></li>
                    <li><strong>Barovian Examples:</strong> The Svalich Woods, the graveyard of Barovia Village, the ruins of Berez.</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Combat Quick Reference -->
<h2 class="section-title" id="combat">
    <div class="section-header">
        <span>COMBAT QUICK REFERENCE</span>
        <label class="print-selector">
            <input type="checkbox" class="section-checkbox" data-section="combat">
            
        </label>
    </div>
</h2>
<div class="collapsible-content">
    <div class="row">
        <div class="col">
            <div class="box">
                <h3 class="box-subtitle">ACTIONS IN COMBAT:</h3>
                <ul>
                    <li><strong>Grapple:</strong> STR/DEX vs. DC 8+PB+STR. Target must be ‚â§1 size larger. <em>Useful for vampire spawn dragging victims into shadows.</em></li>
                    <li><strong>Shove:</strong> Push 5 ft. or knock Prone (same DC). <em>Knock foes into Barovian pitfalls or off Ravenloft‚Äôs bridges.</em></li>
                    <li><strong>Ready:</strong> Prepare action/spell (requires Concentration). <em>Ambush Strahd‚Äôs minions from behind cover.</em></li>
                    <li><strong>Hide:</strong> DC 15 Stealth (must be obscured). Grants Invisible. <em>Barovia‚Äôs fog and ruins provide ample hiding spots.</em></li>
                    <li><strong>Disengage:</strong> Avoid opportunity attacks. <em>Essential for fleeing werewolves or swarms of bats.</em></li>
                    <li><strong>Dodge:</strong> Enemies have Disadv. on attacks vs you. <em>Survive Strahd‚Äôs multiattacks.</em></li>
                </ul>
                
                <h3 class="box-subtitle">COVER:</h3>
                <ul>
                    <li><strong>¬Ω Cover:</strong> +2 AC/DEX saves (tables, low walls). <em>Barovian tavern brawls or cemetery tombstones.</em></li>
                    <li><strong>¬æ Cover:</strong> +5 AC/DEX saves (arrow slits, dense fog). <em>Ravenloft‚Äôs arrow loops or mist-shrouded trees.</em></li>
                    <li><strong>Total Cover:</strong> Cannot be targeted (fully behind wall). <em>Peeking from behind castle pillars.</em></li>
                </ul>

                <h3 class="box-subtitle">UNDEAD TRAITS:</h3>
                <ul>
                    <li><strong>Turn Undead:</strong> Wis save or flee for 1 min (Cleric feature). <em>Zombies and ghosts recoil from holy symbols.</em></li>
                    <li><strong>Sunlight Hypersensitivity:</strong> Disadv. on attacks/checks in sunlight. <em>Strahd‚Äôs spawn burn in the (rare) Barovian sun.</em></li>
                    <li><strong>Regeneration:</strong> Some undead heal unless hit by radiant/fire. <em>Strahd laughs as wounds close in the gloom.</em></li>
                </ul>
            </div>
        </div>
        <div class="col">
            <div class="box">
                <h3 class="box-subtitle">CONDITION QUICK REFERENCE:</h3>
                <ul>
                    <li><strong>Restrained:</strong> Speed 0, Disadv. on attacks/DEX saves. <em>Webs in Berez or Strahd‚Äôs telekinesis.</em></li>
                    <li><strong>Invisible:</strong> Adv. on attacks, Disadv. vs. attacks. <em>Strahd‚Äôs favorite trick‚Äîstrike from nowhere.</em></li>
                    <li><strong>Frightened:</strong> Disadv. on checks/attacks; can‚Äôt move closer. <em>Strahd‚Äôs aura or a ghost‚Äôs terrifying visage.</em></li>
                    <li><strong>Charmed:</strong> Can‚Äôt harm the charmer, who has Adv. on social checks. <em>Strahd‚Äôs hypnotic gaze or a vampire‚Äôs seduction.</em></li>
                    <li><strong>Poisoned:</strong> Disadv. on attacks/checks. <em>Hag brews or swamp gases.</em></li>
                    <li><strong>Exhaustion:</strong> Cumulative penalties (death at Level 6). <em>Barovia‚Äôs oppressive dread wears you down.</em></li>
                </ul>
                
                <h3 class="box-subtitle">STRAHD-SPECIFIC TACTICS:</h3>
                <ul>
                    <li><strong>Hit-and-Run:</strong> Use <em>Invisibility</em> + <em>Grapple</em> (via minions). <em>Strahd toys with prey before striking.</em></li>
                    <li><strong>Environmental Kills:</strong> Shove PCs off cliffs (falling damage). <em>The castle‚Äôs heights are deadly.</em></li>
                    <li><strong>Charm:</strong> Target isolated PCs (Disadv. on saves in darkness). <em>Divide the party, then feast.</em></li>
                    <li><strong>Lair Actions:</strong> Animate objects, seal doors, or summon mist. <em>Ravenloft itself obeys Strahd‚Äôs will.</em></li>
                    <li><strong>Regeneration:</strong> Heals 20 HP/round unless in sunlight. <em>Holy water and radiant spells are key.</em></li>
                </ul>

                <h3 class="box-subtitle">BAROVIAN HAZARDS:</h3>
                <ul>
                    <li><strong>Misty Escape:</strong> Strahd turns to mist when reduced to 0 HP. <em>He reforms in his coffin‚Äîdestroy it to kill him.</em></li>
                    <li><strong>Soul Drain:</strong> Shadows/Wraiths reduce STR score. <em>Victims become hollow shells.</em></li>
                    <li><strong>Haunted Terrain:</strong> Animated vines, grasping hands. <em>The land itself hungers.</em></li>
                </ul>
            </div>
        </div>
    </div>
</div>
    
    <!-- Nightmares -->
    <h2 class="section-title" id="nightmares">
        <div class="section-header">
            <span>NIGHTMARES</span>
            <label class="print-selector">
                <input type="checkbox" class="section-checkbox" data-section="nightmares">
                
            </label>
        </div>
    </h2>
    <div class="collapsible-content">
        <div class="row">
            <div class="col">
                <div class="box">
                    <h3 class="box-title">NIGHTMARE MECHANICS</h3>
                    <p>If below <span class="tooltip">50% HP<span class="tooltiptext">When current hit points are less than half your maximum hit points.</span></span> or <span class="tooltip">exhausted<span class="tooltiptext">Exhaustion has 6 levels with cumulative effects, from disadvantage on ability checks to death.</span></span> before a long rest, make WIS save or gain nightmare effect and only restore half HP normally recovered.</p>
                    
                    <h3 class="box-subtitle">SHARED NIGHTMARES:</h3>
                    <p>When multiple party members fail saves:</p>
                    <ul>
                        <li>They experience the same nightmare together</li>
                        <li>Can interact with each other in the dream</li>
                        <li>Damage taken is psychic (1d6 per "death" in dream)</li>
                        <li>Solving the nightmare's puzzle grants full rest benefits</li>
                    </ul>
                    
                    <h3 class="box-subtitle">WEAPONIZING NIGHTMARES:</h3>
                    <p>Characters can attempt to:</p>
                    <ol>
                        <li><strong>Lucid Dreaming:</strong> WIS check to control aspects of nightmare</li>
                        <li><strong>Nightmare Fuel:</strong> Channel terror into attacks (+1d6 psychic damage next day)</li>
                        <li><strong>Prophetic Visions:</strong> INT check to gain clues from nightmares</li>
                        <li><strong>Dream Walking:</strong> Visit other creatures' dreams with CHA save</li>
                    </ol>
                </div>
            </div>
            <div class="col">
                <div class="box">
                    <h3 class="box-title">NIGHTMARE CONSEQUENCES</h3>
                    <p>Failed saves vs nightmares cause lingering effects:</p>
                    
                    <h3 class="box-subtitle">WAKING EFFECTS (d8): <button class="roll-button" onclick="rollDice('1d8')">Roll</button></h3>
                    <ol>
                        <li><strong>Exhaustion:</strong> Gain 1 level that can't be removed until next sunset</li>
                        <li><strong>Phantom Pain:</strong> Random limb hurts (-5ft speed or disadvantage with that limb)</li>
                        <li><strong>Dream Leakage:</strong> Objects from dream appear in inventory</li>
                        <li><strong>Nightmare Mark:</strong> Physical change matching dream (scar, white streak in hair)</li>
                        <li><strong>Echoes:</strong> Occasionally hear nightmare sounds while awake</li>
                        <li><strong>Sleep Fear:</strong> Next long rest requires CON save or only short rest benefits</li>
                        <li><strong>Empathic Dread:</strong> Nearby allies have disadvantage on next fear save</li>
                        <li><strong>Reality Warp:</strong> Minor detail from dream changes in real world</li>
                    </ol>
                    
                    <h3 class="box-subtitle">NIGHTMARE ITEMS (d6): <button class="roll-button" onclick="rollDice('1d6')">Roll</button></h3>
                    <p>Objects that appear after nightmares:</p>
                    <ol>
                        <li><strong>Black Rose:</strong> Crumbles to dust at sunset</li>
                        <li><strong>Child's Drawing:</strong> Depicts a future tragedy</li>
                        <li><strong>Broken Mirror:</strong> Shows reflections doing things you didn't do</li>
                        <li><strong>Bloody Bandage:</strong> Always damp with fresh blood</li>
                        <li><strong>Old Key:</strong> Fits a lock somewhere in Barovia</li>
                        <li><strong>Music Box:</strong> Plays a haunting lullaby when opened</li>
                    </ol>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col">
                <div class="box">
                    <h3 class="box-title">NIGHTMARE TABLE (d20): <button class="roll-button" onclick="rollDice('1d20')">Roll</button></h3>
                    <ol>
                        <li><strong>Pursued by Wolves:</strong> You're running through endless woods as a pack of wolves closes in, their hot breath on your neck.</li>
                        <li><strong>Family Slayer:</strong> You murder your own family members one by one, waking just as your blade strikes the last.</li>
                        <li><strong>Torture Chamber:</strong> Your loved ones torture you for hours with rusty implements, their faces twisted in glee.</li>
                        <li><strong>Sleep Paralysis:</strong> Demons sit on your chest, carving symbols into your flesh while you can't move or scream.</li>
                        <li><strong>Zombie Transformation:</strong> You're devoured by zombies piece by piece, then wake up feeling your body still changing.</li>
                        <li><strong>Body Horror:</strong> Your teeth keep growing uncontrollably, piercing through your cheeks and lips.</li>
                        <li><strong>Insect Infestation:</strong> Your skin crawls with insects that burrow into your flesh, laying eggs beneath.</li>
                        <li><strong>Buried Alive:</strong> You wake in a coffin underground, pounding on the lid as dirt fills your mouth.</li>
                        <li><strong>Doppelg√§nger:</strong> An exact double of you murders your companions while they beg you for help.</li>
                        <li><strong>Endless Falling:</strong> You plunge endlessly through fog, seeing shadowy figures watching your descent.</li>
                        <li><strong>Feast of Flesh:</strong> You're served a delicious meal that turns out to be human flesh - and you keep eating.</li>
                        <li><strong>Drowning in Blood:</strong> You're submerged in a lake of blood that fills your lungs with each gasp.</li>
                        <li><strong>Skin Peeling:</strong> Your skin begins sloughing off in sheets, revealing muscle beneath.</li>
                        <li><strong>Eyes Everywhere:</strong> Eyes open all over your body, all weeping black tears.</li>
                        <li><strong>Clockwork Heart:</strong> Your heart is replaced with a ticking clock that slows... and stops.</li>
                        <li><strong>Mirror Self:</strong> Your reflection steps out of the mirror and strangles you.</li>
                        <li><strong>Vampire Bride:</strong> Strahd turns you into a spawn, forcing you to hunt your own party.</li>
                        <li><strong>Living Doll:</strong> You shrink to doll size while spiders carry you to their web.</li>
                        <li><strong>Eternal Funeral:</strong> You attend your own funeral daily, watching your corpse decay over time.</li>
                        <li><strong>The Dark Gift:</strong> A shadowy entity offers you great power in exchange for your soul - and you accept.</li>
                    </ol>
                </div>
            </div>
            <div class="col">
                <div class="box">
                    <h3 class="box-title">SOLVING NIGHTMARES</h3>
                    <p>Shared nightmares can be solved cooperatively:</p>
                    
                    <h3 class="box-subtitle">NIGHTMARE SOLUTIONS (d6): <button class="roll-button" onclick="rollDice('1d6')">Roll</button></h3>
                    <ol>
                        <li><strong>Confrontation:</strong> Face the nightmare's source directly</li>
                        <li><strong>Acceptance:</strong> Embrace the horror to dispel its power</li>
                        <li><strong>Symbolic Act:</strong> Perform an action that "breaks the dream logic"</li>
                        <li><strong>Sacrifice:</strong> Give up something important to escape</li>
                        <li><strong>Awakening Another:</strong> Find and wake another party member in the dream</li>
                        <li><strong>Reality Anchor:</strong> Focus on a real-world memory or object</li>
                    </ol>
                    
                    <h3 class="box-subtitle">NIGHTMARE REWARDS:</h3>
                    <p>Solving nightmares grants:</p>
                    <ul>
                        <li>Full rest benefits despite initial failure</li>
                        <li>1d4 temporary hit points from adrenaline</li>
                        <li>Clues about Barovia's secrets</li>
                        <li>Resistance to psychic damage for 24 hours</li>
                        <li>1 Hope Point per participant</li>
                    </ul>
                    
                    <h3 class="box-subtitle">STRAHD'S NIGHTMARE INTRUSION:</h3>
                    <p>When rolling for nightmares, on a 1:</p>
                    <ul>
                        <li>Strahd appears in the nightmare</li>
                        <li>He offers cryptic advice or temptations</li>
                        <li>May plant false memories or suggestions</li>
                        <li>Characters remember these encounters vividly</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Corruption System -->
    <h2 class="section-title" id="corruption">
        <div class="section-header">
            <span>CORRUPTION</span>
            <label class="print-selector">
                <input type="checkbox" class="section-checkbox" data-section="corruption">
                
            </label>
        </div>
    </h2>
    <div class="collapsible-content">
        <div class="row">
            <div class="col">
                <div class="box">
                    <h3 class="box-title">CORRUPTION MECHANICS</h3>
                    <p>Track Corruption Points (CP) when characters:</p>
                    <ul>
                        <li>Use dark powers or forbidden magic</li>
                        <li>Accept Strahd's gifts or deals</li>
                        <li>Commit evil acts "for the greater good"</li>
                        <li>Spend extended time in corrupted areas</li>
                        <li>Fail saves against supernatural corruption</li>
                    </ul>
                    
                    <h3 class="box-subtitle">CORRUPTION EFFECTS:</h3>
                    <div class="table-header">
                        <div class="table-col-1">CP</div>
                        <div class="table-col-2">EFFECT</div>
                    </div>
                    <div class="box-row">
                        <div class="table-col-1">1-3</div>
                        <div class="table-col-2">Minor physical changes, bad dreams</div>
                    </div>
                    <div class="box-row">
                        <div class="table-col-1">4-6</div>
                        <div class="table-col-2">Disadvantage on saves vs dark gifts</div>
                    </div>
                    <div class="box-row">
                        <div class="table-col-1">7-9</div>
                        <div class="table-col-2">NPCs react with unease, animals avoid you</div>
                    </div>
                    <div class="box-row">
                        <div class="table-col-1">10+</div>
                        <div class="table-col-2">Risk of transformation, dark powers intervene</div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="box">
                    <h3 class="box-title">PHYSICAL CORRUPTION</h3>
                    <p>At 3, 6, and 9 CP, roll for physical changes:</p>
                    
                    <h3 class="box-subtitle">CORRUPTION MANIFESTATIONS (d12): <button class="roll-button" onclick="rollDice('1d12')">Roll</button></h3>
                    <ol>
                        <li><strong>Eyes:</strong> Pupils become slitted or solid black</li>
                        <li><strong>Skin:</strong> Pale with visible veins or patchy scales</li>
                        <li><strong>Teeth:</strong> Sharpen slightly, gums darken</li>
                        <li><strong>Hands:</strong> Nails darken and harden into claws</li>
                        <li><strong>Shadow:</strong> Moves independently occasionally</li>
                        <li><strong>Voice:</strong> Gains a subtle echo or hiss</li>
                        <li><strong>Hair:</strong> Streaks of white or black appear</li>
                        <li><strong>Reflection:</strong> Sometimes shows a twisted version</li>
                        <li><strong>Temperature:</strong> Body runs colder than normal</li>
                        <li><strong>Scarring:</strong> Mysterious scars appear overnight</li>
                        <li><strong>Blood:</strong> Darker and thicker than normal</li>
                        <li><strong>Scent:</strong> Carry a faint odor of earth and copper</li>
                    </ol>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col">
                <div class="box">
                    <h3 class="box-title">DARK GIFTS</h3>
                    <p>At 10+ CP, dark powers offer gifts:</p>
                    
                    <h3 class="box-subtitle">DARK GIFTS TABLE (d8): <button class="roll-button" onclick="rollDice('1d8')">Roll</button></h3>
                    <ol>
                        <li><strong>Vampiric Hunger:</strong> Heal 1d6 HP when you deal killing blow to living humanoid. Lose 1 max HP/day until you feed.</li>
                        <li><strong>Shadow Pact:</strong> Gain <em>Misty Step</em> 1/day. Each use turns your eyes blacker permanently.</li>
                        <li><strong>Hag's Deal:</strong> Advantage on INT saves. Your laughter occasionally sounds like a hag's cackle.</li>
                        <li><strong>Werewolf's Fury:</strong> +2 damage to melee attacks. Moonlight reveals your eyes glow amber.</li>
                        <li><strong>Ghostly Whispers:</strong> Understand all languages. Hear distant sobbing when alone.</li>
                        <li><strong>Strahd's Favor:</strong> +1 to CHA saves. Your shadow sometimes moves independently.</li>
                        <li><strong>Lich's Knowledge:</strong> +1 to spell DCs. Your skin becomes unnaturally cold.</li>
                        <li><strong>Revenant's Purpose:</strong> Return to life 1/day at 1 HP if killed. Your wounds never fully heal.</li>
                    </ol>
                    
                    <h3 class="box-subtitle">GIFT CONSEQUENCES:</h3>
                    <ul>
                        <li>Each gift adds 1d4 CP immediately</li>
                        <li>Additional gifts add +1 CP per existing gift</li>
                        <li>At 15 CP, risk losing control to dark powers</li>
                        <li>At 20 CP, transformation into monster begins</li>
                    </ul>
                </div>
            </div>
            <div class="col">
                <div class="box">
                    <h3 class="box-title">REDEMPTION</h3>
                    <p>Ways to reduce Corruption Points:</p>
                    
                    <h3 class="box-subtitle">REDEMPTION ACTS:</h3>
                    <ul>
                        <li><strong>Selfless Sacrifice:</strong> Lose 1d4 CP (risk life for others)</li>
                        <li><strong>Holy Ritual:</strong> Lose 1 CP (requires holy site and offering)</li>
                        <li><strong>Rejecting Power:</strong> Lose 2 CP (refuse dark gift when offered)</li>
                        <li><strong>Atonement Quest:</strong> Lose all CP (major story achievement)</li>
                    </ul>
                    
                    <h3 class="box-subtitle">REDEMPTION CONSEQUENCES:</h3>
                    <ul>
                        <li>Physical changes fade slowly</li>
                        <li>Dark powers may retaliate</li>
                        <li>Strahd takes special notice</li>
                        <li>Some abilities may be lost</li>
                    </ul>
                    
                    <h3 class="box-subtitle">FINAL CORRUPTION:</h3>
                    <p>At 20 CP, the character:</p>
                    <ol>
                        <li>Becomes an NPC under DM control</li>
                        <li>Transforms into appropriate monster</li>
                        <li>Gains final dark gift before turning</li>
                        <li>May return as a villain later</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Weather System -->
    <h2 class="section-title" id="weather">
        <div class="section-header">
            <span>WEATHER</span>
            <label class="print-selector">
                <input type="checkbox" class="section-checkbox" data-section="weather">
                
            </label>
        </div>
    </h2>
    <div class="collapsible-content">
        <div class="row">
            <div class="col">
                <div class="box">
                    <h3 class="box-title">WEATHER MECHANICS</h3>
                    <p>Roll weather 1d3 times per day (morning/afternoon/evening):</p>
                    
                    <h3 class="box-subtitle">WEATHER TABLE (d20): <button class="roll-button" onclick="rollDice('1d20')">Roll</button></h3>
                    <table>
                        <tr><th>Roll</th><th>Weather</th><th>Effects</th></tr>
                        <tr><td>1-5</td><td>Thick Fog</td><td>Disadvantage on Perception, -20ft visibility</td></tr>
                        <tr><td>6-8</td><td>Light Rain</td><td>Everything damp, fires harder to light</td></tr>
                        <tr><td>9-10</td><td>Heavy Rain</td><td>Disadvantage on hearing Perception, -10ft movement</td></tr>
                        <tr><td>11-12</td><td>Thunderstorm</td><td>Disadvantage on Concentration, animals skittish</td></tr>
                        <tr><td>13</td><td>Blood Rain</td><td>1d4 psychic damage per hour exposed, stains everything</td></tr>
                        <tr><td>14</td><td>Ash Fall</td><td>Air fills with choking ash (CON save or cough)</td></tr>
                        <tr><td>15</td><td>Unnatural Stillness</td><td>No wind, sounds carry farther, uneasy feeling</td></tr>
                        <tr><td>16</td><td>Bone-chilling Cold</td><td>CON save each hour or gain 1 level of exhaustion</td></tr>
                        <tr><td>17</td><td>Wailing Wind</td><td>Hear whispers in the wind (WIS save or frightened)</td></tr>
                        <tr><td>18</td><td>Strange Eclipse</td><td>Sun/moon turns red, spells cast at -1 level</td></tr>
                        <tr><td>19</td><td>Shadow Storm</td><td>Darkness spell effect in random 30ft areas</td></tr>
                        <tr><td>20</td><td>Strahd's Wrath</td><td>Roll twice and combine effects</td></tr>
                    </table>
                </div>
            </div>
            <div class="col">
                <div class="box">
                    <h3 class="box-title">WEATHER INTERACTIONS</h3>
                    <p>Special weather effects:</p>
                    
                    <h3 class="box-subtitle">MAGICAL WEATHER EFFECTS:</h3>
                    <ul>
                        <li><strong>Blood Rain:</strong> Can be collected for necromantic rituals</li>
                        <li><strong>Ash Fall:</strong> May contain fragments of past victims</li>
                        <li><strong>Wailing Wind:</strong> Sometimes carries actual voices</li>
                        <li><strong>Shadow Storm:</strong> Shadows may detach and move independently</li>
                    </ul>
                    
                    <h3 class="box-subtitle">STRAHD'S MOOD:</h3>
                    <p>Weather reflects Strahd's emotional state:</p>
                    <div class="table-header">
                        <div class="table-col-1">Mood</div>
                        <div class="table-col-2">Weather</div>
                    </div>
                    <div class="box-row">
                        <div class="table-col-1">Bored</div>
                        <div class="table-col-2">Thick Fog</div>
                    </div>
                    <div class="box-row">
                        <div class="table-col-1">Angry</div>
                        <div class="table-col-2">Thunderstorm</div>
                    </div>
                    <div class="box-row">
                        <div class="table-col-1">Amused</div>
                        <div class="table-col-2">Unnatural Stillness</div>
                    </div>
                    <div class="box-row">
                        <div class="table-col-1">Melancholic</div>
                        <div class="table-col-2">Light Rain</div>
                    </div>
                    <div class="box-row">
                        <div class="table-col-1">Vengeful</div>
                        <div class="table-col-2">Blood Rain</div>
                    </div>
                    
                    <h3 class="box-subtitle">WEATHER MAGIC:</h3>
                    <p>Control Weather spells in Barovia:</p>
                    <ul>
                        <li>DC increases by 5</li>
                        <li>Lasts half as long</li>
                        <li>10% chance Strahd counters it</li>
                        <li>May attract his attention</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

<!-- Mundane Light Sources -->
<h2 class="section-title" id="light">
    <div class="section-header">
        <span>MUNDANE LIGHT SOURCE</span>
        <label class="print-selector">
            <input type="checkbox" class="section-checkbox" data-section="light">
             
        </label>
    </div>
</h2>
<div class="collapsible-content">
    <div class="box">
        <h3 class="box-title">LIGHT SOURCE TABLE</h3>
        <table>
            <tr>
                <th>Item</th>
                <th>Bright (Dim) Radius</th>
                <th>Duration</th>
                <th>Description</th>
                <th>Barovian Notes</th>
            </tr>
            
            <!-- Candle -->
            <tr>
                <td><strong>Candle</strong></td>
                <td>5 ft. (5 ft.)</td>
                <td>1 hour</td>
                <td>A flickering flame barely holding back the oppressive dark. Wax drips like tears.</td>
                <td><em>Whispers:</em> In Barovia, candles sometimes gutter out inexplicably when Strahd is near.</td>
            </tr>
            
            <!-- Torch -->
            <tr>
                <td><strong>Torch</strong></td>
                <td>20 ft. (20 ft.)</td>
                <td>1 hour</td>
                <td>A resin-soaked brand casting dancing shadows. Smoke stings the eyes.</td>
                <td><em>Dread:</em> Wolves are drawn to torchlight. Roll for random encounters at +2.</td>
            </tr>
            
            <!-- Hooded Lantern -->
            <tr>
                <td><strong>Lantern (Hooded)</strong></td>
                <td>30 ft. (30 ft.)</td>
                <td>6 hours</td>
                <td>A shuttered beacon, its glow steady but feeble against the mist.</td>
                <td><em>Safe Haven:</em> Vistani caravans use these to mark safe paths. Others might attract hags.</td>
            </tr>
            
            <!-- Bullseye Lantern -->
            <tr>
                <td><strong>Lantern (Bullseye)</strong></td>
                <td>60 ft. cone (60 ft.)</td>
                <td>6 hours</td>
                <td>A focused beam piercing the fog like a blade. Leaves the periphery darker.</td>
                <td><em>Trade-off:</em> Advantage to spot threats ahead, but Disadvantage to notice ambushes from the sides.</td>
            </tr>
            
            <!-- Oil Flask -->
            <tr>
                <td><strong>Oil Flask (poured & lit)</strong></td>
                <td>10 ft. (10 ft.)</td>
                <td>6 rounds</td>
                <td>A desperate, sputtering fire. Burns hot but brief.</td>
                <td><em>Last Resort:</em> The screams of burning oil mimic those of Strahd‚Äôs past victims.</td>
            </tr>
            
            <!-- New: Bonefire (Homebrew) -->
            <tr>
                <td><strong>Bonefire</strong> (improvised)</td>
                <td>15 ft. (15 ft.)</td>
                <td>2 hours</td>
                <td>A pyre of dried bones and rags. Burns with a sickly green hue.</td>
                <td><em>Dark Power:</em> 1-in-6 chance each hour to attract a specter or will-o‚Äô-wisp.</td>
            </tr>
            
            <!-- New: Church Candle -->
            <tr>
                <td><strong>Church Candle</strong> (blessed)</td>
                <td>10 ft. (10 ft.)</td>
                <td>3 hours</td>
                <td>Wax infused with incense. The flame resists supernatural winds.</td>
                <td><em>Sacred:</em> Undead avoid its light unless commanded by Strahd (WIS save DC 13 to approach).</td>
            </tr>
        </table>
        
        <div class="box-subtitle" style="margin-top: 15px;">
            <h3>BAROVIAN LIGHT RULES</h3>
            <ul>
                <li><strong>The Mists:</strong> Dim light becomes heavily obscured beyond 30 ft.</li>
                <li><strong>Strahd‚Äôs Presence:</strong> All non-magical light sources flicker (10% chance to extinguish) when he watches.</li>
                <li><strong>Fuel Scarcity:</strong> Torches/oil cost 5x normal price in Vallaki.</li>
            </ul>
        </div>
    </div>
</div>

<!-- Exhaustion -->
<h2 class="section-title" id="exhaustion">
    <div class="section-header">
        <span>EXHAUSTION TRACKER</span>
        <label class="print-selector">
            <input type="checkbox" class="section-checkbox" data-section="exhaustion">
             
        </label>
    </div>
</h2>
<div class="collapsible-content">
    <div class="row">
        <div class="col">
            <div class="box">
                <h3 class="box-subtitle">EXHAUSTION LEVELS:</h3>
                <table class="exhaustion-table">
                    <thead>
                        <tr>
                            <th>Level</th>
                            <th>d20 Test Penalty</th>
                            <th>Speed Reduction</th>
                            <th>Barovian Effects</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>-2</td>
                            <td>-5 ft.</td>
                            <td><em>Whispers of the Land:</em> Disadv. on Perception to hear Strahd‚Äôs spies.</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>-4</td>
                            <td>-10 ft.</td>
                            <td><em>Mists Close In:</em> -5 passive Perception; shadows seem to move.</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>-6</td>
                            <td>-15 ft.</td>
                            <td><em>Bone-deep Fatigue:</em> Disadv. on saves vs. Charm/Frighten.</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>-8</td>
                            <td>-20 ft.</td>
                            <td><em>Hollow Eyes:</em> NPCs react with fear (Disadv. on Persuasion).</td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td>-10</td>
                            <td>-25 ft.</td>
                            <td><em>Death‚Äôs Shadow:</em> Strahd gains Adv. on attack rolls vs. you.</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td colspan="2"><strong>Death</strong></td>
                            <td><em>The Dark Powers Claim You:</em> Rises as a zombie/spawn at dusk.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col">
            <div class="box">
                <h3 class="box-subtitle">HOW DO YOU BECOME EXHAUSTED?</h3>
                <ul>
                    <li><strong>Starvation:</strong> 5+ days without food (+1 level/day).</li>
                    <li><strong>Dehydration:</strong> 1 day without water (+1 level/day).</li>
                    <li><strong>Forced March:</strong> Traveling >8 hours/day (DC 10 CON save or +1 level).</li>
                    <li><strong>Barovian Mists:</strong> Spending a night outdoors (no shelter).</li>
                    <li><strong>Strahd‚Äôs Curse:</strong> Failed save vs. <em>Nightmare Haunting</em> (see <em>Dream Pastry</em> addiction).</li>
                </ul>
                
                <h3 class="box-subtitle">RECOVERY:</h3>
                <ul>
                    <li><strong>Long Rest:</strong> -1 level (if eating/drinking).</li>
                    <li><strong>Greater Restoration:</strong> Removes all levels.</li>
                    <li><strong>Abbot‚Äôs Blessing:</strong> Rare boon (costs a Dark Gift).</li>
                    <li><strong>Hope Points:</strong> 3 points remove 1 level.</li>
                </ul>
                
                <h3 class="box-subtitle">BAROVIAN TWISTS:</h3>
                <ul>
                    <li><em>Strahd‚Äôs Game:</em> At Exhaustion 3+, he may offer "aid" (with strings attached).</li>
                    <li><em>Vistani "Help":</em> Their cures might add Madness (DMG p.259).</li>
                    <li><em>Dark Powers:</em> At death, offer resurrection‚Äîwith a price.</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Foraging & Starvation Rules -->
<h2 class="section-title" id="foraging">
    <div class="section-header">
        <span>FORAGING & STARVATION</span>
        <label class="print-selector">
            <input type="checkbox" class="section-checkbox" data-section="foraging">
             
        </label>
    </div>
</h2>
<div class="collapsible-content">
    <div class="box">
        <h3 class="box-title">FORAGING IN BAROVIA</h3>
        <table>
            <tr><th>Terrain</th><th>DC</th><th>Barovian Examples</th><th>Yield (Success)</th></tr>
            <tr><td><strong>Sallow Fields</strong> (mud/snow)</td><td>10</td><td>Blighted farms, thawing riverbanks</td><td>1d6 + WIS mod lbs (rotten veggies, grubs)</td></tr>
            <tr><td><strong>Wolfwoods</strong> (dirt/grass)</td><td>15</td><td>Gnarled forests, haunted glades</td><td>1d4 + WIS mod lbs (bitter herbs, crow meat)</td></tr>
            <tr><td><strong>Ravenloft's Shadow</strong> (bare stone)</td><td>20</td><td>Castle outskirts, mountain passes</td><td>1 lb (lichen, rat bones)</td></tr>
        </table>
        
        <h3 class="box-subtitle">CURSED HARVEST (Special Rules)</h3>
        <ul>
            <li><strong>Roll 1d6 when foraging:</strong> On a 1, food is tainted (DC 12 CON or poisoned for 1d4 hours).</li>
            <li><strong>Vistani Aid:</strong> DC 15 Persuasion to trade for safe food (1 GP/day worth).</li>
            <li><strong>Strahd's Mockery:</strong> After 3 failed foraging checks, wolves "gift" a corpse (cursed meat?).</li>
        </ul>
        
        <h3 class="box-subtitle">STARVATION EFFECTS</h3>
        <table>
            <tr><th>Condition</th><th>Effect</th><th>Barovian Flaw</th></tr>
            <tr><td><strong>Half-Rations</strong> (&lt;¬Ω food/day)</td><td>DC 10 CON save or +1 Exhaustion</td><td>"I'd kill for a scrap of bread."</td></tr>
            <tr><td><strong>Fasting</strong> (5+ days no food)</td><td>Auto +1 Exhaustion/day</td><td>"The hunger... whispers to me."</td></tr>
            <tr><td><strong>Dehydrated</strong> (&lt;¬Ω water/day)</td><td>+1 Exhaustion/day until full</td><td>"I see mirages of blood-red wine."</td></tr>
            <tr><td><strong>Exhaustion 3+</strong></td><td>Disadv. on saves vs. Strahd's Charm</td><td>"Maybe he's right... we belong to him."</td></tr>
        </table>
        
        <h3 class="box-subtitle">DESPERATION ACTIONS</h3>
        <ul>
            <li><strong>Eat Questionable Meat:</strong> DC 15 WIS save or gain 1d4 Hope Points but suffer 1d6 necrotic damage.</li>
            <li><strong>Steal from the Dead:</strong> Advantage on foraging checks in graveyards... but attract revenants.</li>
            <li><strong>Bargain with Hags:</strong> 1 day of food = 1 "favor" (teeth, memories, etc.).</li>
        </ul>
    </div>
</div>

<!-- Cover Table -->
<h2 class="section-title" id="cover">
    <div class="section-header">
        <span>COVER</span>
        <label class="print-selector">
            <input type="checkbox" class="section-checkbox" data-section="cover">
             
        </label>
    </div>
</h2>
<div class="collapsible-content">
    <div class="box">
        <h3 class="box-title">COVER TYPES</h3>
        <table>
            <tr>
                <th>Type</th>
                <th>Effect</th>
                <th>Barovian Examples</th>
                <th>Rules Notes</th>
            </tr>
            <tr>
                <td><strong>Half Cover</strong></td>
                <td>+2 to AC and Dex saves</td>
                <td>
                    <ul>
                        <li>Crumbling gravestones</li>
                        <li>Fallen trees</li>
                        <li>Low castle parapets</li>
                        <li>Market stalls (Vallaki)</li>
                    </ul>
                </td>
                <td>Partial obstruction (e.g., 50% of body exposed).</td>
            </tr>
            <tr>
                <td><strong>Three-Quarters Cover</strong></td>
                <td>+5 to AC and Dex saves</td>
                <td>
                    <ul>
                        <li>Arrow slits in Ravenloft</li>
                        <li>Dense fog patches</li>
                        <li>Barricaded church pews</li>
                        <li>Iron gates (peering through bars)</li>
                    </ul>
                </td>
                <td>Most of body hidden (e.g., only 25% exposed).</td>
            </tr>
            <tr>
                <td><strong>Total Cover</strong></td>
                <td>Cannot be targeted directly</td>
                <td>
                    <ul>
                        <li>Behind solid stone walls</li>
                        <li>Inside coffins</li>
                        <li>Teleported to Strahd's pocket dimension</li>
                        <li>Magical darkness (if blinded)</li>
                    </ul>
                </td>
                <td>Fully obscured. AoE spells may still affect.</td>
            </tr>
            <tr>
                <td><strong>Barovian "False" Cover</strong> (DM Tip)</td>
                <td>None (trap!)</td>
                <td>
                    <ul>
                        <li>Illusory walls (Strahd's trickery)</li>
                        <li>Animated furniture that moves</li>
                        <li>Mists that part to reveal enemies</li>
                    </ul>
                </td>
                <td>Perception check (DC 15) to detect deception.</td>
            </tr>
        </table>

        <h3 class="box-subtitle">COVER STRATEGIES IN BAROVIA</h3>
        <div class="row">
            <div class="col">
                <ul>
                    <li><strong>Vampires:</strong> Use <em>total cover</em> (coffins/mists) to regenerate.</li>
                    <li><strong>PCs:</strong> Barricade doors with <em>three-quarters cover</em> vs. spawn.</li>
                    <li><strong>Strahd:</strong> Lures PCs into <em>half cover</em> positions for ambushes.</li>
                </ul>
            </div>
            <div class="col">
                <ul>
                    <li><strong>Werewolves:</strong> Leap over <em>half cover</em> with 10 ft. jumps.</li>
                    <li><strong>Hags:</strong> Hide behind <em>illusory cover</em> (false walls).</li>
                    <li><strong>Wintersplinter:</strong> Ignores cover with roots/tremorsense.</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Conditions Quick-Ref -->
<h2 class="section-title" id="conditions">
    <div class="section-header">
        <span>CONDITIONS</span>
        <label class="print-selector">
            <input type="checkbox" class="section-checkbox" data-section="conditions">
             
        </label>
    </div>
</h2>
<div class="collapsible-content">
    <div class="box">
        <h3 class="box-title">SELECT CONDITIONS</h3>
        <table>
            <tr><th>Condition</th><th>Effect</th><th>Barovian Example</th></tr>
            
            <tr><td><strong>Blinded</strong></td><td>Can‚Äôt see; fails sight-based checks. Disadv. on attacks, adv. vs. attacks.</td><td>Strahd‚Äôs <em>Greater Invisibility</em>, Barovian fog.</td></tr>
            
            <tr><td><strong>Charmed</strong></td><td>Can‚Äôt harm charmer; charmer has adv. on social checks.</td><td>Strahd‚Äôs <em>Charm</em>, vampire spawn seduction.</td></tr>
            
            <tr><td><strong>Exhaustion</strong></td><td>Cumulative penalties: ‚àí2 to d20 rolls, ‚àí5 ft. speed/level. Death at Level 6.</td><td>Forced marches, starvation, <em>Dream Pastry</em> withdrawal.</td></tr>
            
            <tr><td><strong>Frightened</strong></td><td>Disadv. on checks/attacks; can‚Äôt move closer to source.</td><td>Strahd‚Äôs presence, ghostly wails, werewolf howls.</td></tr>
            
            <tr><td><strong>Grappled</strong></td><td>Speed = 0. Escape with STR/DEX vs. DC.</td><td>Vampire spawn grabs, animated armor restraints.</td></tr>
            
            <tr><td><strong>Incapacitated</strong></td><td>No actions, reactions, or concentration.</td><td><em>Sleep</em> spells, paralytic poisons.</td></tr>
            
            <tr><td><strong>Invisible</strong></td><td>Adv. on attacks, disadv. vs. attacks. Can‚Äôt be targeted by sight.</td><td>Strahd‚Äôs mist form, <em>Invisibility</em> spells.</td></tr>
            
            <tr><td><strong>Paralyzed</strong></td><td>Incapacitated + auto-fail STR/DEX saves. Melee hits crit.</td><td>Ghoul claws, <em>Hold Person</em>.</td></tr>
            
            <tr><td><strong>Poisoned</td><td>Disadv. on attacks and ability checks.</td><td>Hag brews, swamp gases, assassin‚Äôs venom.</td></tr>
            
            <tr><td><strong>Prone</strong></td><td>Disadv. on attacks; adv. vs. melee attacks.</td><td>Shoved by zombies, slippery crypt floors.</td></tr>
            
            <tr><td><strong>Restrained</strong></td><td>Speed = 0, disadv. on attacks/DEX saves, adv. vs. attacks.</td><td>Vine blights, <em>Web</em> spells.</td></tr>
            
            <tr><td><strong>Stunned</strong></td><td>Incapacitated + auto-fail STR/DEX saves. Adv. vs. attacks.</td><td>Mind flayer psionics, <em>Power Word Stun</em>.</td></tr>
            
            <tr><td><strong>Unconscious</strong></td><td>Incapacitated, prone, drops held items. Melee hits crit.</td><td>Knocked out by Strahd, <em>Sleep</em> spells.</td></tr>
        </table>
    </div>
</div>

<!-- Food Prices Table -->
<h2 class="section-title" id="food">
    <div class="section-header">
        <span>FOOD PRICES</span>
        <label class="print-selector">
            <input type="checkbox" class="section-checkbox" data-section="food">
             
        </label>
    </div>
</h2>
<div class="collapsible-content">
    <div class="row">
        <div class="col">
            <div class="box">
                <h3 class="box-title">BAROVIAN MEALS (QUESTIONABLE FOOD)</h3>
                <table>
                    <tr><th>Item</th><th>Normal Cost</th><th>Barovian Cost</th><th>Notes</th></tr>
                    <tr><td>Moldy Bread (loaf)</td><td>2 cp</td><td>1 sp</td><td class="text-danger">Disadvantage on CON save vs. disease</td></tr>
                    <tr><td>Rat Meat (chunk)</td><td>3 sp</td><td>8 sp</td><td class="text-danger">DC 12 CON save or poisoned for 1 hour</td></tr>
                    <tr><td>Water (pitcher)</td><td>Free</td><td>5 cp</td><td class="text-danger">50% chance tainted (see <a href="#despair">Despair</a>)</td></tr>
                    <tr><td>"Wine" (vinegar)</td><td>2 sp</td><td>1 gp</td><td class="text-warning">No intoxication, tastes like despair</td></tr>
                    <tr><td>Hag's Stew (bowl)</td><td>‚Äî</td><td>2 gp</td><td class="text-danger">Cursed: -1d4 max HP until Remove Curse</td></tr>
                    <tr><td>Vistani Provisions</td><td>Modest (1 sp)</td><td>5 gp</td><td class="text-success">Safe, but sold only to allies</td></tr>
                </table>
                <p class="text-muted"><em>Prices double in Vallaki during festivals or shortages.</em></p>
            </div>
            
            <!-- NEW TABLE: EDIBLE BUT POOR QUALITY FOOD -->
            <div class="box" style="margin-top: 20px;">
                <h3 class="box-title">EDIBLE BUT DREARY FARE</h3>
                <table>
                    <tr><th>Item</th><th>Cost</th><th>Description</th></tr>
                    <tr><td>Gruel</td><td>3 cp</td><td>Thin oat porridge that sticks to the ribs like paste</td></tr>
                    <tr><td>Hardtack</td><td>1 cp each</td><td>Rock-hard biscuits that taste vaguely of dust</td></tr>
                    <tr><td>Root Soup</td><td>5 cp</td><td>Mud-colored broth with floating turnip chunks</td></tr>
                    <tr><td>Salt Pork</td><td>2 sp</td><td>Over-salted meat that leaves you desperately thirsty</td></tr>
                    <tr><td>Barley Bread</td><td>4 cp</td><td>Dense loaf with visible husks, lasts weeks without molding</td></tr>
                    <tr><td>Pickled Eggs</td><td>3 cp each</td><td>Rubbery whites with sulfurous yolks floating in brine</td></tr>
                    <tr><td>Dried Apples</td><td>1 sp/handful</td><td>Leathery slices that taste like sweetened bark</td></tr>
                    <tr><td>Goat Cheese</td><td>8 sp/wheel</td><td>Pungent rounds that crumble like chalk</td></tr>
                </table>
                <p class="text-muted"><em>"Festival prices" in Vallaki add +1d4 cp to all items.</em></p>
            </div>
        </div>
        
        <div class="col">
            <div class="box">
                <h3 class="box-title">TAVERN ATMOSPHERES</h3>
                <table>
                    <tr><th>Location</th><th>Atmosphere</th><th>Notable Patrons</th></tr>
                    <tr><td>Blood of the Vine (Barovia)</td><td>Oppressive silence broken by occasional sobbing</td><td>Drunken mourners, Ismark nursing ale</td></tr>
                    <tr><td>Blue Water Inn (Vallaki)</td><td>Forced merriment with strained laughter</td><td>Wereravens in disguise, Rictavio at the bar</td></tr>
                    <tr><td>Krezk's Empty Barrel</td><td>Paranoid whispers behind raised tankards</td><td>Off-duty guards, Abbot's mongrelfolk</td></tr>
                    <tr><td>Vistani Camp</td><td>Raucous music covering tense negotiations</td><td>Spy masters, fortune tellers, Strahd's informants</td></tr>
                    <tr><td>Bonegrinder "Tavern"</td><td>Sweet smells masking underlying rot</td><td>Hags pretending to be grandmothers</td></tr>
                    <tr><td>St. Andral's Orphanage</td><td>Eerily cheerful children's singing</td><td>Empty chairs that creak on their own</td></tr>
                    <tr><td>Old Svalich Road Camp</td><td>Nervous travelers jumping at owl hoots</td><td>Werewolf spies, desperate merchants</td></tr>
                    <tr><td>Ravenloft's Cellar</td><td>Chill air carrying phantom banquet sounds</td><td>Strahd's brides, ghostly servants</td></tr>
                    <tr><td>Berez's Ruined Pub</td><td>Moldy tables with fresh wine stains</td><td>Swamp creatures, Baba Lysaga's spies</td></tr>
                    <tr><td>Tsolenka Pass Outpost</td><td>Howling wind drowning out conversation</td><td>Frozen corpses propped in chairs</td></tr>
                </table>
            </div>
            
            <div class="box" style="margin-top: 20px;">
                <h3 class="box-title">LODGING & CONSEQUENCES</h3>
                <table>
                    <tr><th>Location</th><th>Cost/Night</th><th>Risks</th></tr>
                    <tr><td>Abandoned Shack</td><td>Free</td><td class="text-danger">1d4 Shadows attack at midnight</td></tr>
                    <tr><td>Blood of the Vine Tavern</td><td>1 gp</td><td class="text-warning">Strahd's spies report your location</td></tr>
                    <tr><td>Vallaki Burgomaster's Guest Room</td><td>10 gp</td><td class="text-danger">Forced to attend festival or arrested</td></tr>
                    <tr><td>Vistani Camp</td><td>2 gp + favor</td><td class="text-warning">Dreams of Strahd's mocking laughter</td></tr>
                    <tr><td>Ravenloft Dungeon</td><td>‚Äî</td><td class="text-danger">You <strong>are</strong> the meal</td></tr>
                </table>
                
                <h3 class="box-subtitle">STARVATION RULES (BAROVIA)</h3>
                <ul>
                    <li><strong>Half Rations:</strong> DC 12 CON save or gain <a href="#despair">Despair</a>.</li>
                    <li><strong>3 Days Without Food:</strong> Exhaustion level each day.</li>
                    <li><strong>Eating "Questionable" Food:</strong> Roll on <a href="#madness">Madness</a> table.</li>
                </ul>
            </div>
        </div>
    </div>
</div>
    
<!-- Locations Tab System -->
<h2 class="section-title" id="locations">
    <div class="section-header">
        <span>LOCATIONS</span>
        <label class="print-selector">
            <input type="checkbox" class="section-checkbox" data-section="locations">
             
        </label>
    </div>
</h2>
<div class="collapsible-content">
    <div class="tab-system">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="openTab(event, 'village-barovia')">Village of Barovia</button>
            <button class="tab-button" onclick="openTab(event, 'vallaki')">Vallaki</button>
            <button class="tab-button" onclick="openTab(event, 'krezk')">Krezk</button>
            <button class="tab-button" onclick="openTab(event, 'castle-ravenloft')">Castle Ravenloft</button>
        </div>
        
        <!-- Village of Barovia -->
        <div id="village-barovia" class="tab-content active">
            <div class="row">
                <div class="col">
                    <img src="https://pyramking.com/wp-content/uploads/2022/09/village-of-Barovia.jpg" alt="Village of Barovia">
                    <div class="box">
                        <div class="npc-header">
                            <h3>VILLAGE OF BAROVIA OVERVIEW</h3>
                        </div>
                        <p>The original settlement from which Strahd carved his domain, now a ghost of its former self. Founded as a military outpost during Strahd's conquest, the village became his first prison when the mists descended. Its crumbling buildings bear silent witness to centuries of despair, with the burgomaster's mansion standing as a monument to failed resistance against the vampire lord.</p>
                        
                        <h3 class="box-subtitle">KEY LOCATIONS:</h3>
                        <ul>
                            <li><strong>Blood of the Vine Tavern:</strong> Only gathering place, run by a soulless barkeep</li>
                            <li><strong>Burgomaster's Mansion:</strong> Abandoned after recent deaths</li>
                            <li><strong>Church of Barovia:</strong> Contains a corrupted priest and haunted graveyard</li>
                            <li><strong>Mad Mary's Townhouse:</strong> Grieving mother who wails nightly</li>
                            <li><strong>Gates of Barovia:</strong> Ancient stone arches leading to Svalich Woods</li>
                        </ul>
                    </div>
                </div>
                
                <div class="col">
                    <div class="box">
                        <div class="npc-header">
                            <h3>HISTORICAL SIGNIFICANCE</h3>
                        </div>
                        <p>This was where Strahd first tasted Barovian soil after his conquest, where he murdered his brother Sergei in the chapel ruins, and where Tatyana first leaped to her death. The village's perpetual fog carries echoes of these tragedies, sometimes forming ghostly tableaus of the past at dusk.</p>
                        
                        <div class="npc-header">
                            <h3>VILLAGE ENCOUNTERS</h3>
                        </div>
                        <h3 class="box-subtitle">DAYTIME ENCOUNTERS (d6):</h3>
                        <ol>
                            <li><strong>Funeral Procession:</strong> Villagers carry a wrapped body to graveyard</li>
                            <li><strong>Beggar:</strong> Pleads for food, reveals cryptic warning if helped</li>
                            <li><strong>Bar Fight:</strong> Drunks brawl over imagined slights</li>
                            <li><strong>Strahd's Spy:</strong> Raven or wolf watches conspicuously</li>
                            <li><strong>Wandering Merchant:</strong> Sells questionable goods at high prices</li>
                            <li><strong>Prophet:</strong> Madperson shouts doomsday predictions</li>
                        </ol>
                    </div>
                </div>
            </div>
            
            <!-- NPC Cards -->
            <div class="box">
                <div class="npc-header">
                    <h3>NOTABLE NPCS</h3>
                </div>
                <div class="npc-grid">
                    <!-- Ireena -->
                    <div class="npc-card-mini" onclick="highlightNPC('ireena')">
                        <div class="npc-header">
                            <h4>Ireena Kolyana</h4>
                            <span class="npc-tag obsession">Obsession</span>
                        </div>
                        <p class="npc-quote"><em>"My beloved returned to me at last"</em> ‚Äî Strahd</p>
                        <div class="npc-status-line">Being "courted" through calculated appearances</div>
                        <a href="#npc-relationships" class="npc-link">View Full Details ‚Üí</a>
                    </div>
                    
                    <!-- Ismark -->
                    <div class="npc-card-mini" onclick="highlightNPC('ismark')">
                        <div class="npc-header">
                            <h4>Ismark the Lesser</h4>
                            <span class="npc-tag protector">Protector</span>
                        </div>
                        <p class="npc-quote"><em>"A gnat buzzing around Tatyana"</em> ‚Äî Strahd</p>
                        <div class="npc-status-line">Begging adventurers to escort Ireena</div>
                        <a href="#npc-relationships" class="npc-link">View Full Details ‚Üí</a>
                    </div>
                    
                    <!-- Donavich -->
                    <div class="npc-card-mini" onclick="highlightNPC('donavich')">
                        <div class="npc-header">
                            <h4>Father Donavich</h4>
                            <span class="npc-tag broken">Broken Faith</span>
                        </div>
                        <p class="npc-quote"><em>"A broken toy"</em> ‚Äî Strahd</p>
                        <div class="npc-status-line">Hiding vampiric son Doru in church</div>
                        <a href="#npc-relationships" class="npc-link">View Full Details ‚Üí</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Vallaki -->
        <div id="vallaki" class="tab-content">
            <div class="row">
                <div class="col">
                    <img src="https://pyramking.com/wp-content/uploads/2022/09/ezgif.com-gif-maker.jpg" alt="Vallaki">
                    <div class="box">
                        <div class="npc-header">
                            <h3>VALLAKI OVERVIEW</h3>
                        </div>
                        <p>Founded by refugees fleeing Strahd's early reign, Vallaki's high walls contain both desperate hope and festering corruption. The town's motto - "All will be well!" - rings hollow after generations of burgomasters enforcing mandatory happiness under threat of punishment. Beneath colorful festival banners, the townsfolk whisper of missing children and the cult growing in Lady Wachter's manor.</p>
                        
                        <h3 class="box-subtitle">KEY LOCATIONS:</h3>
                        <ul>
                            <li><strong>Blue Water Inn:</strong> Run by wereravens, safe haven</li>
                            <li><strong>Burgomaster's Mansion:</strong> Extravagant home of Vargas Vallakovich</li>
                            <li><strong>St. Andral's Church:</strong> Site of sacred bones that repel Strahd</li>
                            <li><strong>Coffin Maker's Shop:</strong> Hides vampire spawn in attic</li>
                            <li><strong>Wachterhaus:</strong> Home of Lady Wachter's cult</li>
                        </ul>
                    </div>
                </div>
                
                <div class="col">
                    <div class="box">
                        <div class="npc-header">
                            <h3>HISTORICAL SIGNIFICANCE</h3>
                        </div>
                        <p>Vallaki was the last settlement to resist Strahd before his curse was complete. The town's original church was where the first priest attempted - and failed - to destroy Strahd with holy magic. Now the bones of St. Andral hidden beneath the new church represent the town's last hope, though few remember their true significance.</p>
                        
                        <div class="npc-header">
                            <h3>VALLAKI POLITICS</h3>
                        </div>
                        <h3 class="box-subtitle">FACTIONS:</h3>
                        <ol>
                            <li><strong>Vallakovich Loyalists:</strong> Believe in forced happiness</li>
                            <li><strong>Wachter Cultists:</strong> Worship Strahd secretly</li>
                            <li><strong>Wereravens:</strong> Secretly oppose Strahd</li>
                            <li><strong>Common Folk:</strong> Just trying to survive</li>
                        </ol>
                    </div>
                </div>
            </div>
            
            <!-- NPC Cards -->
            <div class="box">
                <div class="npc-header">
                    <h3>NOTABLE NPCS</h3>
                </div>
                <div class="npc-grid">
                    <!-- Van Richten -->
                    <div class="npc-card-mini" onclick="highlightNPC('van-richten')">
                        <div class="npc-header">
                            <h4>Van Richten</h4>
                            <span class="npc-tag enemy">Enemy</span>
                        </div>
                        <p class="npc-quote"><em>"Finally, worthy prey"</em> ‚Äî Strahd</p>
                        <div class="npc-status-line">Disguised as Rictavio the bard</div>
                        <a href="#npc-relationships" class="npc-link">View Full Details ‚Üí</a>
                    </div>
                    
                    <!-- Vargas -->
                    <div class="npc-card-mini" onclick="highlightNPC('vargas')">
                        <div class="npc-header">
                            <h4>Vargas Vallakovich</h4>
                            <span class="npc-tag pawn">Pawn</span>
                        </div>
                        <p class="npc-quote"><em>"A useful fool"</em> ‚Äî Strahd</p>
                        <div class="npc-status-line">Enforcing mandatory happiness</div>
                        <a href="#npc-relationships" class="npc-link">View Full Details ‚Üí</a>
                    </div>
                    
                    <!-- Fiona -->
                    <div class="npc-card-mini" onclick="highlightNPC('fiona')">
                        <div class="npc-header">
                            <h4>Lady Fiona Wachter</h4>
                            <span class="npc-tag cultist">Cult Leader</span>
                        </div>
                        <p class="npc-quote"><em>"A useful fanatic"</em> ‚Äî Strahd</p>
                        <div class="npc-status-line">Plotting to overthrow Vargas</div>
                        <a href="#npc-relationships" class="npc-link">View Full Details ‚Üí</a>
                    </div>
                    
                    <!-- Blinsky -->
                    <div class="npc-card-mini" onclick="highlightNPC('blinsky')">
                        <div class="npc-header">
                            <h4>Blinsky</h4>
                            <span class="npc-tag broken">Toymaker</span>
                        </div>
                        <p class="npc-quote"><em>"A harmless curiosity"</em> ‚Äî Strahd</p>
                        <div class="npc-status-line">Making creepy dolls for Izek</div>
                        <a href="#npc-relationships" class="npc-link">View Full Details ‚Üí</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Krezk -->
        <div id="krezk" class="tab-content">
            <div class="row">
                <div class="col">
                    <img src="https://pyramking.com/wp-content/uploads/2022/09/Krezek.jpg" alt="Krezk">
                    <div class="box">
                        <div class="npc-header">
                            <h3>KREZK OVERVIEW</h3>
                        </div>
                        <p>Perched high in the Balinok Mountains, Krezk began as a monastery before becoming a fortified village. Its isolation preserved some sanity, but the arrival of the Abbot - a celestial being slowly corrupted by Barovia - has twisted its purpose. The villagers now bar their doors at night, not just against wolves, but against the Abbot's mongrelfolk and the terrible sounds from the Abbey's bell tower.</p>
                        
                        <h3 class="box-subtitle">KEY LOCATIONS:</h3>
                        <ul>
                            <li><strong>Gates:</strong> Heavily guarded against outsiders</li>
                            <li><strong>Abbey of St. Markovia:</strong> Run by the "Abbot," a celestial gone mad</li>
                            <li><strong>Pool in the Woods:</strong> Possible escape for Ireena</li>
                            <li><strong>Winery:</strong> Source of Barovia's wine (when operational)</li>
                        </ul>
                    </div>
                </div>
                
                <div class="col">
                    <div class="box">
                        <div class="npc-header">
                            <h3>HISTORICAL SIGNIFICANCE</h3>
                        </div>
                        <p>The Abbey was once home to Saint Markovia, who led a failed rebellion against Strahd. Her crucifixion on the gates lasted forty days before she died - the same gates that now keep Krezk "safe." The pool where Tatyana's spirit sometimes appears was sacred to the mountain folk Strahd slaughtered during his conquest.</p>
                        
                        <div class="npc-header">
                            <h3>KREZK SECRETS</h3>
                        </div>
                        <h3 class="box-subtitle">ABBEY SECRETS:</h3>
                        <ol>
                            <li>The Abbot believes he's helping Strahd find peace</li>
                            <li>Vasilka is made from parts of dead women</li>
                            <li>The bell tower houses a dangerous creature</li>
                            <li>Mongrelfolk were once normal villagers</li>
                        </ol>
                    </div>
                </div>
            </div>
            
            <!-- NPC Cards -->
            <div class="box">
                <div class="npc-header">
                    <h3>NOTABLE NPCS</h3>
                </div>
                <div class="npc-grid">
                    <!-- The Abbot -->
                    <div class="npc-card-mini" onclick="highlightNPC('abbot')">
                        <div class="npc-header">
                            <h4>The Abbot</h4>
                            <span class="npc-tag experiment">Experiment</span>
                        </div>
                        <p class="npc-quote"><em>"A fascinating case study"</em> ‚Äî Strahd</p>
                        <div class="npc-status-line">Creating flesh golem bride</div>
                        <a href="#npc-relationships" class="npc-link">View Full Details ‚Üí</a>
                    </div>
                    
                    <!-- Dmitri Krezkov -->
                    <div class="npc-card-mini" onclick="highlightNPC('dmitri')">
                        <div class="npc-header">
                            <h4>Dmitri Krezkov</h4>
                            <span class="npc-tag protector">Burgomaster</span>
                        </div>
                        <p class="npc-quote"><em>"A stubborn mule"</em> ‚Äî Strahd</p>
                        <div class="npc-status-line">Maintaining Krezk's isolation</div>
                        <a href="#npc-relationships" class="npc-link">View Full Details ‚Üí</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Castle Ravenloft -->
        <div id="castle-ravenloft" class="tab-content">
            <div class="row">
                <div class="col">
                    <img src="https://thenerdd.com/wp-content/uploads/2023/04/image-13.png" alt="Castle Ravenloft">
                    <div class="box">
                        <div class="npc-header">
                            <h3>CASTLE RAVENLOFT OVERVIEW</h3>
                        </div>
                        <p>More than a fortress, Ravenloft is a manifestation of Strahd's damned soul - its spires like claws grasping at the storm-wracked sky. Built upon the ruins of a Tergish watchtower, every stone was laid under Strahd's exacting supervision. The castle breathes with its master's moods, halls lengthening for his amusement, doors locking to trap intruders, shadows moving with malicious intent.</p>
                        
                        <h3 class="box-subtitle">KEY LOCATIONS:</h3>
                        <ul>
                            <li><strong>Great Entrance:</strong> Massive doors with carvings of Strahd's conquests</li>
                            <li><strong>Dining Hall:</strong> Set for a feast with rotten food</li>
                            <li><strong>Heart of Sorrow:</strong> Crystal heart that absorbs damage for Strahd</li>
                            <li><strong>Crypts:</strong> Final resting place of Strahd's family</li>
                            <li><strong>Spires:</strong> Highest points with terrifying drops</li>
                        </ul>
                    </div>
                </div>
                
                <div class="col">
                    <div class="box">
                        <div class="npc-header">
                            <h3>HISTORICAL SIGNIFICANCE</h3>
                        </div>
                        <p>The castle's foundation stones were mortared with the blood of conquered warriors. In its chapel, Strahd murdered his brother Sergei on their wedding day. From its tallest tower, Tatyana flung herself rather than submit to Strahd's embrace. Every anniversary of these events, phantom screams echo through the halls, and the portraits bleed.</p>
                        
                        <div class="npc-header">
                            <h3>CASTLE FEATURES</h3>
                        </div>
                        <h3 class="box-subtitle">SUPERNATURAL EFFECTS:</h3>
                        <ol>
                            <li><strong>Shifting Architecture:</strong> Rooms move when unobserved</li>
                            <li><strong>Echoes of the Past:</strong> Phantom sounds of long-ago events</li>
                            <li><strong>Living Shadows:</strong> Dark corners move independently</li>
                            <li><strong>Strahd's Eyes:</strong> Portraits and statues seem to watch</li>
                        </ol>
                    </div>
                </div>
            </div>
            
            <!-- NPC Cards -->
            <div class="box">
                <div class="npc-header">
                    <h3>NOTABLE NPCS</h3>
                </div>
                <div class="npc-grid">
                    <!-- Rahadin -->
                    <div class="npc-card-mini" onclick="highlightNPC('rahadin')">
                        <div class="npc-header">
                            <h4>Rahadin</h4>
                            <span class="npc-tag loyal">Eternal Chamberlain</span>
                        </div>
                        <p class="npc-quote"><em>"My most trusted blade"</em> ‚Äî Strahd</p>
                        <div class="npc-status-line">Oversees castle operations</div>
                        <a href="#npc-relationships" class="npc-link">View Full Details ‚Üí</a>
                    </div>
                    
                    <!-- Escher -->
                    <div class="npc-card-mini" onclick="highlightNPC('escher')">
                        <div class="npc-header">
                            <h4>Escher</h4>
                            <span class="npc-tag consort">Consort</span>
                        </div>
                        <p class="npc-quote"><em>"An amusing diversion"</em> ‚Äî Strahd</p>
                        <div class="npc-status-line">Growing jealous of Ireena</div>
                        <a href="#npc-relationships" class="npc-link">View Full Details ‚Üí</a>
                    </div>
                    
                    <!-- Cyrus -->
                    <div class="npc-card-mini" onclick="highlightNPC('cyrus')">
                        <div class="npc-header">
                            <h4>Cyrus Belview</h4>
                            <span class="npc-tag experiment">Broken Butler</span>
                        </div>
                        <p class="npc-quote"><em>"A living joke"</em> ‚Äî Strahd</p>
                        <div class="npc-status-line">Mongrelfolk servant</div>
                        <a href="#npc-relationships" class="npc-link">View Full Details ‚Üí</a>
                    </div>
                    
                    <!-- Strahd's Brides -->
                    <div class="npc-card-mini" onclick="highlightNPC('brides')">
                        <div class="npc-header">
                            <h4>Strahd's Brides</h4>
                            <span class="npc-tag consort">Consorts</span>
                        </div>
                        <p class="npc-quote"><em>"Pretty decorations"</em> ‚Äî Strahd</p>
                        <div class="npc-status-line">Lurking throughout the castle</div>
                        <a href="#npc-relationships" class="npc-link">View Full Details ‚Üí</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>    


    <!-- Curse Removal & Revenant Resurrection -->
    <h2 class="section-title" id="curse-removal">
        <div class="section-header">
            <span>CURSE REMOVAL</span>
            <label class="print-selector">
                <input type="checkbox" class="section-checkbox" data-section="curse-removal">
                 
            </label>
        </div>
    </h2>
    <div class="collapsible-content">
        <div class="row">
            <div class="col">
                <div class="box">
                    <h3 class="box-title">REMOVE CURSE</h3>
                    <h3 class="box-subtitle">REMOVE CURSE DC TABLE:</h3>
<ul>
    <li>Most <span class="tooltip">Curses<span class="tooltiptext">Magical afflictions that typically require Remove Curse or similar magic to eliminate.</span></span> - DC 15</li>
    <li>Vistani Curses - DC 16-20</li>
    <li><span class="tooltip">Lycanthropy<span class="tooltiptext">The affliction of being a werecreature. In Barovia, it's particularly difficult to cure.</span></span> - DC 30</li>
</ul>
                    
                    <h3 class="box-subtitle">SPECIAL RULE:</h3>
                    <p>Spellcaster must make ability check with spellcasting ability. On natural 1, suffer 1d12 psychic damage and can't cast remove curse until after a long rest.</p>

                    <h3 class="box-subtitle">LIVING CURSES (d6): <button class="roll-button" onclick="rollDice('1d6')">Roll</button></h3>
                    <ol>
                        <li><strong>Wandering Wound:</strong> 1d4 damage appears daily on body. Heals normally.</li>
                        <li><strong>Hungry Shadow:</strong> Consumes light sources 2x faster within 10ft.</li>
                        <li><strong>Echoing Scream:</strong> Critical fails cause distant screaming (attracts monsters).</li>
                        <li><strong>Blood Ink:</strong> Any writing appears written in blood after 1 hour.</li>
                        <li><strong>Reverse Aging:</strong> Lose/gain 1 year visibly each dawn. No mechanical effect.</li>
                        <li><strong>Door Whisperer:</strong> All doors creak open slightly when unattended.</li>
                    </ol>
                    <p><em>Rules:</em> Apply when Remove Curse fails by 5+. Curses grow stronger weekly until broken.</p>
                </div>
            </div>
            <div class="col">
                <div class="box">
                    <h3 class="box-title">REVENANT RESURRECTION</h3>
                    <p>When a character dies, their soul may enter a humanoid corpse 1d20 hours later (DM's choice).</p>
                    
                    <h3 class="box-subtitle">REVENANT TRAITS:</h3>
                    <ul>
                        <li>Type: Undead (Medium or Small)</li>
                        <li>Darkvision: 60 feet</li>
                        <li>Languages: Add Abyssal</li>
                        <li>Resistances: Resist necrotic, vulnerable to radiant</li>
                        <li>Regeneration: Bonus action to regain HP equal to proficiency die (recharge on short rest)</li>
                        <li>Turn Immunity: Immune to effects that turn undead</li>
                        <li>Vengeful Tracker: Know location of creature responsible for death</li>
                        <li>Unsightly: Disadvantage on Persuasion/Animal Handling/Performance, advantage on Intimidation</li>
                        <li>Death: At 0 HP, die permanently and become DM-controlled ghost</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Vistani Abilities & Random Encounters -->
    <h2 class="section-title" id="vistani">
        <div class="section-header">
            <span>VISTANI / ENCOUNTERS</span>
            <label class="print-selector">
                <input type="checkbox" class="section-checkbox" data-section="vistani">
                 
            </label>
        </div>
    </h2>
    <div class="collapsible-content">
        <div class="row">
            <div class="col">
                <div class="box">
                    <h3 class="box-title">VISTANI CURSES</h3>
                    <p>Vistani can curse those who wrong them (<span class="tooltip">WIS save<span class="tooltiptext">Wisdom saving throws represent resistance to mental influence and effects that would cloud your judgement or perception.</span></span>, DC = 8 + prof + CHA). Removing curses deals <span class="tooltip">psychic backlash<span class="tooltiptext">Psychic damage represents mental trauma and typically can't be reduced by armor.</span></span> (1d6-5d6 depending on severity).</p>
                    <p><em>Examples:</em> Prevent fine motor skills, cosmetic changes, item disappearance, vulnerability to damage type, disadvantage on ability checks, end attunement, blindness/deafness.</p>
                    
                    <h3 class="box-subtitle">EVIL EYE:</h3>
                    <p>10ft range, duplicates animal friendship, charm person, or hold person (CHA-based save DC). On save, Vistana blinded until end of next turn.</p>
                </div>
            </div>
            <div class="col">
                <div class="box">
                    <h3 class="box-title">RANDOM ENCOUNTERS</h3>
                    <h3 class="box-subtitle">CHECK FREQUENCY:</h3>
                    <p>Every 30 minutes on roads/wilderness (maximum 2 per 12 hours)</p>
                    <ul>
                        <li>Road: Encounter on d20 roll of 18+</li>
                        <li>Wilderness: Encounter on d20 roll of 15+</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col">
                <div class="box">
                    <h3 class="box-title">DAYTIME ENCOUNTERS (d12 + d8):</h3>
                    <table>
                        <tr><th>Roll</th><th>Encounter</th><th></th></tr>
                        <tr><td>2</td><td>3d6 commoners fleeing something</td><td><button class="roll-button" onclick="rollDice('3d6')">Roll</button></td></tr>
                        <tr><td>3</td><td>1d6 scouts from Vallaki</td><td><button class="roll-button" onclick="rollDice('1d6')">Roll</button></td></tr>
                        <tr><td>4</td><td>Hunting trap (DC 15 Perception to spot)</td><td></td></tr>
                        <tr><td>5</td><td>Fresh grave with disturbed earth</td><td></td></tr>
                        <tr><td>6</td><td>False trail leading to ambush</td><td></td></tr>
                        <tr><td>7</td><td>1d4 + 1 Vistani bandits</td><td><button class="roll-button" onclick="rollDice('1d4+1')">Roll</button></td></tr>
                        <tr><td>8</td><td>Skeletal rider on nightmare steed</td><td></td></tr>
                        <tr><td>9</td><td>Strange trinket in road (roll on trinket table)</td><td></td></tr>
                        <tr><td>10</td><td>Hidden bundle containing 1d4 severed fingers</td><td><button class="roll-button" onclick="rollDice('1d4')">Roll</button></td></tr>
                        <tr><td>11</td><td>1d4 swarm of ravens (50%) or 1 wereraven (50%)</td><td><button class="roll-button" onclick="rollDice('1d4')">Roll</button></td></tr>
                        <tr><td>12</td><td>1d6 dire wolves stalking prey</td><td><button class="roll-button" onclick="rollDice('1d6')">Roll</button></td></tr>
                        <tr><td>13</td><td>3d6 wolves howling in distance</td><td><button class="roll-button" onclick="rollDice('3d6')">Roll</button></td></tr>
                        <tr><td>14</td><td>1d4 berserkers covered in blood</td><td><button class="roll-button" onclick="rollDice('1d4')">Roll</button></td></tr>
                        <tr><td>15</td><td>Corpse with face frozen in terror</td><td></td></tr>
                        <tr><td>16</td><td>1d6 werewolves in human form</td><td><button class="roll-button" onclick="rollDice('1d6')">Roll</button></td></tr>
                        <tr><td>17</td><td>1 druid with 2d6 twig blights</td><td><button class="roll-button" onclick="rollDice('2d6')">Roll</button></td></tr>
                        <tr><td>18</td><td>2d4 needle blights disguised as shrubs</td><td><button class="roll-button" onclick="rollDice('2d4')">Roll</button></td></tr>
                        <tr><td>19</td><td>1d6 scarecrows that turn to watch you pass</td><td><button class="roll-button" onclick="rollDice('1d6')">Roll</button></td></tr>
                        <tr><td>20</td><td>1 revenant seeking vengeance</td><td></td></tr>
                    </table>
                </div>
            </div>
            <div class="col">
                <div class="box">
                    <h3 class="box-title">NIGHTTIME ENCOUNTERS (d12 + d8):</h3>
                    <table>
                        <tr><th>Roll</th><th>Encounter</th><th></th></tr>
                        <tr><td>2</td><td>1 ghost of a murdered child</td><td></td></tr>
                        <tr><td>3</td><td>Hunting trap baited with rotting meat</td><td></td></tr>
                        <tr><td>4</td><td>Grave being dug by shadowy figures</td><td></td></tr>
                        <tr><td>5</td><td>Cursed trinket that whispers</td><td></td></tr>
                        <tr><td>6</td><td>Corpse that sits up as you pass</td><td></td></tr>
                        <tr><td>7</td><td>Hidden bundle containing a still-beating heart</td><td></td></tr>
                        <tr><td>8</td><td>Skeletal rider dragging chains</td><td></td></tr>
                        <tr><td>9</td><td>1d8 swarm of bats that circle ominously</td><td><button class="roll-button" onclick="rollDice('1d8')">Roll</button></td></tr>
                        <tr><td>10</td><td>1d6 dire wolves with glowing red eyes</td><td><button class="roll-button" onclick="rollDice('1d6')">Roll</button></td></tr>
                        <tr><td>11</td><td>3d6 wolves that howl your name</td><td><button class="roll-button" onclick="rollDice('3d6')">Roll</button></td></tr>
                        <tr><td>12</td><td>1d4 berserkers in bloodstained robes</td><td><button class="roll-button" onclick="rollDice('1d4')">Roll</button></td></tr>
                        <tr><td>13</td><td>1 druid and 2d6 twig blights that mimic screams</td><td><button class="roll-button" onclick="rollDice('2d6')">Roll</button></td></tr>
                        <tr><td>14</td><td>2d4 needle blights that drip sap like blood</td><td><button class="roll-button" onclick="rollDice('2d4')">Roll</button></td></tr>
                        <tr><td>15</td><td>1d6 werewolves in wolf form</td><td><button class="roll-button" onclick="rollDice('1d6')">Roll</button></td></tr>
                        <tr><td>16</td><td>3d6 zombies in funeral attire</td><td><button class="roll-button" onclick="rollDice('3d6')">Roll</button></td></tr>
                        <tr><td>17</td><td>1d6 scarecrows that move when not observed</td><td><button class="roll-button" onclick="rollDice('1d6')">Roll</button></td></tr>
                        <tr><td>18</td><td>1d8 Strahd zombies with personalized torment</td><td><button class="roll-button" onclick="rollDice('1d8')">Roll</button></td></tr>
                        <tr><td>19</td><td>1 will-o'-wisp leading to danger</td><td></td></tr>
                        <tr><td>20</td><td>1 revenant with unfinished business</td><td></td></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Barovian Calendar -->
    <h2 class="section-title" id="calendar">
        <div class="section-header">
            <span>CALENDAR & DOMAIN</span>
            <label class="print-selector">
                <input type="checkbox" class="section-checkbox" data-section="calendar">
                 
            </label>
        </div>
    </h2>
    <div class="collapsible-content">
        <div class="row">
            <div class="col">
                <div class="box">
                    <div class="row" style="margin-bottom: 20px;">
                        <div class="col" style="min-width: 200px; padding-right: 20px;">
                            <h3 class="box-subtitle" style="margin-top: 0;">CALENDAR:</h3>
                            <p style="margin-bottom: 20px;">Calendar measured in moons (lunar cycles)<br>
                            Current year: 735 ‚Ä¢ Strahd born: 306<br>
                            Strahd's conquest: 347 ‚Ä¢ Became vampire: 351</p>
                            
                            <h3 class="box-subtitle">BAROVIAN NAMES:</h3>
                            <div class="row" style="margin-bottom: 15px;">
                                <div class="col" style="padding-right: 15px;">
                                    <h4 style="margin-bottom: 5px;">Male Names:</h4>
                                    <p style="margin-top: 0;">Alek, Andrej, Anton, Balthazar, Bogan, Boris, Dargos, Darzin, Dragomir, Emeric, Falkon, Frederich, Franz, Gargosh, Gorek, Grygori, Hans, Harkus, Ivan, Jirko, Kobal, Korga, Krystofor, Lazlo, Livius, Marek, Miroslav, Nikolaj, Nimir, Oleg, Radovan, Radu, Seraz, Sergei, Stefan, Tural, Valentin, Vasily, Vladislav, Waltar, Yesper, Zsolt</p>
                                </div>
                                <div class="col">
                                    <h4 style="margin-bottom: 5px;">Female Names:</h4>
                                    <p style="margin-top: 0;">Alana, Clavdia, Danya, Dezdrelda, Diavola, Dorina, Drasha, Drilvia, Elisabeta, Fatima, Grilsha, Isabella, Ivana, Jarzinka, Kala, Katerina, Kereza, Korina, Lavinia, Magda, Marta, Mathilda, Minodora, Mirabel, Miruna, Nimira, Nyanka, Olivenka, Ruxandra, Sorina, Tereska, Valentina, Vasha, Victoria, Wensencia, Zondra</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <h4 style="margin-bottom: 5px;">Family Names:</h4>
                                    <p style="margin-top: 0;">Alastroi, Antonovich/Antonova, Barthos, Belasco, Cantemir, Dargovich/Dargova, Diavolov, Diminski, Dilisnya, Drazkoi, Garvinski, Grejenko, Groza, Grygorovich/Grygorova, Ivanovich/Ivanova, Janek, Karushkin, Konstantinovich/Konstantinova, Krezkov/Krezkova, Krykski, Lansten, Lazarescu, Lukresh, Lipsiege, Martikov/Martikova, Mironovich/Mironovna, Moldovar, Nikolovich/Nikolova, Nimirovich/Nimirova, Oronovich/Oronova, Petrovich/Petrovna, Polensky, Radovich/Radova, Rilsky, Stefanovich/Stefanova, Strazni, Swilovich/Swilova, Taltos, Targolov/Targolova, Tyminski, Ulbrek, Ulrich, Vadu, Voltanescu, Zalenski, Zalken</p>
                                </div>
                            </div>
                        </div>
                        <div class="col" style="min-width: 200px; padding-right: 20px;">
                            <h3 class="box-subtitle" style="margin-top: 0;">BAROVIAN LORE:</h3>
                            <ul style="margin-bottom: 20px;">
                                <li><strong>The Devil Strahd:</strong> Vampire lord who dwells in Castle Ravenloft - none enter without invitation</li>
                                <li><strong>Ancestral Sin:</strong> Barovians believe Strahd is punishment for their ancestors' forgotten sins</li>
                                <li><strong>Vampire Weaknesses:</strong> Can't enter homes uninvited, harmed by running water/sunlight</li>
                                <li><strong>The <span class="tooltip">Mists<span class="tooltiptext">The magical fog surrounding Barovia that prevents escape and brings new victims into the domain.</span></span>:</strong> Those who try to leave choke on the fog and perish if they continue</li>
                                <li><strong>Outsiders:</strong> Many strangers come to Barovia but all die or disappear quickly</li>
                                <li><strong>Wildlife:</strong> Wolves and bats serve as Strahd's spies</li>
                                <li><strong>Settlements:</strong> Three main villages along Old Svalich Road (Barovia, Vallaki, Krezk)</li>
                                <li><strong>Wine:</strong> Lifeblood of Barovia from Wizard of Wines winery</li>
                                <li><strong>Mad Wizard:</strong> Powerful outsider in Mount Baratok who opposes Strahd</li>
                                <li><strong><span class="tooltip">The Soulless<span class="tooltiptext">Many Barovians lack true souls - they're empty, emotionless shells going through the motions of life.</span></span>:</strong> Many Barovians lack souls - they're empty, joyless shells</li>
                            </ul>

                            <h3 class="box-subtitle">NPC QUIRKS (d20): <button class="roll-button" onclick="rollDice('1d20')">Roll</button></h3>
<ol style="margin-bottom: 20px;">
    <!-- Innocent Quirks -->
    <li><strong>Childlike Wonder:</strong> Collects mundane objects (stones, buttons) as "magic treasures".</li>
    <li><strong>Sunflower Soul:</strong> Tries to grow flowers in impossible places (rooftops, crypts).</li>
    <li><strong>Story Collector:</strong> Begs travelers for tales of places beyond the mists.</li>
    <li><strong>Shadow Puppeteer:</strong> Makes elaborate shadow plays to comfort children.</li>
    <li><strong>Hopeful Baker:</strong> Always baking "welcome pies" that taste like sawdust.</li>
    
    <!-- Caring Quirks -->
    <li><strong>Mother Hen:</strong> Forces food on everyone while muttering "you're too thin".</li>
    <li><strong>Knot Master:</strong> Carries rope to fix travelers' frayed gear without being asked.</li>
    <li><strong>Nightwatch Whisperer:</strong> Sings lullabies to ward off nightmares (works 50% of time).</li>
    <li><strong>Herb Witch:</strong> Presses foul-smelling "protective" sachets into palms.</li>
    <li><strong>Memory Keeper:</strong> Maintains shrine with names of every deceased villager.</li>
    
    <!-- Strange Quirks -->
    <li><strong>Soulless Tell:</strong> Never blinks. Food has no taste to them.</li>
    <li><strong>Paranoid Ritual:</strong> Knocks 3x before entering, spits over left shoulder.</li>
    <li><strong>Strahd's Pawn:</strong> Knows one random PC secret. Casually mentions it.</li>
    <li><strong>Ghostly Echo:</strong> Repeats same action daily (e.g., always drops a cup at 3pm).</li>
    <li><strong>Hidden Hunger:</strong> Stares at necks/wrists. Refuses garlic.</li>
    <li><strong>Living Omen:</strong> Speaks in riddles that foreshadow nearby danger.</li>
    <li><strong>Flesh Scribbler:</strong> Writes names on their skin that disappear by dawn.</li>
    <li><strong>Mirror Mumbler:</strong> Holds conversations with reflections when alone.</li>
    <li><strong>Grave Dancer:</strong> Waltzes in cemeteries during thunderstorms.</li>
    <li><strong>Puppet Master:</strong> Carries a doll that "speaks" for them in falsetto.</li>
</ol>
                            <p><em>Tip:</em> Assign to 1-in-4 NPCs. Reveal quirks through interaction.</p>
                        </div>
                        <div class="col" style="min-width: 200px;">
                            <h3 class="box-subtitle" style="margin-top: 0;">VISTANI LORE:</h3>
                            <ul>
                                <li><strong>Strahd's Origin:</strong> Ancient royal who became undead after death centuries ago</li>
                                <li><strong>Tatyana:</strong> Strahd's only true love - a peasant girl whose fate is unknown</li>
                                <li><strong>Ravenloft:</strong> Named after Strahd's mother Queen Ravenovia</li>
                                <li><strong>Barovians:</strong> Simple, frightened people - many lack souls entirely</li>
                                <li><strong>The Old Road:</strong> Connects three settlements with Strahd's spies in each</li>
                                <li><strong>Old Windmill:</strong> "Avoid at all costs!" (they refuse to say why)</li>
                                <li><strong>Soul Prison:</strong> Dead souls cannot escape Barovia</li>
                                <li><strong>Madam Eva:</strong> Greatest Vistani fortune-teller who reveals fates</li>
                                <li><strong>Vistani Curses:</strong> Powerful but dangerous to invoke unjustly</li>
                                <li><strong>Ravens:</strong> Carry lost souls - killing one brings bad luck</li>
                            </ul>
                        </div>
                    </div>

                    <div class="box" style="margin-top: 25px;">
                        <h3 class="box-subtitle">GHOSTLY ECHOES (d6): <button class="roll-button" onclick="rollDice('1d6')">Roll</button></h3>
                        <ol>
                            <li><strong>Battle Replay:</strong> Phantom soldiers fight and die at dusk. No interaction.</li>
                            <li><strong>Weeping Stone:</strong> A wall/statue bleeds when specific lore is mentioned.</li>
                            <li><strong>Banquet Hall:</strong> Empty chairs scrape back, glasses fill with blood-red wine.</li>
                            <li><strong>Child's Game:</strong> Spectral children play tag. One always looks like a PC.</li>
                            <li><strong>Execution Loop:</strong> A hanging corpse kicks for 1 minute daily at noon.</li>
                            <li><strong>Strahd's Memory:</strong> Location replays Strahd killing someone from a PC's backstory.</li>
                        </ol>
                        <p><em>Usage:</em> Trigger when players spend >10 mins in a location. No mechanics - pure atmosphere.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- NPC Generator -->
<h2 class="section-title" id="npc-generator">NPC GENERATOR</h2>
<div class="collapsible-content">
    <div class="box" style="min-height: 300px; overflow: visible !important;">
        <h3 class="box-title">BAROVIAN NPC GENERATOR</h3>
        <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
            <button class="roll-button" onclick="generateNPC('male')">GENERATE MALE NPC</button>
            <button class="roll-button" onclick="generateNPC('female')">GENERATE FEMALE NPC</button>
            <button class="roll-button" onclick="generateNPC('any')">GENERATE RANDOM NPC</button>
        </div>
        <!-- Result container with explicit dimensions -->
        <div id="npc-result" style="margin-top: 20px; min-height: 50px; width: 100%;"></div>
        <!-- Progress or loading indicator -->
        <div id="npc-loading" style="display: none; text-align: center; margin: 20px 0;">
            <div class="loading-spinner"></div>
            <p>Generating NPC...</p>
        </div>
    </div>
</div>


<!-- Atmosphere Music -->
<h2 class="section-title" id="atmosphere-music">MUSIC & TOOLS</h2>
<div class="collapsible-content">
    <div class="box">
        <h3 class="box-title">SPOTIFY PLAYLISTS</h3>
        <div class="music-grid">
            <!-- Curse of Strahd Playlist -->
            <div class="music-card">
                <img src="https://sheffieldgothic.home.blog/wp-content/uploads/2016/04/c3149-dd_curse_of_strahd_portrait_of_strahd_von_zarovich.jpg" alt="Curse of Strahd Playlist" class="music-cover">
                <div class="music-info">
                    <h4>Curse of Strahd Campaign</h4>
                    <p>Complete atmospheric soundtrack for your campaign</p>
                    <a href="https://open.spotify.com/playlist/3x0uLKZPaKK8gTszXzIVXD" target="_blank" class="music-link">Listen on Spotify</a>
                </div>
            </div>

            <!-- Pre-Game Strahd -->
            <div class="music-card">
                <img src="https://i.etsystatic.com/16542616/r/il/f70687/4363165323/il_570xN.4363165323_jlk9.jpg" alt="Pre-Game Strahd" class="music-cover">
                <div class="music-info">
                    <h4>Pre-Game Strahd</h4>
                    <p>Set the atmosphere and tone for the upcoming session - good mood setter and session recap</p>
                    <a href="https://open.spotify.com/playlist/4eTsagHD9jfhRcHMoeVS6h?si=DJEhqx9IQ_2dp6DaOEgMiw" target="_blank" class="music-link">Listen on Spotify</a>
                </div>
            </div>
            
            <!-- Epic Battle Playlist -->
            <div class="music-card">
                <img src="https://4.bp.blogspot.com/-QvkOq20fzTU/UX5CmUc7UFI/AAAAAAAAAUU/gB_Lf-RShBg/s1600/meph56_dsa_dorf3.jpg" alt="Epic Battle Music" class="music-cover">
                <div class="music-info">
                    <h4>Epic Battle Music</h4>
                    <p>Thundering orchestral pieces for combat encounters</p>
                    <a href="https://open.spotify.com/playlist/4YaJdqJzubdx3lEB4UEhLt" target="_blank" class="music-link">Listen on Spotify</a>
                </div>
            </div>
            
            <!-- Ambient Exploration -->
            <div class="music-card">
                <img src="https://robertofont.github.io/assets/img/CityAtNight_partII.png" alt="Ambient Exploration" class="music-cover">
                <div class="music-info">
                    <h4>Ambient Exploration</h4>
                    <p>Eerie soundscapes for travel and discovery</p>
                    <a href="https://open.spotify.com/playlist/59vYRdjQE0kHodU5zILaYQ" target="_blank" class="music-link">Listen on Spotify</a>
                </div>
            </div>

            <!-- Foreboding -->
            <div class="music-card">
                <img src="https://i.pinimg.com/736x/ed/5f/f1/ed5ff1a0876f04c89cda5ba7eb25524e.jpg" alt="Strahd Foreboding" class="music-cover">
                <div class="music-info">
                    <h4>Strahd Foreboding</h4>
                    <p>Foreboding atmosphere for travel and exploration</p>
                    <a href="https://open.spotify.com/playlist/0IT55bfRRe2nAMEY5q38aj?si=leCffOe8QhOvkGur2Q47xw" target="_blank" class="music-link">Listen on Spotify</a>
                </div>
            </div>
        </div>

        </div>

        <div class="box">
            <h3 class="box-title">GAME TOOLS</h3>
            <div class="music-grid">
                                
                <!-- OBR NPC Generator -->
                <div class="music-card">
                    <img src="https://npc-generator-obr.onrender.com/crit.png" alt="OWLBEAR RADIO" class="music-cover">
                    <div class="music-info">
                        <h4>OWLBEAR RODEO NPC Generator</h4>
                        <p>FREE Dynamic NPC generator addon for OBR - Copy and paste link into addons üëá</p>
                        https://npc-generator-obr.onrender.com/manifest.json
                        <p></p>
                        <a href="https://www.owlbear.rodeo/" target="_blank" class="music-link">Open OwlBear Rodeo VTT</a>
                    </div>
                </div>

                <!-- TIKTOK -->
                <div class="music-card">
                    <img src="https://cdn.beacons.ai/user_content/rIDafriKi5f81R1d73HxPizPLyi1/profile_youwannaplay.png" alt="BBEG Monologues" class="music-cover">
                    <div class="music-info">
                        <h4>NAT20 Free Monologues for NPC's & BBEG's</h4>
                        <p>FREE Monologues for games and campaigns</p>
                        <p></p>
                        <a href="https://www.tiktok.com/@rollnat20" target="_blank" class="music-link">TikTok - NPC / BBEG Monologues</a>
                    </div>
                </div>

                <!-- Handout Generator -->
                <div class="music-card">
                    <img src="https://img.freepik.com/free-photo/parchment-with-ink-stains-near-candles-keys_23-2147777457.jpg" alt="Handout Generator" class="music-cover">
                    <div class="music-info">
                        <h4>Handout Generator</h4>
                        <p>Create printable letter handouts</p>
                        <p></p>
                        <a href="https://rpgportrait.app/free-tools/letter-creator" target="_blank" class="music-link">Open Handout Generator</a>
                    </div>
                </div>

                <!-- Printable Tarroka Deck -->
                <div class="music-card">
                    <img src="https://boardwipe.com/cdn/shop/products/Thumbnail_3.jpg" alt="Tarroka Deck" class="music-cover">
                    <div class="music-info">
                        <h4>Printable Tarroka Deck</h4>
                        <p>Printable Tarroka Deck courtesy of Reddit user: meninosousa</p>
                        <p></p>
                        <a href="https://www.dropbox.com/scl/fi/vkbgrmwbfqbysq2widlpb/Tarokka_All.pdf?rlkey=5y5t46adrb8akv082gfu0iwko&e=1&st=81h4w5n9&dl=0" target="_blank" class="music-link">Open Dropbox</a>
                    </div>
                </div>

                <!-- Spoiler Free Map -->
                <div class="music-card">
                    <img src="https://i.pinimg.com/736x/62/aa/62/62aa6210cccbf03c58eb892bf65f2e92.jpg" alt="Spoiler Free Map" class="music-cover">
                    <div class="music-info">
                        <h4>High Res: Spoiler Free Barovia Map</h4>
                        <p>Spoiler free Barovia Map courtesy of Reddit user: Heppburr</p>
                        <p></p>
                        <a href="https://www.reddit.com/media?url=https%3A%2F%2Fpreview.redd.it%2F51s3lxug73o71.png%3Fwidth%3D3375%26format%3Dpng%26auto%3Dwebp%26s%3D26641f1ed823b880958cae56005d3fcabc5d242c" target="_blank" class="music-link">Open Image</a>
                    </div>
                </div>

            </div>
        
        <h3 class="box-subtitle" style="margin-top: 30px;">YOUTUBE MUSIC BY LOCATION</h3>
        <div class="table-header">
            <div class="table-col-1">Location</div>
            <div class="table-col-2">Music Style</div>
            <div class="table-col-3">Youtube Link/Artist</div>
        </div>
        <div class="box-row">
            <div class="table-col-1">Lands of Barovia</div>
            <div class="table-col-2">Dark Background Music</div>
            <div class="table-col-3"><a href="https://www.youtube.com/watch?v=rHf-4IkzapM&pp=ygUMc3RyYWhkIG11c2lj" target="_blank">Fabo Music</a></div>
        </div>

        <div class="box-row">
            <div class="table-col-1">Into the Mists</div>
            <div class="table-col-2">Atmospheric Background Music</div>
            <div class="table-col-3"><a href="https://www.youtube.com/watch?v=Py9uKaZQcgo&list=PLQBqJdSe3H4E7e-Vibw_RZ2bKTH03Z-yX" target="_blank">Fabo Music</a></div>
        </div>

        <div class="box-row">
            <div class="table-col-1">Old Svalich Road</div>
            <div class="table-col-2">On-the road atmospheric Background Music</div>
            <div class="table-col-3"><a href="https://www.youtube.com/watch?v=m7tR2IJg8yg&pp=ygUMc3RyYWhkIG11c2lj" target="_blank">Fabo Music</a></div>
        </div>

        <div class="box-row">
            <div class="table-col-1">Village of Barovia</div>
            <div class="table-col-2">Music for the Village of Barovia</div>
            <div class="table-col-3"><a href="https://www.youtube.com/watch?v=ZOoFtJWJXL4&pp=ygUMc3RyYWhkIG11c2lj" target="_blank">Fabo Music</a></div>
        </div>

        <div class="box-row">
            <div class="table-col-1">Tser Pool Encampment</div>
            <div class="table-col-2">Vistani encampment</div>
            <div class="table-col-3"><a href="https://www.youtube.com/watch?v=bsuF-HNoTqk&pp=ygURc3RyYWhkIG11c2ljIHRzZXI%3D" target="_blank">James RPG Art</a></div>
        </div>

        <div class="box-row">
            <div class="table-col-1">Town of Vallaki</div>
            <div class="table-col-2">Town of Vallaki Background Music</div>
            <div class="table-col-3"><a href="https://www.youtube.com/watch?v=sxy7Csc2p2g&pp=ygUMc3RyYWhkIG11c2lj" target="_blank">MAB Music TTRPG</a></div>
        </div>

        <div class="box-row">
            <div class="table-col-1">Town of Vallaki / Alternative</div>
            <div class="table-col-2">Town of Vallaki Background Music</div>
            <div class="table-col-3"><a href="https://www.youtube.com/watch?v=P5ahzE4N7zc&pp=ygUMc3RyYWhkIG11c2lj" target="_blank">Fabo Music</a></div>
        </div>

        <div class="box-row">
            <div class="table-col-1">Yester Hill</div>
            <div class="table-col-2">Music for Yester Hill atmosphere</div>
            <div class="table-col-3"><a href="https://www.youtube.com/watch?v=3djSaBlWPzo&pp=ygUMc3RyYWhkIG11c2lj" target="_blank">MAB Music TTRPG</a></div>
        </div>

        
        <!-- More location rows... -->
    </div>
</div>

<!-- Strahd von Zarovich -->
<h2 class="section-title" id="strahd-profile">
    <div class="section-header">
        <span>STRAHD PROFILE</span>
        <label class="print-selector">
            <input type="checkbox" class="section-checkbox" data-section="strahd-profile">
             
        </label>
    </div>
</h2>
<div class="collapsible-content">
    <div class="box">
        <div class="row">
            <div class="col">
                <img src="https://pyramking.com/wp-content/uploads/2022/12/Strahd_1.webp" alt="Strahd von Zarovich" style="width:100%; border-radius:5px; margin-bottom:15px;">
                <h3 class="box-subtitle">THE VAMPIRE LORD OF BAROVIA</h3>
                <table>
                    <tr>
                        <td><strong>Full Name:</strong></td>
                        <td>Strahd von Zarovich VI</td>
                    </tr>
                    <tr>
                        <td><strong>Titles:</strong></td>
                        <td>The Ancient, The Land, Count of Barovia</td>
                    </tr>
                    <tr>
                        <td><strong>Age:</strong></td>
                        <td>Over 400 years old</td>
                    </tr>
                    <tr>
                        <td><strong>Alignment:</strong></td>
                        <td>Lawful Evil</td>
                    </tr>
                    <tr>
                        <td><strong>Domain:</strong></td>
                        <td>Castle Ravenloft, Barovia</td>
                    </tr>
                    <tr>
                        <td><strong>Signature Weapon:</strong></td>
                        <td>The Sword of the Morning (Sunblade, now corrupted)</td>
                    </tr>
                </table>
                
                <div class="dm-notes">
                    <h4>DM Notes:</h4>
                    <ul>
                        <li>Strahd is always 3 steps ahead - he's been doing this for centuries</li>
                        <li>Remember: He's a brilliant military tactician, not just a monster</li>
                        <li>Use his spies (rats, bats, Vistani) to show he's always watching</li>
                    </ul>
                </div>
            </div>
            <div class="col">
                <h3 class="box-title">HISTORY & TRAGEDY</h3>
                <p><strong>The Conqueror:</strong> Once a noble warrior who expanded his father's empire, Strahd conquered Barovia through brilliant military campaigns in his prime. The valley's original inhabitants called him "the Devil Strahd."</p>
                
                <p><strong>The Bargain:</strong> Fearing old age while his brother Sergei remained youthful, Strahd made his fateful pact on the night of Sergei's wedding to Tatyana. The ceremony became a bloodbath - Sergei murdered, Tatyana dead by suicide, and Strahd transformed into the first vampire.</p>
                
                <p><strong>The Curse:</strong> The Dark Powers granted Strahd's wish for immortality but cursed him to forever pursue Tatyana's reincarnations, only to lose her each time. Each cycle renews his torment.</p>
                
                <div class="dm-notes">
                    <h4>Key Story Beats:</h4>
                    <ul>
                        <li>Strahd sees himself as the tragic hero of his story</li>
                        <li>He genuinely believes Tatyana is his by right</li>
                        <li>His journal (found in Ravenloft) reveals his descent into madness</li>
                    </ul>
                </div>
                
                <h3 class="box-subtitle">PERSONALITY TRAITS</h3>
                <ul>
                    <li><strong>"I am the ancient, I am the land."</strong> - He sees Barovia as an extension of himself</li>
                    <li><strong>"All who oppose me shall perish."</strong> - Challenges to his rule enrage him</li>
                    <li><strong>"Tatyana is mine by right."</strong> - An obsession bordering on madness</li>
                    <li><strong>"I suffer no insult."</strong> - Punishes slights with cruel creativity</li>
                    <li><strong>"You remind me of my brother..."</strong> - Both nostalgic and dangerous</li>
                </ul>
            </div>
        </div>
        
        <div class="box-highlight">
            <h3 class="box-title">RUNNING STRAHD: DM GUIDELINES</h3>
            <div class="row">
                <div class="col">
                    <h4>Strahd's Goals:</h4>
                    <ol>
                        <li><strong>Claim Tatyana's current incarnation (Ireena)</strong> - His primary obsession</li>
                        <li><strong>Find a worthy successor</strong> - But will ultimately reject all candidates</li>
                        <li><strong>Break his curse</strong> - Though he doesn't fully understand it</li>
                        <li><strong>Entertain himself</strong> - Adventurers are rare distractions</li>
                    </ol>
                </div>
                <div class="col">
                    <h4>Strahd's Tactics:</h4>
                    <ul>
                        <li>Tests the party through proxies before confronting them directly</li>
                        <li>Uses charm and intellect more than brute force</li>
                        <li>Will retreat and regroup if seriously threatened</li>
                        <li>Plays party members against each other</li>
                        <li>Always has an escape plan (Misty Escape)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Barovian Lore -->
<h2 class="section-title" id="barovian-lore">
    <div class="section-header">
        <span>BAROVIAN LORE</span>
        <label class="print-selector">
            <input type="checkbox" class="section-checkbox" data-section="barovian-lore">
             
        </label>
    </div>
</h2>
<div class="collapsible-content">
    <div class="box">
        <div class="row">
            <div class="col">
                <h3 class="box-subtitle">THE MISTS OF BAROVIA</h3>
                <p>The ever-present fog serves as Strahd's prison walls and psychological weapon. Key features:</p>
                <ul>
                    <li><strong>Psychological Horror:</strong> The mists whisper and show visions</li>
                    <li><strong>Navigation Hazard:</strong> DC 15 Survival check or become lost</li>
                    <li><strong>Strahd's Will:</strong> He can intensify them as a lair action</li>
                    <li><strong>Escape Attempts:</strong> Those who try to leave find themselves back in Barovia</li>
                </ul>
                
                <div class="dm-notes">
                    <h4>DM Tips:</h4>
                    <ul>
                        <li>Use mists to cut off retreats or separate party members</li>
                        <li>Have them react to Strahd's emotions (turn blood-red when angry)</li>
                        <li>Let players hear ghostly whispers of "He is the Ancient..."</li>
                    </ul>
                </div>
                
                <h3 class="box-subtitle">THE LAND ITSELF</h3>
                <p>Strahd's connection to Barovia is supernatural - the land reflects his moods:</p>
                <table class="mood-table">
                    <tr>
                        <th>
  <a href="#weather">Strahd's Mood</a>
  <span class="tooltip">‚ÑπÔ∏è
    <span class="tooltiptext">
      Track Strahd's emotional state to foreshadow events. 
      
    </span>
  </span>
</th>
                        <th>Environmental Effects</th>
                    </tr>
                    <tr>
                        <td>Angry</td>
                        <td>Thunderstorms, howling winds</td>
                    </tr>
                    <tr>
                        <td>Melancholy</td>
                        <td>Constant dreary rain</td>
                    </tr>
                    <tr>
                        <td>Amused</td>
                        <td>Unnatural stillness</td>
                    </tr>
                    <tr>
                        <td>Romantic</td>
                        <td>Blood-red moon appears</td>
                    </tr>
                </table>
            </div>
            <div class="col">
                <h3 class="box-subtitle">FACTIONS OF BAROVIA</h3>
                
                <h4>The Vistani</h4>
                <p>Strahd's nomadic spies granted special privileges:</p>
                <ul>
                    <li>Only ones who can freely pass through the mists</li>
                    <li>Not all serve Strahd willingly (Madam Eva's faction resists)</li>
                    <li>Excellent source of cryptic prophecies</li>
                </ul>
                
                <h4>The Burgomasters</h4>
                <p>Local leaders who maintain the illusion of order:</p>
                <ul>
                    <li><strong>Vargas Vallakovich (Vallaki):</strong> Delusional tyrant enforcing "happiness"</li>
                    <li><strong>Kolyan Indirovich (Barovia):</strong> Deceased father of Ireena</li>
                    <li><strong>Davian Martikov (Wizard of Wines):</strong> Secretly wereraven leader</li>
                </ul>
                
                <h3 class="box-subtitle">THE DARK POWERS</h3>
                <p>The mysterious entities behind the Curse of Strahd:</p>
                <ul>
                    <li>Not gods but ancient malevolent forces</li>
                    <li>May offer players corrupting bargains</li>
                    <li>Delight in Strahd's endless torment</li>
                    <li>Can manifest as shadowy figures or through the Amber Temple</li>
                </ul>
                
                <div class="box-highlight">
                    <h4>Strahd's Torment Cycle:</h4>
                    <ol>
                        <li>Tatyana reincarnates</li>
                        <li>Strahd pursues her</li>
                        <li>She dies tragically</li>
                        <li>Barovia resets</li>
                        <li>The mists bring new victims</li>
                    </ol>
                    <p>This has repeated for centuries - the current Ireena incarnation is just the latest.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- NPC Relationships -->
<h2 class="section-title" id="npc-relationships">
    <div class="section-header">
        <span>NPC RELATIONSHIPS</span>
        <label class="print-selector">
            <input type="checkbox" class="section-checkbox" data-section="npc-relationships">
             
        </label>
    </div>
</h2>
<div class="collapsible-content">
    <div class="box">
        <div class="npc-relationship-grid">
            
            <!-- Village of Barovia NPCs -->
            <!-- Ireena Kolyana (Existing) -->
            <div class="npc-card">
                <div class="npc-header">
                    <h3>Ireena Kolyana</h3>
                    <span class="npc-status">Tatyana's Reincarnation</span>
                </div>
                <div class="npc-body">
                    <p><strong>Strahd's View:</strong> "My beloved returned to me at last" (Obsessive romantic fixation)</p>
                    <p><strong>Current Status:</strong> Being "courted" through calculated appearances and manipulations</p>
                    <div class="dm-notes">
                        <h4>DM Notes:</h4>
                        <ul>
                            <li>Strahd believes he's being romantic, not predatory</li>
                            <li>Will intervene violently if she's harmed (but won't kill perpetrators - prefers to turn them into spawn)</li>
                            <li>Secretly arranges "chance meetings" in different guises</li>
                        </ul>
                        <h4>Story Hooks:</h4>
                        <ul>
                            <li>Strahd sends gifts signed "Your Most Admiring"</li>
                            <li>Vistani deliver "invitations" to dinner at Ravenloft</li>
                            <li>Werewolves appear to "protect" her from perceived threats</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Ismark the Lesser (NEW) -->
            <div class="npc-card">
                <div class="npc-header">
                    <h3>Ismark the Lesser</h3>
                    <span class="npc-status">The Broken Bulwark</span>
                </div>
                <div class="npc-body">
                    <p><strong>Strahd's View:</strong> "A gnat buzzing around Tatyana" (Barely acknowledges)</p>
                    <p><strong>Current Status:</strong> Begging adventurers to escort Ireena to safety</p>
                    <div class="dm-notes">
                        <h4>DM Notes:</h4>
                        <ul>
                            <li>Strahd could kill him instantly but finds his efforts pitifully amusing</li>
                            <li>Ismark's sword is a silent family heirloom from Sergei</li>
                            <li>Will drink himself to death if Ireena dies or turns</li>
                        </ul>
                        <h4>Roleplaying Tips:</h4>
                        <ul>
                            <li>Desperate but honorable - won't abandon his people</li>
                            <li>Secretly fears he's as ineffective as his late father</li>
                            <li>His full title is "Ismark the Lesser, Burgomaster of Barovia"</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Father Donavich (NEW) -->
            <div class="npc-card">
                <div class="npc-header">
                    <h3>Father Donavich</h3>
                    <span class="npc-status">The Broken Shepherd</span>
                </div>
                <div class="npc-body">
                    <p><strong>Strahd's View:</strong> "A broken toy" (Ignores him)</p>
                    <p><strong>Current Status:</strong> Keeping son Doru chained in church basement</p>
                    <div class="dm-notes">
                        <h4>DM Notes:</h4>
                        <ul>
                            <li>Strahd turned Doru to punish the village's faith</li>
                            <li>If Doru is killed, Donavich hangs himself in the bell tower</li>
                            <li>His holy symbol is cracked but still faintly glows</li>
                        </ul>
                        <h4>Potential Scenes:</h4>
                        <ul>
                            <li>Begs PCs to find a "cure" for vampirism</li>
                            <li>Attempts to feed his own blood to Doru in secret</li>
                            <li>Final prayer scene if Doru is destroyed</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Vallaki NPCs -->
            <!-- Van Richten (Existing) -->
            <div class="npc-card">
                <div class="npc-header">
                    <h3>Van Richten</h3>
                    <span class="npc-status">The Vampire Hunter</span>
                </div>
                <div class="npc-body">
                    <p><strong>Strahd's View:</strong> "Finally, worthy prey" (Dangerous but entertaining)</p>
                    <p><strong>Current Status:</strong> Active but hidden in Vallaki</p>
                    <div class="dm-notes">
                        <h4>DM Notes:</h4>
                        <ul>
                            <li>Strahd could kill him anytime but enjoys the game</li>
                            <li>Allows Van Richten to operate as a challenge</li>
                            <li>Secretly hopes he'll find a way to break the curse</li>
                        </ul>
                        <h4>Cat & Mouse Game:</h4>
                        <ul>
                            <li>Strahd leaves cryptic notes signed "Your Greatest Fan"</li>
                            <li>Arranges for monsters to attack at dramatic moments</li>
                            <li>Never attacks directly - always through proxies first</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Vargas Vallakovich (NEW) -->
            <div class="npc-card">
                <div class="npc-header">
                    <h3>Vargas Vallakovich</h3>
                    <span class="npc-status">The Happiness Tyrant</span>
                </div>
                <div class="npc-body">
                    <p><strong>Strahd's View:</strong> "A useful fool" (Lets him enforce order)</p>
                    <p><strong>Current Status:</strong> Enforcing mandatory festivals</p>
                    <div class="dm-notes">
                        <h4>DM Notes:</h4>
                        <ul>
                            <li>Strahd allows his rule because it breeds despair</li>
                            <li>His son Victor is secretly practicing dangerous magic</li>
                            <li>Will be publicly executed if Wachter takes over</li>
                        </ul>
                        <h4>Festival Madness:</h4>
                        <ul>
                            <li>Forces townsfolk to smile or face the stocks</li>
                            <li>Claims "Strahd is just a story" despite knowing the truth</li>
                            <li>His wife Lydia is heavily sedated</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Lady Fiona Wachter (NEW) -->
            <div class="npc-card">
                <div class="npc-header">
                    <h3>Lady Fiona Wachter</h3>
                    <span class="npc-status">The Serpent of Vallaki</span>
                </div>
                <div class="npc-body">
                    <p><strong>Strahd's View:</strong> "A useful fanatic" (Exploits her devotion)</p>
                    <p><strong>Current Status:</strong> Planting cultists to overthrow Vargas</p>
                    <div class="dm-notes">
                        <h4>DM Notes:</h4>
                        <ul>
                            <li>Strahd sends her cryptic dreams to manipulate her</li>
                            <li>Her cultists wear raven feathers (mocking the wereravens)</li>
                            <li>Her late husband was fed to Strahd's consorts</li>
                        </ul>
                        <h4>Political Plays:</h4>
                        <ul>
                            <li>Frames Vargas' supporters for crimes</li>
                            <li>Uses her sons as enforcers</li>
                            <li>Keeps a Strahd "shrine" hidden in her attic</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Blinsky (NEW) -->
            <div class="npc-card">
                <div class="npc-header">
                    <h3>Blinsky</h3>
                    <span class="npc-status">The Toymaker</span>
                </div>
                <div class="npc-body">
                    <p><strong>Strahd's View:</strong> "A harmless curiosity" (Occasionally amused)</p>
                    <p><strong>Current Status:</strong> Making creepy dolls for Izek</p>
                    <div class="dm-notes">
                        <h4>DM Notes:</h4>
                        <ul>
                            <li>His "Is No Fun, Is No Blinsky!" catchphrase hides deep sadness</li>
                            <li>Unwittingly makes dolls resembling past Tatyana incarnations</li>
                            <li>Will be killed by Izek if the dolls stop coming</li>
                        </ul>
                        <h4>Creepy Details:</h4>
                        <ul>
                            <li>Dolls sometimes move when no one's looking</li>
                            <li>His workshop has a hidden door to the orphanage</li>
                            <li>Knows Izek's childhood secrets but is too afraid to tell</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Krezk NPCs -->
            <!-- The Abbot (Existing) -->
            <div class="npc-card">
                <div class="npc-header">
                    <h3>The Abbot</h3>
                    <span class="npc-status">Fallen Deva</span>
                </div>
                <div class="npc-body">
                    <p><strong>Strahd's View:</strong> "A fascinating experiment" (Scientific curiosity)</p>
                    <p><strong>Current Status:</strong> Tolerated for his creations</p>
                    <div class="dm-notes">
                        <h4>DM Notes:</h4>
                        <ul>
                            <li>Strahd provides corpses for the Abbot's work</li>
                            <li>Considers him a case study in celestial corruption</li>
                            <li>Will destroy him if he actually threatens the status quo</li>
                        </ul>
                        <h4>Twisted Dynamics:</h4>
                        <ul>
                            <li>Strahd visits the Abbey for "philosophical discussions"</li>
                            <li>Leads the Abbot deeper into madness with false hope</li>
                            <li>Uses Vasilka as potential leverage over Ireena</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Castle Ravenloft NPCs -->
            <!-- Rahadin (Existing) -->
            <div class="npc-card">
                <div class="npc-header">
                    <h3>Rahadin</h3>
                    <span class="npc-status">Eternal Chamberlain</span>
                </div>
                <div class="npc-body">
                    <p><strong>Strahd's View:</strong> "My most trusted blade" (Loyal executioner and confidant)</p>
                    <p><strong>Current Status:</strong> Oversees daily operations of Ravenloft</p>
                    <div class="dm-notes">
                        <h4>DM Notes:</h4>
                        <ul>
                            <li>The only being Strahd genuinely trusts</li>
                            <li>Knows all of Strahd's secrets except his true feelings about Sergei</li>
                            <li>Will take initiative to eliminate threats without orders</li>
                        </ul>
                        <h4>Behavior Patterns:</h4>
                        <ul>
                            <li>Always addresses Strahd as "My Lord" never "Master"</li>
                            <li>Wears Elven mourning garb for the people he slaughtered</li>
                            <li>Deathly whisper ability reflects his guilt</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Escher (Existing) -->
            <div class="npc-card">
                <div class="npc-header">
                    <h3>Escher</h3>
                    <span class="npc-status">Consort in Waiting</span>
                </div>
                <div class="npc-body">
                    <p><strong>Strahd's View:</strong> "An amusing diversion" (Kept for resemblance to Sergei)</p>
                    <p><strong>Current Status:</strong> Growing jealous of Ireena</p>
                    <div class="dm-notes">
                        <h4>DM Notes:</h4>
                        <ul>
                            <li>Strahd turns a blind eye to Escher's petty schemes</li>
                            <li>Will sacrifice Escher without hesitation if needed</li>
                            <li>Secretly hopes to replace Ireena in Strahd's affections</li>
                        </ul>
                        <h4>Potential Scenes:</h4>
                        <ul>
                            <li>Escher leaks information to players to undermine Strahd</li>
                            <li>Attempts to sabotage Ireena's safety</li>
                            <li>Dramatic final confrontation when discarded</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Cyrus Belview (NEW) -->
            <div class="npc-card">
                <div class="npc-header">
                    <h3>Cyrus Belview</h3>
                    <span class="npc-status">The Broken Butler</span>
                </div>
                <div class="npc-body">
                    <p><strong>Strahd's View:</strong> "A living joke" (Mocking tolerance)</p>
                    <p><strong>Current Status:</strong> Serving dinner to guests</p>
                    <div class="dm-notes">
                        <h4>DM Notes:</h4>
                        <ul>
                            <li>Strahd keeps him as proof of the Abbot's "failures"</li>
                            <li>Will cry if treated kindly (hasn't experienced kindness in decades)</li>
                            <li>Knows secret passages but is too afraid to reveal them</li>
                        </ul>
                        <h4>Tragic Details:</h4>
                        <ul>
                            <li>His face is stitched together from multiple people</li>
                            <li>Whispers "please don't look at me" when serving food</li>
                            <li>Carries a tiny doll made from dinner napkins</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Other Major NPCs -->
            <!-- Madam Eva (Existing) -->
            <div class="npc-card">
                <div class="npc-header">
                    <h3>Madam Eva</h3>
                    <span class="npc-status">Vistani Matriarch</span>
                </div>
                <div class="npc-body">
                    <p><strong>Strahd's View:</strong> "A useful oracle" (Respects but doesn't trust)</p>
                    <p><strong>Current Status:</strong> Maintains careful neutrality</p>
                    <div class="dm-notes">
                        <h4>DM Notes:</h4>
                        <ul>
                            <li>Strahd suspects she helps adventurers but can't prove it</li>
                            <li>Their relationship is a delicate balance of power</li>
                            <li>She knows more about the curse than she reveals</li>
                        </ul>
                        <h4>Roleplaying Tips:</h4>
                        <ul>
                            <li>Always speaks in riddles around Strahd</li>
                            <li>Uses tarokka cards to warn without directly opposing</li>
                            <li>Her wagon is neutral ground even Strahd honors</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Baba Lysaga (Existing) -->
            <div class="npc-card">
                <div class="npc-header">
                    <h3>Baba Lysaga</h3>
                    <span class="npc-status">Witch Mother</span>
                </div>
                <div class="npc-body">
                    <p><strong>Strahd's View:</strong> "A persistent delusion" (Denies their connection)</p>
                    <p><strong>Current Status:</strong> Secretly protects him from afar</p>
                    <div class="dm-notes">
                        <h4>DM Notes:</h4>
                        <ul>
                            <li>Strahd knows the truth but refuses to acknowledge it</li>
                            <li>Allows her to live only because she's useful</li>
                            <li>Her death would trigger rare genuine anger</li>
                        </ul>
                        <h4>Complex Relationship:</h4>
                        <ul>
                            <li>She attacks anyone who mentions being his mother</li>
                            <li>Her hut moves to intercept threats to Ravenloft</li>
                            <li>Strahd never visits Berez but knows everything happening there</li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>
        
        <!-- DM Tips Section (Existing) -->
        <div class="box-highlight">
            <h3>Running NPC Interactions: Advanced DM Tips</h3>
            <div class="row">
                <div class="col">
                    <h4>Strahd's Social Tactics</h4>
                    <ul>
                        <li><strong>The Aristocrat:</strong> Flawless manners when first meeting NPCs</li>
                        <li><strong>The Benefactor:</strong> Offers gifts with hidden strings attached</li>
                        <li><strong>The Confessor:</strong> Shares "vulnerabilities" to test loyalty</li>
                        <li><strong>The Patron:</strong> Sponsors artists/scholars to corrupt them</li>
                    </ul>
                </div>
                <div class="col">
                    <h4>Relationship Arcs</h4>
                    <ul>
                        <li><strong>Ireena:</strong> Obsession ‚Üí Possession ‚Üí Tragedy</li>
                        <li><strong>Van Richten:</strong> Amusement ‚Üí Respect ‚Üí Final Confrontation</li>
                        <li><strong>The Abbot:</strong> Curiosity ‚Üí Disappointment ‚Üí Disposal</li>
                        <li><strong>Baba Lysaga:</strong> Denial ‚Üí Crisis ‚Üí Violent Rejection</li>
                        <li><strong>Vargas:</strong> Tolerance ‚Üí Contempt ‚Üí Execution</li>
                        <li><strong>Fiona:</strong> Amusement ‚Üí Annoyance ‚Üí Discard</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Strahd's Abilities -->
<h2 class="section-title" id="strahd-abilities">
    <div class="section-header">
        <span>STRAHD'S ABILITIES</span>
        <label class="print-selector">
            <input type="checkbox" class="section-checkbox" data-section="strahd-abilities">
             
        </label>
    </div>
</h2>
<div class="collapsible-content">
    <div class="box">
        <div class="row">
            <div class="col">
                <h3 class="box-subtitle">VAMPIRE TRAITS</h3>
                <p><strong>Shapechanger:</strong> Can transform into a bat, wolf, or mist</p>
                <p><strong>Legendary Resistance (3/Day):</strong> Can succeed on failed saving throw</p>
                <p><strong>Misty Escape:</strong> When dropping to 0 HP outside sunlight/running water, transforms into mist</p>
                <p><strong>Regeneration:</strong> 20 HP at start of turn (unless took radiant damage or in running water)</p>
                <p><strong>Spider Climb:</strong> Can move on walls/ceilings without ability checks</p>
                <p><strong>Vampire Weaknesses:</strong> 
                    <button class="roll-button" onclick="rollRandomWeakness()">Random Weakness</button>
                    <div id="weaknessResult" class="dice-result"></div>
                    <ol>
                        <li><strong>Running Water:</strong> Takes 20 acid damage when starts turn in it</li>
                        <li><strong>Sunlight:</strong> Disables regeneration, takes 20 radiant damage per turn</li>
                        <li><strong>Stake to Heart:</strong> Paralyzed if wooden stake pierces heart</li>
                        <li><strong>Holy Symbols:</strong> Can't touch or willingly enter space with one</li>
                    </ol>
                </p>
                
                <h3 class="box-subtitle">LEGENDARY ACTIONS (3/round)</h3>
<div class="legendary-actions-help">
    <p class="legendary-note">üîÑ <strong>Special turns between turns:</strong> Strahd can take 3 extra actions per round, spread out between other creatures' turns.</p>
</div>
<ul>
    <li>
        <strong>Move:</strong> Strahd glides up to 30 feet without provoking opportunity attacks
        <div class="action-example">Example: Moves behind cover after a player's attack</div>
    </li>
    <li>
        <strong>Unarmed Strike:</strong> 
        <button class="roll-button" onclick="rollAttack(9, '1d8+4', '4d6', 'necrotic')">Attack</button>
        <div id="unarmedResult" class="dice-result"></div>
        <div class="action-example">Example: Punches a cleric who just cast healing</div>
    </li>
    <li>
        <strong>Bite (Costs 2 actions):</strong> 
        <button class="roll-button" onclick="rollAttack(9, '1d8+4', '4d6', 'necrotic (max HP reduction)')">Attack</button>
        <div id="biteResult" class="dice-result"></div>
        <div class="action-example">Example: Drains blood from a grappled foe</div>
    </li>
</ul>
            </div>
            <div class="col">
                <h3 class="box-subtitle">COMBAT STATS</h3>
                <table>
                    <tr>
                        <td><strong>AC:</strong></td>
                        <td>16 (natural armor)</td>
                    </tr>
                    <tr>
                        <td><strong>HP:</strong></td>
                        <td>144 (17d8 + 68)</td>
                    </tr>
                    <tr>
                        <td><strong>Saving Throws:</strong></td>
                        <td>
                            <button class="roll-button" onclick="rollSavingThrow('Dexterity', 9)">Dex +9</button>
                            <button class="roll-button" onclick="rollSavingThrow('Wisdom', 7)">Wis +7</button>
                            <button class="roll-button" onclick="rollSavingThrow('Charisma', 9)">Cha +9</button>
                            <div id="savingThrowResult" class="dice-result"></div>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Skills:</strong></td>
                        <td>
                            <button class="roll-button" onclick="rollSkillCheck('Arcana', 15)">Arcana +15</button>
                            <button class="roll-button" onclick="rollSkillCheck('Perception', 12)">Perception +12</button>
                            <button class="roll-button" onclick="rollSkillCheck('Religion', 10)">Religion +10</button>
                            <button class="roll-button" onclick="rollSkillCheck('Stealth', 14)">Stealth +14</button>
                            <div id="skillCheckResult" class="dice-result"></div>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Resistances:</strong></td>
                        <td>necrotic; bludgeoning, piercing, and slashing from nonmagical attacks</td>
                    </tr>
                    <tr>
                        <td><strong>Challenge:</strong></td>
                        <td>15 (13,000 XP)</td>
                    </tr>
                </table>
                
                <h3 class="box-subtitle">SPELLS (Caster Level 9)</h3>
                <p><strong>Cantrips (at will):</strong> Mage Hand, Prestidigitation</p>
                <p><strong>1st (4 slots):</strong> Charm Person, Sleep</p>
                <p><strong>2nd (3 slots):</strong> Invisibility, Misty Step</p>
                <p><strong>3rd (3 slots):</strong> Fear, Fireball</p>
                <p><strong>4th (3 slots):</strong> Greater Invisibility, Polymorph</p>
                <p><strong>5th (1 slot):</strong> Animate Objects, Scrying</p>
            </div>
        </div>
    </div>
</div>

<!-- Visceral Descriptors -->
<h2 class="section-title" id="descriptors">
    <div class="section-header">
        <span>DESCRIPTORS</span>
        <label class="print-selector">
            <input type="checkbox" class="section-checkbox" data-section="descriptors">
             
        </label>
    </div>
</h2>
<div class="collapsible-content">
    <div class="row">
        <div class="col">
            <div class="box">
                <h3 class="box-title">ENVIRONMENTAL DESCRIPTIONS</h3>
                <div class="row">
                    <div class="col">
                        <h4 class="box-subtitle">Roads:</h4>
                        <ul>
                            <li>The packed earth of the road sucks at your boots like greedy mouths</li>
                            <li>Fog coils around your ankles like spectral serpents</li>
                            <li>Wheel ruts fill with rainwater the color of diluted blood</li>
                            <li>Bare branches scrape together like bones in the wind</li>
                            <li>Your breath fogs in air that smells of wet earth and rotting leaves</li>
                            <li>The road forks like a broken wishbone</li>
                            <li>Cold mud squelches underfoot with the sound of something breathing</li>
                            <li>Each footstep is swallowed by silence too deep to be natural</li>
                            <li>Cracked stones form runes no one recognizes</li>
                            <li>The path winds like a serpent through the trees</li>
                            <li>The air here hums with static, like the moment before a storm</li>
                            <li>Carved symbols in the mile-markers are freshly bleeding sap</li>
                            <li>Faint hoofprints vanish halfway down the lane</li>
                            <li>You pass a child's toy, sodden with rain and caked in blood</li>
                            <li>A distant bell rings‚Äîthough no village lies ahead</li>
                        </ul>
                    </div>
                    <div class="col">
                        <h4 class="box-subtitle">Forests:</h4>
                        <ul>
                            <li>Tree bark peels away in fleshy strips revealing pulpy wood beneath</li>
                            <li>Fungus grows in pulsating clusters that release spores when disturbed</li>
                            <li>Roots twist up from the earth like the fingers of buried corpses</li>
                            <li>The canopy blocks all light, leaving you in perpetual twilight</li>
                            <li>Something large moves just out of sight, snapping branches as it goes</li>
                            <li>The air is thick with the hum of insects you never see</li>
                            <li>A murder of crows follows you from tree to tree, always silent</li>
                            <li>The moss on the trees seems to squirm when touched</li>
                            <li>You come across claw marks too high for any beast</li>
                            <li>Every trunk seems to lean subtly toward the path, listening</li>
                            <li>The smell of copper lingers despite no visible wound</li>
                            <li>You find a skeleton impaled on a branch ten feet above the ground</li>
                            <li>Birdsong is absent. The forest breathes, and waits</li>
                            <li>A tree is split open, its sap thick and red as blood</li>
                            <li>Your shadow doesn‚Äôt match your movement under the trees</li>
                        </ul>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <h4 class="box-subtitle">Settlements:</h4>
                        <ul>
                            <li>Windows watch you like the empty eye sockets of skulls</li>
                            <li>Chimney smoke hangs thick, carrying the scent of burnt hair</li>
                            <li>Doorways gape like hungry mouths waiting to swallow the unwary</li>
                            <li>Puddles reflect not your face but something lurking behind you</li>
                            <li>The creak of signs in the wind sounds like dying men's last breaths</li>
                            <li>Every building leans slightly toward you, expectantly</li>
                            <li>Children‚Äôs laughter echoes in alleys devoid of children</li>
                            <li>The innkeeper greets you with a phrase you've heard in your dreams</li>
                            <li>All clocks in town have stopped at the same time</li>
                            <li>A dog stares at you unblinking, unmoving, until you leave</li>
                            <li>A market stall sells dolls that resemble your companions</li>
                            <li>Despite the season, every house displays funeral wreaths</li>
                            <li>Steps echo above you on rooftops‚Äîno one is there</li>
                            <li>Doors are bolted shut with symbols scrawled in ash</li>
                            <li>The statue in the square weeps blood each dusk</li>
                        </ul>
                    </div>
                    <div class="col">
                        <h4 class="box-subtitle">Mountains:</h4>
                        <ul>
                            <li>Rock faces weep icy tears that freeze on your clothes</li>
                            <li>Wind howls through passes like the wails of the damned</li>
                            <li>Loose stones clatter down slopes like fleeing creatures</li>
                            <li>Cliffs loom overhead like the battlements of some giant's fortress</li>
                            <li>Your footsteps echo as if something walks just out of sync behind you</li>
                            <li>Clouds gather swiftly, like a shroud pulling tight</li>
                            <li>Strange symbols carved into the rock glow faintly at night</li>
                            <li>Echoes reply with voices not your own</li>
                            <li>The air thins, but you hear someone breathing beside you</li>
                            <li>Spindly trees grow sideways, as though fleeing the peak</li>
                            <li>An ancient shrine crumbles into dust as you approach</li>
                            <li>The trail vanishes, though you never strayed</li>
                            <li>A goat watches you too intently‚Äîand does not blink</li>
                            <li>Icicles form the shape of faces mid-scream</li>
                            <li>You hear a lullaby sung in a language you don‚Äôt speak</li>
                        </ul>
                    </div>
                </div>

                <div class="box" style="margin-top: 25px;">
                    <h3 class="box-subtitle">UNSETTLING SENSATIONS (d20): <button class="roll-button" onclick="rollDice('1d20')">Roll</button></h3>
                    <ol>
                        <li><strong>Tactile:</strong> Cobwebs cling like fingers. Stones warm as flesh.</li>
                        <li><strong>Auditory:</strong> Children laughing in empty rooms. Whispers from nowhere.</li>
                        <li><strong>Olfactory:</strong> The sharp scent of bleach in the middle of the woods.</li>
                        <li><strong>Visual:</strong> Your shadow moves just a beat too slow.</li>
                        <li><strong>Temporal:</strong> You blink and it's suddenly dusk.</li>
                        <li><strong>Proprioceptive:</strong> Your limbs feel slightly too long or too short.</li>
                        <li><strong>Tactile:</strong> The sensation of ants crawling beneath your skin.</li>
                        <li><strong>Auditory:</strong> Echoes that repeat words you haven‚Äôt spoken yet.</li>
                        <li><strong>Olfactory:</strong> The smell of someone you loved, long dead.</li>
                        <li><strong>Visual:</strong> Your reflection blinks out of sync with you.</li>
                        <li><strong>Temporal:</strong> A memory plays in your mind as if it‚Äôs happening now.</li>
                        <li><strong>Proprioceptive:</strong> You feel heavier‚Äîas if gravity is stronger here.</li>
                        <li><strong>Auditory:</strong> The sound of breathing where no one stands.</li>
                        <li><strong>Tactile:</strong> Something brushes your neck, but nothing‚Äôs there.</li>
                        <li><strong>Olfactory:</strong> The air reeks of wet fur and rusting iron.</li>
                        <li><strong>Visual:</strong> The stars above form an unfamiliar constellation.</li>
                        <li><strong>Temporal:</strong> Your watch spins uncontrollably then stops.</li>
                        <li><strong>Proprioceptive:</strong> You swear your heartbeat has an echo.</li>
                        <li><strong>Auditory:</strong> Bells toll with no visible tower nearby.</li>
                        <li><strong>Visual:</strong> You see a familiar face among the trees, but it vanishes.</li>
                    </ol>
                    <p><em>Usage:</em> Roll when players enter new areas. Describe without explanation.</p>
                </div>
            </div>
        </div>
    </div>
</div>


<button class="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">‚Üë</button>


<!-- Player Sidebar -->
<div id="player-sidebar" class="sidebar">
    <div class="sidebar-header">
        <h3>PLAYER TRACKER</h3>
        <button id="add-player" class="add-player-btn">+ Add Player</button>
    </div>
    <div id="player-list">
        <!-- Players will be added here dynamically -->
    </div>
</div>

<button class="dark-mode-toggle" onclick="toggleDarkMode()">‚òÄÔ∏è</button>

<!-- Your other HTML code above -->

<footer>
    <div class="strahd-eyes-container blink">
      <div class="strahd-eye strahd-eye-left">
        <div class="strahd-pupil"></div>
        <div class="eyelid"></div>
      </div>
      <div class="strahd-eye strahd-eye-right">
        <div class="strahd-pupil"></div>
        <div class="eyelid"></div>
      </div>
      <div class="strahd-fangs"></div>
    </div>
    
    <div class="screen-footer">
        <p>Made with ‚ù§Ô∏è by Nat20</p>
        <p>For more RPG tools and resources:</p>
        <a href="https://beacons.bio/youwannaplay" target="_blank">
            <img src="images/qr-code.png" alt="QR Code to Beacons.bio" class="qr-code">
        </a>
        <p>Scan or visit: beacons.bio/youwannaplay</p>
    </div>

    <div class="print-footer">
        <p>Printed from Curse of Strahd DM Cheat Sheet | Created by Jimpeccable | Nat20 Community</p>
        <p>For more RPG resources: 
            <img src="qr-code.png" alt="QR Code to Nat20's Beacons.bio" class="qr-code">
            beacons.bio/youwannaplay
        </p>
    </div>
</footer>


<script>
// Player Tracker Functions
document.addEventListener('DOMContentLoaded', function() {
    // Initialize sidebar toggle button
    const toggleBtn = document.createElement('button');
    toggleBtn.className = 'sidebar-toggle';
    toggleBtn.textContent = 'PLAYERS ‚ñ∫';
    toggleBtn.onclick = toggleSidebar;
    document.body.appendChild(toggleBtn);
    
    // Load saved players
    loadPlayers();
    
    // Add player button functionality
    document.getElementById('add-player').addEventListener('click', function() {
        addNewPlayer();
    });
});

function removePlayer(id) {
    const player = document.getElementById(id);
    if (player) player.remove();
}

function toggleStatus(id) {
    const button = document.getElementById(id)?.querySelector('.status-toggle');
    if (!button) return;
    
    const statuses = ['Normal', 'Affected', 'Madness', 'Despair', 'Corrupted'];
    const currentIndex = statuses.indexOf(button.textContent);
    const nextIndex = (currentIndex + 1) % statuses.length;
    button.textContent = statuses[nextIndex];
    
    button.className = 'status-toggle';
    if (nextIndex > 0) {
        button.classList.add('active');
    }
}

// Sidebar toggle functionality
function toggleSidebar() {
    const sidebar = document.getElementById('player-sidebar');
    sidebar.classList.toggle('open');
    
    const toggleBtn = document.querySelector('.sidebar-toggle');
    if (sidebar.classList.contains('open')) {
        toggleBtn.textContent = '‚óÑ PLAYERS';
        toggleBtn.style.right = '320px';
    } else {
        toggleBtn.textContent = 'PLAYERS ‚ñ∫';
        toggleBtn.style.right = '20px';
    }
}

// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Initialize with 4 empty player slots
    const playerList = document.getElementById('player-list');
    if (playerList) {
        for (let i = 0; i < 1; i++) {
            addPlayer();
        }
    }
    
    // Initialize sidebar in closed state
    const sidebar = document.getElementById('player-sidebar');
    if (sidebar) sidebar.classList.remove('open');
    
    // Add sidebar toggle button if it doesn't exist
    if (!document.querySelector('.sidebar-toggle')) {
        const toggleBtn = document.createElement('button');
        toggleBtn.className = 'sidebar-toggle';
        toggleBtn.textContent = 'PLAYERS ‚ñ∫';
        toggleBtn.onclick = toggleSidebar;
        toggleBtn.style.position = 'fixed';
        toggleBtn.style.right = '20px';
        toggleBtn.style.top = '20px';
        toggleBtn.style.zIndex = '1001';
        document.body.appendChild(toggleBtn);
    }
});

// Dark mode toggle
function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const button = document.querySelector('.dark-mode-toggle');
    if (button) {
        button.textContent = document.body.classList.contains('dark-mode') ? 'üåô' : '‚òÄÔ∏è';
    }
}

// Collapsible sections
document.querySelectorAll('.section-title').forEach(title => {
    title.addEventListener('click', () => {
        const content = title.nextElementSibling;
        if (content) {
            content.style.maxHeight = content.style.maxHeight ? null : content.scrollHeight + 'px';
            title.classList.toggle('active');
        }
    });
});

// Tab system
function openTab(evt, tabName) {
    const tabContents = document.getElementsByClassName('tab-content');
    for (let i = 0; i < tabContents.length; i++) {
        tabContents[i].classList.remove('active');
    }
    
    const tabButtons = document.getElementsByClassName('tab-button');
    for (let i = 0; i < tabButtons.length; i++) {
        tabButtons[i].classList.remove('active');
    }
    
    document.getElementById(tabName)?.classList.add('active');
    evt.currentTarget?.classList.add('active');
}

// Search functionality
const searchInput = document.getElementById('search-input');
if (searchInput) {
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        if (searchTerm.length < 3) {
            removeHighlights();
            return;
        }
        
        removeHighlights();
        
        const textNodes = [];
        const walker = document.createTreeWalker(
            document.body,
            NodeFilter.SHOW_TEXT,
            null,
            false
        );
        
        let node;
        while (node = walker.nextNode()) {
            if (node.nodeValue.trim() !== '') {
                textNodes.push(node);
            }
        }
        
        textNodes.forEach(textNode => {
            const content = textNode.nodeValue;
            const index = content.toLowerCase().indexOf(searchTerm);
            
            if (index !== -1) {
                const parent = textNode.parentNode;
                if (parent.childNodes.length === 1 && parent.nodeName !== 'SCRIPT' && parent.nodeName !== 'STYLE') {
                    const newContent = content.substring(0, index) +
                        '<span class="highlight">' +
                        content.substring(index, index + searchTerm.length) +
                        '</span>' +
                        content.substring(index + searchTerm.length);
                    
                    const newElement = document.createElement('span');
                    newElement.innerHTML = newContent;
                    parent.replaceWith(newElement);
                }
            }
        });
    });
}

function removeHighlights() {
    const highlights = document.querySelectorAll('.highlight');
    highlights.forEach(highlight => {
        const parent = highlight.parentNode;
        parent.replaceWith(parent.textContent);
    });
}

// Quick roll buttons
function rollDice(dice) {
    const [numDice, numSides] = dice.split('d');
    let result = 0;
    let rolls = [];
    
    if (dice.includes('+')) {
        const parts = dice.split('+');
        const bonus = parseInt(parts[1]);
        const [d, s] = parts[0].split('d');
        
        for (let i = 0; i < parseInt(d); i++) {
            const roll = Math.floor(Math.random() * parseInt(s)) + 1;
            rolls.push(roll);
            result += roll;
        }
        
        result += bonus;
        alert(`Rolled ${dice}: ${rolls.join(' + ')} + ${bonus} = ${result}`);
    } else {
        for (let i = 0; i < parseInt(numDice); i++) {
            const roll = Math.floor(Math.random() * parseInt(numSides)) + 1;
            rolls.push(roll);
            result += roll;
        }
        
        if (numDice > 1) {
            alert(`Rolled ${dice}: ${rolls.join(' + ')} = ${result}`);
        } else {
            alert(`Rolled ${dice}: ${result}`);
        }
    }
}

// Back to top button
window.onscroll = function() {
    const btn = document.querySelector('.back-to-top');
    if (btn) {
        btn.style.display = (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) ? 'block' : 'none';
    }
};


// Tab system for quick navigation
function showTab(tabName) {
  // Hide all tab contents
  const tabContents = document.querySelectorAll('.quick-nav .tab-content');
  tabContents.forEach(tab => {
    tab.style.display = 'none';
  });
  
  // Show the selected tab content
  const tabToShow = document.getElementById(tabName);
  if (tabToShow) {
    tabToShow.style.display = 'block';
  }
}

// Function to roll a single die
function rollDie(sides) {
    return Math.floor(Math.random() * sides) + 1;
}

// Function to parse and roll dice notation (like "2d6+3")
function rollDiceNotation(notation) {
    const parts = notation.split(/([+-])/);
    let total = 0;
    let currentOp = '+';
    
    for (let part of parts) {
        if (part === '+' || part === '-') {
            currentOp = part;
            continue;
        }
        
        if (part.includes('d')) {
            const [count, sides] = part.split('d').map(Number);
            let sum = 0;
            for (let i = 0; i < count; i++) {
                sum += rollDie(sides);
            }
            total = currentOp === '+' ? total + sum : total - sum;
        } else if (part) {
            const num = parseInt(part, 10);
            total = currentOp === '+' ? total + num : total - num;
        }
    }
    
    return total;
}

// Roll a saving throw
function rollSavingThrow(ability, modifier) {
    const roll = rollDie(20);
    const total = roll + modifier;
    const resultElement = document.getElementById('savingThrowResult');
    resultElement.innerHTML = `
        <strong>${ability} Save:</strong> ${roll} + ${modifier} = <strong>${total}</strong>
        ${roll === 20 ? ' (CRITICAL SUCCESS!)' : roll === 1 ? ' (CRITICAL FAILURE!)' : ''}
    `;
}

// Roll a skill check
function rollSkillCheck(skill, modifier) {
    const roll = rollDie(20);
    const total = roll + modifier;
    const resultElement = document.getElementById('skillCheckResult');
    resultElement.innerHTML = `
        <strong>${skill}:</strong> ${roll} + ${modifier} = <strong>${total}</strong>
        ${roll === 20 ? ' (CRITICAL SUCCESS!)' : roll === 1 ? ' (CRITICAL FAILURE!)' : ''}
    `;
}

// Roll an attack
function rollAttack(toHitBonus, damageDice, extraDamageDice, damageType) {
    // Roll to hit
    const attackRoll = rollDie(20);
    const attackTotal = attackRoll + toHitBonus;
    const isCrit = attackRoll === 20;
    
    // Roll damage
    const baseDamage = rollDiceNotation(damageDice);
    let extraDamage = 0;
    if (extraDamageDice) {
        extraDamage = rollDiceNotation(extraDamageDice);
        if (isCrit) {
            extraDamage += rollDiceNotation(extraDamageDice); // Double extra dice on crit
        }
    }
    
    const totalDamage = isCrit ? (baseDamage * 2) + extraDamage : baseDamage + extraDamage;
    
    const resultElement = isCrit ? document.getElementById('biteResult') : document.getElementById('unarmedResult');
    resultElement.innerHTML = `
        <strong>Attack Roll:</strong> ${attackRoll} + ${toHitBonus} = <strong>${attackTotal}</strong>
        ${isCrit ? ' (CRITICAL HIT!)' : attackRoll === 1 ? ' (CRITICAL MISS!)' : ''}<br>
        <strong>Damage:</strong> ${baseDamage}${extraDamage ? ` + ${extraDamage}` : ''} ${damageType} = <strong>${totalDamage}</strong>
    `;
}

// Roll random weakness
function rollRandomWeakness() {
    const weaknessRoll = rollDie(4);
    const weaknesses = [
        "Running Water: Takes 20 acid damage when starts turn in it",
        "Sunlight: Disables regeneration, takes 20 radiant damage per turn",
        "Stake to Heart: Paralyzed if wooden stake pierces heart",
        "Holy Symbols: Can't touch or willingly enter space with one"
    ];
    document.getElementById('weaknessResult').innerHTML = `
        <strong>Weakness:</strong> ${weaknessRoll}. ${weaknesses[weaknessRoll-1]}
    `;
}

/// Enhanced NPC section toggle with animation
    function toggleSection(sectionId) {
        const section = document.getElementById(sectionId);
        const title = section.previousElementSibling;
        
        if (section.style.display === 'none' || !section.style.display) {
            section.style.display = 'grid';
            section.style.maxHeight = '0';
            setTimeout(() => {
                section.style.maxHeight = section.scrollHeight + 'px';
            }, 10);
            title.classList.add('active');
        } else {
            section.style.maxHeight = '0';
            setTimeout(() => {
                section.style.display = 'none';
            }, 300);
            title.classList.remove('active');
        }
    }
    
    // Highlight NPC in relationships section
    function highlightNPC(npcId) {
        // Remove previous highlights
        document.querySelectorAll('.npc-card').forEach(card => {
            card.style.boxShadow = 'none';
            card.style.borderLeft = '4px solid var(--border-color)';
        });
        
        // Add highlight
        const npcCard = document.getElementById(`npc-${npcId}`);
        if (npcCard) {
            npcCard.style.boxShadow = '0 0 10px rgba(139, 0, 0, 0.3)';
            npcCard.style.borderLeft = '4px solid #a30000';
            setTimeout(() => {
                npcCard.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center',
                    inline: 'nearest'
                });
            }, 100);
        }
    }
    
    // Initialize - hide all NPC sections by default
    document.addEventListener('DOMContentLoaded', function() {
        ['village-npcs', 'vallaki-npcs', 'krezk-npcs', 'castle-npcs'].forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.style.display = 'none';
                el.style.transition = 'max-height 0.3s ease-out';
                el.style.overflow = 'hidden';
            }
        });
        
        // Add click handlers to all NPC cards
        document.querySelectorAll('.npc-card-mini').forEach(card => {
            card.addEventListener('click', function() {
                const npcId = this.getAttribute('onclick').match(/highlightNPC\('(.*?)'\)/)[1];
                highlightNPC(npcId);
            });
        });
    });


    function generateNPC(gender) {
    // Ensure the collapsible content is open when generating
    const resultDiv = document.getElementById('npc-result');
    const collapsibleContent = resultDiv.closest('.collapsible-content');
    
    // Save original styles to restore collapse functionality later
    const originalDisplay = collapsibleContent.style.display;
    const originalMaxHeight = collapsibleContent.style.maxHeight;
    const originalOverflow = collapsibleContent.style.overflow;
    
    // Temporarily set styles to ensure content is visible during generation
    collapsibleContent.style.display = 'block';
    collapsibleContent.style.maxHeight = 'none';
    collapsibleContent.style.overflow = 'visible';
    
    // Clear previous result with animation
    resultDiv.style.opacity = '0';
    resultDiv.style.transform = 'translateY(-10px)';

    // Gender selection logic
    if (gender === 'any') {
        gender = Math.random() > 0.5 ? 'male' : 'female';
    }

    // Names database
    const maleNames = ["Alek", "Andrej", "Anton", "Balthazar", "Bogan", "Boris", "Dargos", "Darzin", "Dragomir", "Emeric", "Falkon", "Frederich", "Franz", "Gargosh", "Gorek", "Grygori", "Hans", "Harkus", "Ivan", "Jirko", "Kobal", "Korga", "Krystofor", "Lazlo", "Livius", "Marek", "Miroslav", "Nikolaj", "Nimir", "Oleg", "Radovan", "Radu", "Seraz", "Sergei", "Stefan", "Tural", "Valentin", "Vasily", "Vladislav", "Waltar", "Yesper", "Zsolt"];
    const femaleNames = ["Alana", "Clavdia", "Danya", "Dezdrelda", "Diavola", "Dorina", "Drasha", "Drilvia", "Elisabeta", "Fatima", "Grilsha", "Isabella", "Ivana", "Jarzinka", "Kala", "Katerina", "Kereza", "Korina", "Lavinia", "Magda", "Marta", "Mathilda", "Minodora", "Mirabel", "Miruna", "Nimira", "Nyanka", "Olivenka", "Ruxandra", "Sorina", "Tereska", "Valentina", "Vasha", "Victoria", "Wensencia", "Zondra"];
    const familyNames = ["Alastroi", "Antonovich", "Barthos", "Belasco", "Cantemir", "Dargovich", "Diavolov", "Diminski", "Dilisnya", "Drazkoi", "Garvinski", "Grejenko", "Groza", "Grygorovich", "Ivanovich", "Janek", "Karushkin", "Konstantinovich", "Krezkov", "Krykski", "Lansten", "Lazarescu", "Lukresh", "Lipsiege", "Martikov", "Mironovich", "Moldovar", "Nikolovich", "Nimirovich", "Oronovich", "Petrovich", "Polensky", "Radovich", "Rilsky", "Stefanovich", "Strazni", "Swilovich", "Taltos", "Targolov", "Tyminski", "Ulbrek", "Ulrich", "Vadu", "Voltanescu", "Zalenski", "Zalken"];

    const malePortraits = [
        "https://i.pinimg.com/236x/ae/c9/bb/aec9bbe4d2756426b20b54d0b66736bd.jpg",
        "https://i.pinimg.com/236x/eb/50/c8/eb50c89b56aa4dc51634403b0ceef259.jpg",
        "https://i.pinimg.com/736x/93/d8/d2/93d8d273434db9b60aa47c26520eda60.jpg",
        "https://i.pinimg.com/236x/6d/09/f0/6d09f0833270538d709581cfe42bb8d3.jpg",
        "https://i.pinimg.com/236x/2d/b7/b7/2db7b7e559f7bc9556820b8b22bb6eae.jpg",
        "https://i.pinimg.com/564x/2c/72/40/2c7240b4e205b31668fd5b3048188575.jpg",
        "https://i.pinimg.com/474x/2a/6f/31/2a6f3178a1b273e853c67b9cf8c58265.jpg",
        "https://i.pinimg.com/474x/a4/eb/e0/a4ebe023bc751f6a23a3125f7cae341e.jpg",
        "https://i.pinimg.com/564x/8c/ff/4c/8cff4cede09d58fb7738f04750416613.jpg",
        "https://i.pinimg.com/736x/09/5e/89/095e891a798b16b57ce463db51386578.jpg",
    ];
    const femalePortraits = [
        "https://i.pinimg.com/736x/8a/9d/2d/8a9d2d45e80763ff3ff988e092e14f9b.jpg",
        "https://img.freepik.com/premium-photo/woman-with-long-hair-green-dress-with-white-collar-long-skirt_579873-4845.jpg",
        "https://i.pinimg.com/736x/27/65/d1/2765d174c346def20f8470bde5fe985e.jpg",
        "https://i.pinimg.com/736x/ca/14/52/ca1452915cff66a9c931f5afddf68a4d.jpg",
        "https://i.pinimg.com/236x/ab/61/15/ab61153de83e4995b87662586b7ae2d9.jpg",
        "https://i.pinimg.com/236x/ab/61/15/ab61153de83e4995b87662586b7ae2d9.jpg",
        "https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/c8d9ca9a-b95d-4926-b713-87df086e2796/anim=false,width=450/00139-3444351597.jpeg",
        "https://i.pinimg.com/474x/39/a6/74/39a67485307966b803303de55b35db51.jpg",
        "https://i.pinimg.com/originals/7f/0d/af/7f0daf326c05bfe776688df2dce25869.png",
        "https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/fd7b4f39-c759-46cf-85ce-adb420f68be5/width=800,original=false/00089-3488879182.jpeg",
        "https://i.pinimg.com/236x/4a/ab/3b/4aab3beac6e5a42178b378521414bc3c.jpg",
        "https://i.pinimg.com/564x/82/f3/7d/82f37d95452221eb315417855a71c674.jpg",
        "https://i.pinimg.com/736x/21/29/cc/2129cc16faa2f924904b418b851cd9c3.jpg"
    ];

    const name = gender === 'male' 
        ? maleNames[Math.floor(Math.random() * maleNames.length)]
        : femaleNames[Math.floor(Math.random() * femaleNames.length)];

    const familyName = familyNames[Math.floor(Math.random() * familyNames.length)];
    const portrait = gender === 'male'
        ? malePortraits[Math.floor(Math.random() * malePortraits.length)]
        : femalePortraits[Math.floor(Math.random() * femalePortraits.length)];

    let fullFamilyName = familyName;
    if (gender === 'female') {
        if (familyName.endsWith('vich')) fullFamilyName = familyName.replace('vich', 'vna');
        else if (familyName.endsWith('ov')) fullFamilyName = familyName + 'a';
    }

    const stats = {
        STR: rollDiceNotation("3d6"),
        DEX: rollDiceNotation("3d6"),
        CON: rollDiceNotation("3d6"),
        INT: rollDiceNotation("3d6"),
        WIS: rollDiceNotation("3d6"),
        CHA: rollDiceNotation("3d6")
    };

    // Generate additional traits using the new functions
    const physicalTrait = generatePhysicalTrait();
    const fear = generateFear();
    const appearance = generateAppearance();

    const npcHTML = `
        <div class="npc-full-card">
            <img src="${portrait}" alt="${name}" class="npc-portrait">
            <h4>${name} ${fullFamilyName}</h4>
            <p><strong>${generateAge()} ‚Ä¢ ${generateOccupation()}</strong></p>
            <p><em>"${generateQuote()}"</em></p>
            
            <div class="npc-stats">
                ${Object.entries(stats).map(([stat, value]) => `
                    <div class="stat-box">
                        <div class="stat-label">${stat}</div>
                        <div class="stat-value">
                            ${value} 
                            <button class="roll-button" style="margin-left:5px;padding:2px 5px;font-size:0.8em;" 
                                    onclick="rollStatCheck('${stat}', ${value})">Roll</button>
                        </div>
                    </div>
                `).join('')}
            </div>
            
            <div class="npc-details">
                <p><strong>Appearance:</strong> ${appearance}</p>
                <p><strong>Distinctive Trait:</strong> ${physicalTrait}</p>
                <p><strong>Greatest Fear:</strong> ${fear}</p>
                <p><strong>Personality:</strong> ${generatePersonality()}</p>
                <p><strong>Secret:</strong> ${generateSecret()}</p>
            </div>
        </div>
    `;

    // Create a temporary div to measure content height
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = npcHTML;
    tempDiv.style.position = 'absolute';
    tempDiv.style.visibility = 'hidden';
    tempDiv.style.width = resultDiv.clientWidth + 'px';
    document.body.appendChild(tempDiv);
    
    // Get the height of the content
    const contentHeight = tempDiv.offsetHeight;
    document.body.removeChild(tempDiv);
    
    // Get the box container and adjust its height before showing content
    const box = resultDiv.closest('.box');
    if (box) {
        // Add extra padding to the calculated height
        box.style.minHeight = (contentHeight + 60) + 'px';
    }

    // Fade-in logic after delay
    setTimeout(() => {
        resultDiv.innerHTML = npcHTML;
        resultDiv.style.opacity = '1';
        resultDiv.style.transform = 'translateY(0)';
        
        // Additional adjustment after content is rendered
        setTimeout(() => {
            // Double-check the actual rendered height
            const actualHeight = resultDiv.offsetHeight;
            if (box && actualHeight > contentHeight) {
                box.style.minHeight = (actualHeight + 60) + 'px';
            }
            
            // Save the current height as a data attribute for future reference
            collapsibleContent.dataset.contentHeight = box.style.minHeight;
        }, 50);
    }, 300);
}

// Helper functions that need to be implemented
function rollDiceNotation(notation) {
    // Parse dice notation (e.g., "3d6") and return result
    const [count, sides] = notation.split('d').map(Number);
    let total = 0;
    for (let i = 0; i < count; i++) {
        total += Math.floor(Math.random() * sides) + 1;
    }
    return total;
}

function generateAge() {
    const ages = ["Child", "Teenager", "Young adult", "Adult", "Middle-aged", "Elder"];
    return ages[Math.floor(Math.random() * ages.length)];
}

function generateOccupation() {
    const occupations = [
        // Authority & Noble Class
        "Noble", "Burgomeister", "Town Council Member", "Tax Collector", "Magistrate", "Estate Manager", 
        "Minor Lord/Lady", "Disinherited Noble", "Courtier", "Land Owner",
        
        // Commerce
        "Merchant", "Shopkeeper", "Trader", "Peddler", "Money Lender", "Vistani Trader", "Artisan Dealer",
        "Wine Merchant", "Antique Dealer", "Rare Goods Collector", "Market Stall Owner", "Smuggler",
        
        // Service & Hospitality
        "Innkeeper", "Barkeep", "Server", "Cook", "Stable Master", "Courier", "Guide", "Servant", 
        "House Steward", "Wet Nurse", "Grave Digger", "Undertaker", "Coffin Maker", "Launderer",
        "Rat Catcher", "Chimney Sweep", "Lamp Lighter", "Bath House Attendant", "Housemaid",
        
        // Crafts & Production
        "Blacksmith", "Tanner", "Cooper", "Wheelwright", "Carpenter", "Stonemason", "Cobbler", 
        "Tailor", "Weaver", "Potter", "Glass Blower", "Candle Maker", "Rope Maker", "Leather Worker",
        "Woodcarver", "Taxidermist", "Bookbinder", "Jeweler", "Icon Painter", "Toy Maker",
        
        // Food Production
        "Baker", "Butcher", "Brewer", "Vintner", "Miller", "Cheese Maker", "Distiller", "Fish Monger",
        "Apiarian", "Pickle Maker", "Sausage Maker", "Spice Merchant",
        
        // Agriculture
        "Farmer", "Shepherd", "Goatherd", "Orchard Keeper", "Vintner's Assistant", "Field Hand",
        "Woodcutter", "Charcoal Burner", "Mushroom Harvester", "Forager", "Raven Keeper",
        "Animal Breeder", "Wolf Trapper",
        
        // Defense & Protection
        "Guard", "Soldier", "Militia Member", "Watchman", "Scout", "Former Knight", "Bounty Hunter",
        "Monster Hunter", "Vampire Hunter", "Wolf Hunter", "Bodyguard", "Mercenary", "Town Gatekeeper",
        
        // Knowledge & Religion
        "Priest/ess", "Acolyte", "Monk/Nun", "Scholar", "Scribe", "Historian", "Fortune Teller",
        "Librarian", "Teacher", "Astronomer", "Philosopher", "Investigator", "Cartographer",
        "Translator of Old Texts", "Occultist", "Heretic", "Religious Exile",
        
        // Medicine & Nature
        "Herbalist", "Midwife", "Healer", "Barber-Surgeon", "Apothecary", "Leech Collector",
        "Plague Doctor", "Mortician", "Hedge Witch", "Root Cutter", "Folk Healer",
        
        // Hunting & Wilderness
        "Hunter", "Trapper", "Falconer", "Fisherman", "Forester", "Tracker", "Game Warden",
        "Wilderness Guide", "Fur Trader", "Poacher",
        
        // Arts & Entertainment
        "Minstrel", "Storyteller", "Puppeteer", "Artist", "Musician", "Dancer", "Actor", 
        "Carnival Performer", "Poet", "Playwright", "Shadow Puppeteer", "Mask Maker",
        
        // Outcast & Fringe
        "Beggar", "Vagabond", "Hermit", "Orphan Caretaker", "Madman/woman", "Escaped Servant",
        "Con Artist", "Fence", "Gravedigger", "Night Soil Collector", "Prisoner", "Exile",
        "Dishonored Soldier", "Ruined Merchant", "Branded Criminal", "Witch's Apprentice",
        
        // Unusual Occupations
        "Relic Hunter", "Fog Watcher", "Dream Interpreter", "Raven Keeper", "Ghost Whisperer",
        "Sin Eater", "Curse Detector", "Wolf Charmer", "Undead Warden", "Mist Walker",
        "Haunted House Caretaker", "Bone Collector", "Doll Maker", "Effigy Builder"
    ];
    return occupations[Math.floor(Math.random() * occupations.length)];
}

function generateQuote() {
    const quotes = [
        // Resignation & Doom
        "The mists take us all in the end...",
        "We're all just waiting for our time to come.",
        "Born in the shadow, die in the shadow.",
        "The sun may rise, but light never truly reaches Barovia.",
        "Death is not the end in these lands, merely a different kind of prison.",
        "I've accepted my fate, as should you.",
        "The ravens watch and the ravens know. They'll watch you too.",
        "My grandmother always said: 'Sleep comes, the night watches, and morning never truly arrives.'",
        "We are all just meat for the grinder eventually.",
        
        // Fear & Warnings
        "In Barovia, fear is the only faithful companion.",
        "Trust no one, especially those who smile too much.",
        "The wolves may howl, but it's the silent predators you should fear.",
        "When you hear laughter at night, seal your windows and pray.",
        "Never accept gifts from strangers. Nothing comes without a price here.",
        "The mists bring nothing but sorrow.",
        "Some who enter the woods return... changed.",
        "If you hear singing on a moonless night, cover your ears and hide.",
        "Three signs warn of his coming: dead birds, red fog, and children's laughter.",
        "Always burn your hair and nail clippings. They can use these things against you.",
        
        // Superstition & Advice
        "Wear your garlic close and your faith closer.",
        "Silver and sunlight, stranger. Remember these two things if you wish to see another dawn.",
        "A circle of salt keeps more than just slugs away.",
        "The old ways are the only ways that keep us safe.",
        "Don't look into their eyes‚Äîthey'll steal your soul.",
        "Fortune favors the cautious in these lands.",
        "When night falls, keep to your home and pray.",
        "Never trust a path that wasn't there yesterday.",
        "A raven's feather under your pillow keeps the nightmares at bay... sometimes.",
        "Speak not ill of the dead in Barovia. They might be listening.",
        
        // Cryptic Knowledge
        "I've seen things in the fog that cannot be unseen.",
        "The devil walks among us wearing a human face.",
        "Some secrets are better left buried with our ancestors.",
        "Even the stones of Barovia remember the blood spilled upon them.",
        "The castle has eyes that see into your very soul.",
        "The water here carries whispers from upstream. Best not to listen too closely.",
        "In this land, even your shadow might betray you.",
        "The oldest graves are the quietest. It's the fresh ones you need to worry about.",
        "Those who dance with the devil often find themselves leading.",
        "I've counted the stars every night for twenty years. Sometimes, there's one too many.",
        
        // Entrapment & Hopelessness
        "There is no escape from Barovia, only survival.",
        "We are all pawns in a game we cannot comprehend.",
        "Hope is a luxury few can afford in these times.",
        "The mists are both our prison walls and our jailers.",
        "You may have entered willingly, but none leave by choice.",
        "I've tried running. The roads always bring you back to where you started.",
        "Barovia doesn't just trap bodies; it traps souls.",
        "Every generation hopes for freedom. Every generation dies waiting.",
        "Even the brightest day in Barovia carries shadows.",
        "Some say there are other worlds beyond the mist. I stopped believing such fairy tales years ago.",
        
        // The Count
        "He only takes what he needs... until he doesn't.",
        "They say he cannot enter unless invited. Don't make the mistake of testing this.",
        "His mercy is more terrifying than his wrath.",
        "Speak not his name thrice, for he may answer your call.",
        "The Count remembers every slight, every prayer, every drop of blood spilled in his domain.",
        "When the bats circle at twilight, he hunts.",
        "A red rose on your doorstep is not a gift, but a warning.",
        "Some serve him willingly, believing it better than the alternative.",
        "I've seen him standing motionless for hours, just watching the village.",
        "They say he honors bargains to the letter, never the spirit.",
        
        // Hidden Resistance
        "The sun will shine on Barovia again someday.",
        "Not all who serve the darkness do so willingly. Remember that.",
        "There are safe houses for those who know where to look.",
        "The old symbols still hold power for those who remember them.",
        "Keep faith in the Morning Lord, but keep it quietly.",
        "The trees themselves resist his influence. That's why he cannot abide natural things.",
        "Find me when the moon is new. Bring vervain. Say nothing of this.",
        "Some fight with swords, others with secrets. Both are needed.",
        "The children's rhymes contain codes. Listen carefully.",
        "The resistance lives in whispers, in symbols drawn in the dust, in hopes unspoken."
    ];
    return quotes[Math.floor(Math.random() * quotes.length)];
}

function generatePersonality() {
    const traits = [
        // Fear-Based
        "Suspicious of strangers to the point of hostility",
        "Deeply superstitious, constantly making protective gestures",
        "Jumps at shadows and unexpected noises",
        "Constantly looks over their shoulder",
        "Paralyzed by indecision when faced with new situations",
        "Fearful of the night to the point of hysteria",
        "Nervous in darkness, always carries multiple light sources",
        "Convinced they're being watched by unseen forces",
        "Mutters protective prayers under their breath",
        "Refuses to travel anywhere alone",
        
        // Survival Adaptations
        "Quietly resourceful, hiding their true capabilities",
        "Resigned to fate but prepared for the worst",
        "Practical and pragmatic to a fault",
        "Hoards small useful items and food",
        "Always has an escape route planned",
        "Treats kindness with suspicion",
        "Responds to danger with eerie calm",
        "Shows different faces to different people",
        "Assesses everyone as either a threat or resource",
        "Sleeps lightly with a weapon nearby",
        "Resourceful survivor with hidden talents",
        "Adaptable but slow to trust new methods",
        "Knows exactly what can be sacrificed when necessary",
        "Functions well during crises, falls apart in safety",
        
        // Social Behaviors
        "Protective of family to extreme degrees",
        "Quick to blame outsiders for misfortunes",
        "Distrustful of authority figures",
        "Silent observer who notices everything",
        "Keeper of traditions and old ways",
        "Hospitable despite deep-seated fears",
        "Shares cryptic warnings disguised as pleasantries",
        "Speaks in local proverbs and superstitions",
        "Forms rapid but conditional alliances",
        "Watches strangers' hands and eyes constantly",
        "Refuses to speak names of feared entities",
        "Communicates important information indirectly",
        "Darkly humorous about grim situations",
        "Chain of gossip for both survival information and social control",
        
        // Coping Mechanisms
        "Collector of old folklore and protective charms",
        "Drinks heavily after sunset",
        "Obsessive about specific protective rituals",
        "Finds momentary joy in small beautiful things",
        "Creates art depicting both beauty and horror",
        "Keeps detailed records of strange occurrences",
        "Seeks prophecies and omens in everyday events",
        "Maintains elaborate daily routines for sense of control",
        "Uses gallows humor to cope with horror",
        "Fixates on minor problems to avoid facing larger threats",
        "Surprisingly brave in defense of loved ones",
        "Stoic in adversity, refusing to show weakness",
        "Secretly hopeful despite overwhelming evidence",
        "Finds solace in craftsmanship or meticulous work",
        
        // Darker Aspects
        "Bitter and resentful of those who appear more fortunate",
        "Willing to sacrifice strangers for personal safety",
        "Has developed a taste for cruelty as a way to feel control",
        "Self-medicates with herbs of questionable safety",
        "Collects tokens from the dead for 'protection'",
        "Performs small blasphemies as personal rebellion",
        "Believes suffering purifies the soul",
        "Revels in the misfortune of neighbors",
        "Has normalized horrific events as ordinary",
        "Deliberately cultivates an aura of bad luck or madness as protection",
        "Reports to a greater power for small privileges",
        "Has abandoned traditional morality in favor of pure survival",
        
        // Complex Behaviors
        "Appears broken but harbors deep inner strength",
        "Overtly pious while secretly doubting",
        "Maintains elaborate facades for different social contexts",
        "Seemingly collaborative while pursuing personal agenda",
        "Mixes truth and lies so seamlessly even they believe both",
        "Projects confidence while consumed by dread",
        "Shows unexpected kindness in specific circumstances",
        "Fixated on lost normalcy from before darkness fell",
        "Obsessively preserves knowledge for future generations",
        "Lives fully in the present, refusing to plan or remember",
        "Seemingly aloof but deeply affected by others' suffering"
    ];
    return traits[Math.floor(Math.random() * traits.length)];
}

function generateSecret() {
    const secrets = [
        // Dark Pacts & Allegiances
        "Has made a blood pact with a dark entity for protection",
        "Serves as the Count's eyes and ears in town",
        "Is actually a spy for the Vistani",
        "Descended from the Count's consorts but doesn't know it",
        "Secretly corresponds with enemies of the Count",
        "Has agreed to deliver an innocent to the Count in exchange for mercy",
        "Is a member of a forbidden cult dedicated to an entity even the Count fears",
        "Exchanges information with a friendly ghost",
        "Once served in Castle Ravenloft and still holds a key",
        "Agreed to host something inhuman inside themselves to save a loved one",
        "Is the illegitimate child of a noble and potential heir to forgotten lands",
        "Has sworn fealty to an ancient power beneath the land",
        "Guards a shrine to a deity whose name has been forgotten",
        "Secretly dines regularly with a creature of the night",
        
        // Supernatural Connections
        "Has wolf's blood in their veins and changes during the full moon",
        "Can see glimpses of the future in reflective surfaces",
        "Has visions of past horrors through touch",
        "Knows the true name of a local witch",
        "Can speak with ravens and receives warnings from them",
        "Has a twin who died at birth that now haunts them as a protective ghost",
        "Bears a birthmark that glows in the presence of undead",
        "Can sense when evil is near, feeling a chill down their spine",
        "Has dreams that sometimes come true in twisted ways",
        "Was born during an eclipse and can sometimes see invisible creatures",
        "Survived a vampire attack and now can sense their presence",
        "Is dead but doesn't know it, continuing their routine",
        "Can briefly animate small objects with their mind when frightened",
        "Has slowly developing powers they don't understand and fear",
        "Was cursed by a hag and now sees omens of death before they occur",
        
        // Hidden Knowledge
        "Knows a hidden path through the woods that bypasses the mists",
        "Possesses an ancient map marking forgotten catacombs beneath the village",
        "Has decoded part of an ancient prophecy about Barovia's liberation",
        "Keeps forbidden books of lore hidden in their cellar",
        "Has discovered the true purpose of the standing stones",
        "Knows the weakness of a local monster that terrorizes the region",
        "Remembers the time before the mists came but tells no one",
        "Has found an ancient journal revealing the Count's origins",
        "Knows the location of a powerful artifact thought to be destroyed",
        "Has discovered a way to temporarily neutralize the poisonous effects of certain Barovian plants",
        "Keeps a journal of strange occurrences that reveals a disturbing pattern",
        "Has found letters suggesting the village's history has been deliberately falsified",
        "Knows which local families have tainted bloodlines",
        "Has discovered that certain local festivities are actually binding rituals",
        
        // Crimes & Misdeeds
        "Murdered a neighbor they believed was turning into a monster",
        "Stole a religious relic they now keep hidden under floorboards",
        "Abandoned a child to the woods as part of a bargain",
        "Betrayed a group of travelers to save their own skin",
        "Poisoned their abusive spouse and now serves the meat to guests",
        "Has been stealing from the church's poor box for years",
        "Helped bury a body on their property in exchange for payment",
        "Set fire to a rival's home and watched it burn",
        "Sells watered-down medicine that sometimes worsens conditions",
        "Lured a suspiciously friendly stranger to their death",
        "Trades secrets to multiple opposing factions",
        "Accuses others of witchcraft to settle personal vendettas",
        "Sold information that led to a family's disappearance",
        "Deliberately led children to dangerous areas to 'test' if they were changelings",
        
        // Personal Tragedies
        "Lost a child to the mists years ago and still leaves offerings",
        "Is slowly transforming into something inhuman but hides the changes",
        "Hides scars from a vampire attack beneath high collars",
        "Had their shadow stolen and now fears what purpose it serves",
        "Survived an attack that killed their entire family by hiding and doing nothing",
        "Carries an ancient family curse that manifests in subtle ways",
        "Was replaced by a duplicate but escaped and now lives as someone else",
        "Lost their spouse to the Count's attentions and now receives 'gifts'",
        "Witnessed a ritual that cannot be unseen and is slowly losing their mind",
        "Was forced to choose which family member would be sacrificed",
        "Bears the mark of a witch's kiss and feels an urging toward the woods",
        "Has recurring nightmares that are actually memories of a past life in Barovia",
        "Keeps the preserved remains of a loved one who speaks to them",
        "Is haunted by a spirit that only they can see",
        
        // Resistance & Hope
        "Secretly worships the Morning Lord despite the danger",
        "Is part of an underground network helping people escape Barovia",
        "Hides a child with special abilities who might threaten the Count",
        "Creates maps of the mists' movements looking for patterns",
        "Is related to a famous monster hunter and carries their techniques",
        "Guards an ancient family heirloom that can harm the darkness",
        "Maintains a hidden garden of plants thought extinct in Barovia",
        "Has been gradually poisoning a powerful evil entity",
        "Carries a seed of foreign tree said to be able to purify tainted ground",
        "Has been teaching children forbidden knowledge of the outside world",
        "Is gathering components for a ritual to break a specific curse",
        "Has a forbidden romance with an outsider who brings news and hope",
        "Harbors a wounded entity of light hiding from the Count's servants",
        "Has discovered an ancient song that temporarily repels the mists"
    ];
    return secrets[Math.floor(Math.random() * secrets.length)];
}

function generatePhysicalTrait() {
    const traits = [
        // Face & Head
        "Deep-set eyes that seem to recede into their skull",
        "Perpetual dark circles beneath their eyes from poor sleep",
        "Gaunt, hollow cheeks from years of poor nutrition",
        "A crooked nose, broken and never properly set",
        "Sickly pale complexion that rarely sees true sunlight",
        "Cracked, dry lips constantly licked nervously",
        "A facial tic that worsens when they're lying",
        "Premature wrinkles from constant worry",
        "A birthmark in the shape some say resembles a bat",
        "Visible blue veins beneath translucent skin",
        "A wandering eye that never quite focuses properly",
        "Teeth filed to points in the old Barovian tradition",
        "A scarred ear from a childhood encounter with something clawed",
        "Wispy, thinning hair despite their age",
        "Mismatched eye colors, one significantly darker",
        
        // Body Language & Movement
        "Hunched posture as if perpetually expecting a blow",
        "Constantly wringing hands when anxious",
        "Moves with unusual quietness, barely disturbing the air",
        "Jerky, birdlike head movements when scanning for threats",
        "A pronounced limp from an old injury",
        "Fidgets with a personal charm or token when nervous",
        "Flinches at sudden movements or loud noises",
        "Stands unnaturally still when observing others",
        "Avoids direct eye contact, looking just past people",
        "Walks with a shuffling gait to avoid attention",
        "Trembling hands they try to hide",
        "Quick, darting eyes that miss nothing",
        "Exaggerated startled response to being touched",
        "Body oriented toward exits and escape routes",
        
        // Voice & Speech
        "Speaks in a whisper as if afraid of being overheard",
        "Voice cracks and rasps from an old injury or illness",
        "Thick Barovian accent that grows stronger when emotional",
        "Stutters when speaking of certain subjects",
        "Occasional slips into an archaic dialect",
        "Nervous laugh that punctuates inappropriate moments",
        "Hums or mutters to themselves when distracted",
        "Speaks to inanimate objects as if they're listening",
        "Voice drops to inaudibility when discussing certain topics",
        "Peculiar cadence that sometimes places emphasis on odd syllables",
        "Frequently clears throat before speaking difficult truths",
        "Peppers speech with old Barovian sayings and superstitions",
        
        // Hands & Features
        "Cracked, work-worn hands stained by their trade",
        "Long, yellowed fingernails they refuse to trim",
        "Missing fingers from frostbite or punishment",
        "Burn scars on palms from a protective ritual",
        "Knuckles heavily calloused from physical labor",
        "Unusually cold touch that lingers after contact",
        "Hands perpetually stained from their craft",
        "Fingers adorned with crude protective symbols",
        "Black dirt beneath fingernails that never fully washes away",
        "Oddly long fingers with too many joints",
        "Hands that shake visibly in the presence of certain people",
        
        // Clothing & Appearance
        "Wears multiple layers regardless of weather",
        "Adorned with subtle protective symbols sewn into clothing",
        "Carries an unusual number of small pouches and pockets",
        "Clothes patched many times with mismatched materials",
        "Wears a distinctive piece of jewelry with supposed protective powers",
        "Dressed in faded colors that once were vibrant",
        "Clothing adorned with small bones or teeth as charms",
        "Wears high collars and long sleeves regardless of season",
        "A collection of seemingly random trinkets tied to their belt",
        "Clothing that smells of strange herbs and incense",
        "Wears clothes at least one size too large to hide their frame",
        "Bears a small, crude tattoo visible only when sleeves are rolled up",
        
        // Distinctive Features
        "Vitiligo creating patches of pale skin in distinctive patterns",
        "A wall eye that seems to look into another place",
        "Albinism with reddish eyes that unnerve others",
        "A shock of white hair from a traumatic experience",
        "Unusual number of moles arranged in what resembles a constellation",
        "Webbed fingers partially hidden by gloves",
        "Heterochromia that locals whisper is a mark of the fey",
        "Ritual scarification hidden beneath clothing",
        "A brand or burn mark poorly concealed",
        "Six fingers on one hand, carefully hidden",
        "Patch of hair that grows in white where a scar crosses the scalp",
        "Unusually pointed ears they try to hide beneath hair",
        "Pupils that contract vertically rather than circularly"
    ];
    return traits[Math.floor(Math.random() * traits.length)];
}

function generateName() {
    const firstNames = [
        // Male Barovian Names
        "Alek", "Anton", "Balthazar", "Boris", "Bogan", "Dargos", "Demetri", "Dragomir", "Emil", "Franz",
        "Grigori", "Gustav", "Ivanov", "Kobal", "Lazlo", "Livius", "Mikhail", "Miroslav", "Nikolai", "Oleg",
        "Petru", "Radovan", "Radu", "Stefan", "Tomas", "Valentin", "Vasili", "Viktor", "Vladislav", "Yesper",
        
        // Female Barovian Names
        "Alina", "Anca", "Anastasia", "Catrina", "Clavdia", "Danya", "Diavola", "Dorina", "Elena", "Fatima",
        "Grilsha", "Hortensia", "Irina", "Ivana", "Katerina", "Lavinia", "Magda", "Marta", "Natalia", "Olivenka",
        "Raisa", "Sabina", "Sorina", "Tereska", "Valentina", "Vasha", "Vera", "Viktoriya", "Yelena", "Zondra"
    ];
    
    const surnames = [
        "Antonovich", "Barthos", "Belasco", "Cantemir", "Dargovich", "Diavolov", "Diminski", "Dilisnya", 
        "Fleischer", "Groza", "Ivanov", "Konstantinov", "Krezkov", "Krolov", "Lupescu", "Milovich", 
        "Markovia", "Popofsky", "Radovich", "Richemulot", "Stefanovich", "Swilova", "Taltos", "Targolov", 
        "Ulrich", "Vadu", "Voltanescu", "Wachter", "Zakharov", "Zaran"
    ];
    
    const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
    const surname = surnames[Math.floor(Math.random() * surnames.length)];
    
    return `${firstName} ${surname}`;
}

function generateFear() {
    const fears = [
        // Natural Phenomena
        "Fog and mist (homichlophobia)",
        "Darkness (nyctophobia)",
        "Thunder and lightning (astraphobia)",
        "Running water (potamophobia)",
        "The woods after sunset",
        "Full moons",
        "Winter's approach",
        "Reflections in still water",
        "The sound of wolves howling",
        "Stillness before a storm",
        
        // Supernatural
        "Undead rising from the cemetery",
        "Being watched by unseen eyes",
        "The Count's attention falling upon them",
        "Their ancestors' spirits judging them",
        "Curses and hexes",
        "Witches disguised as ordinary folk",
        "Shadow creatures that steal children",
        "The old gods returning",
        "Prophecies coming true",
        "Dreams becoming reality",
        "Being replaced by a doppelg√§nger",
        "Losing their soul to dark forces",
        "Something watching through animals' eyes",
        "Ancient buried things awakening",
        
        // Practical Barovian Fears
        "Failing to protect their family",
        "Starvation during the harsh winters",
        "Illness with no healer nearby",
        "Being taken to Castle Ravenloft",
        "Outsiders bringing disaster",
        "Change to the fragile status quo",
        "Their secrets being discovered",
        "Becoming like those they fear",
        "Betrayal by trusted neighbors",
        "Losing their sanity from what they've witnessed",
        "Being buried alive in Barovian soil",
        "Breaking an unknown taboo",
        "The hidden meanings in old folktales coming true",
        "Their children inheriting their mistakes"
    ];
    return fears[Math.floor(Math.random() * fears.length)];
}

function generateAppearance() {
    const appearances = [
        // General Appearance Descriptions
        "Gaunt and hollow-cheeked with darting eyes",
        "Robust but weathered with calloused hands",
        "Hunched and wiry with surprising strength",
        "Pallid complexion with a perpetual frown",
        "Sturdy build with suspicious eyes",
        "Thin and tall with nervous mannerisms",
        "Round-faced with a false cheerfulness",
        "Small-statured with a shuffling gait",
        "Broad-shouldered with a stiff posture",
        "Haggard appearance with alert eyes",
        
        // Clothing & Presentation
        "Wears multiple layers of patched clothing",
        "Dressed practically in drab, dark colors",
        "Adorned with small protective charms",
        "Clothes slightly too large as if inherited",
        "Wrapped in shawls regardless of weather",
        "Neat and presentable despite worn attire",
        "Distinctive hat pulled low over eyes",
        "Boots wrapped with rags for silence",
        "High-collared coat buttoned to the neck",
        "Dressed above their station with one fine item",
        "Clothing stained by the tools of their trade",
        "Wears gloves even indoors",
        
        // Face & Notable Features
        "Face lined beyond their years from hardship",
        "Cloudy eye from an old injury",
        "Burns partially visible at collar or sleeve",
        "Hair prematurely grey at the temples",
        "Missing teeth revealed when they speak",
        "Distinctive birthmark they try to hide",
        "Facial scar with an unusual pattern",
        "Permanently reddened nose and cheeks from cold",
        "Unnaturally pale with visible blue veins",
        "Deep shadows beneath sunken eyes",
        "Unusually bright eyes in a gaunt face",
        "Twitching facial muscles when nervous"
    ];
    return appearances[Math.floor(Math.random() * appearances.length)];
}




function rollStatCheck(stat, value) {
    // Implement stat check rolling functionality
    const roll = Math.floor(Math.random() * 20) + 1;
    const modifier = Math.floor((value - 10) / 2);
    const total = roll + modifier;
    
    // Create result message
    let resultMessage = `${stat} Check: Rolled ${roll}`;
    if (modifier !== 0) {
        resultMessage += ` ${modifier >= 0 ? '+' : ''}${modifier} = ${total}`;
    }
    
    // Display result (implement as needed)
    alert(resultMessage);
}

// Dice rolling functions
function rollDie(sides) {
    return Math.floor(Math.random() * sides) + 1;
}

function rollDiceNotation(notation) {
    const parts = notation.split(/([+-])/);
    let total = 0;
    let currentOp = '+';
    
    for (let part of parts) {
        if (part === '+' || part === '-') {
            currentOp = part;
            continue;
        }
        
        if (part.includes('d')) {
            const [count, sides] = part.split('d').map(Number);
            let sum = 0;
            for (let i = 0; i < count; i++) {
                sum += rollDie(sides);
            }
            total = currentOp === '+' ? total + sum : total - sum;
        } else if (part) {
            const num = parseInt(part, 10);
            total = currentOp === '+' ? total + num : total - num;
        }
    }
    
    return total;
}

function setupCollapsibleSections() {
    // Find all collapsible section headers
    const sectionHeaders = document.querySelectorAll('.section-title');
    
    sectionHeaders.forEach(header => {
        header.addEventListener('click', function() {
            // Get the collapsible content that follows this header
            const content = this.nextElementSibling;
            
            if (content && content.classList.contains('collapsible-content')) {
                // Toggle display state
                if (content.style.display === 'block') {
                    // Collapsing - animate out
                    content.style.maxHeight = '0';
                    
                    // After animation completes, set display to none
                    setTimeout(() => {
                        content.style.display = 'none';
                    }, 300); // Match the CSS transition time
                } else {
                    // Expanding
                    content.style.display = 'block';
                    
                    // Get stored height for NPC generator content that's been used
                    if (this.id === 'npc-generator' && window.npcGenerated && content.dataset.contentHeight) {
                        const box = content.querySelector('.box');
                        if (box) {
                            box.style.minHeight = content.dataset.contentHeight;
                            content.style.maxHeight = 'none';
                        } else {
                            content.style.maxHeight = content.scrollHeight + 'px';
                        }
                    } else {
                        // Regular content - set max height to scroll height
                        content.style.maxHeight = content.scrollHeight + 'px';
                    }
                }
                
                // Toggle the active class on the header for styling
                this.classList.toggle('active');
            }
        });
    });
    
    // Initialize - all sections except active ones should be collapsed
    sectionHeaders.forEach(header => {
        const content = header.nextElementSibling;
        if (content && content.classList.contains('collapsible-content')) {
            // If not marked as active initially, collapse it
            if (!header.classList.contains('active')) {
                content.style.display = 'none';
                content.style.maxHeight = '0';
            } else {
                // It's active, so make sure it's expanded properly
                content.style.display = 'block';
                content.style.maxHeight = content.scrollHeight + 'px';
            }
        }
    });
}

// Call this function when the DOM is loaded
document.addEventListener('DOMContentLoaded', setupCollapsibleSections);

document.addEventListener('DOMContentLoaded', function() {
  const eyesContainer = document.querySelector('footer .strahd-eyes-container');
  if (!eyesContainer) return;

  // Get all eye elements
  const leftPupil = document.querySelector('footer .strahd-eye-left .strahd-pupil');
  const rightPupil = document.querySelector('footer .strahd-eye-right .strahd-pupil');
  const fangs = document.querySelector('footer .strahd-fangs');
  
  // Make eyes clickable
  eyesContainer.style.pointerEvents = 'auto';
  eyesContainer.style.cursor = 'pointer';

  // Strahd actions array
  const strahdActions = [
    { name: 'disappear', probability: 0.4 },
    { name: 'laugh', probability: 0.3 },
    { name: 'threaten', probability: 0.2 },
    { name: 'transform', probability: 0.1 }
  ];

  // Mouse tracking
  document.addEventListener('mousemove', (e) => {
    const footerRect = document.querySelector('footer').getBoundingClientRect();
    const eyesRect = eyesContainer.getBoundingClientRect();
    
    // Calculate mouse position relative to eyes
    const mouseX = e.clientX - eyesRect.left - eyesRect.width/2;
    const mouseY = e.clientY - eyesRect.top - eyesRect.height/2;
    
    // Limit pupil movement range
    const angle = Math.atan2(mouseY, mouseX);
    const distance = Math.min(6, Math.sqrt(mouseX*mouseX + mouseY*mouseY)/10);
    const pupilX = distance * Math.cos(angle);
    const pupilY = distance * Math.sin(angle);
    
    // Apply pupil movement
    leftPupil.style.transform = `translate(calc(-50% + ${pupilX}px), calc(-50% + ${pupilY}px)`;
    rightPupil.style.transform = `translate(calc(-50% + ${pupilX}px), calc(-50% + ${pupilY}px))`;
    
    // Subtle container movement
    eyesContainer.style.transform = `translateX(-50%) translateY(${Math.min(5, mouseY/20)}px)`;
  });

  // Eye click handler
  eyesContainer.addEventListener('click', function() {
    // Disappear animation
    eyesContainer.classList.add('disappearing');
    
    // Random Strahd action after a delay
    setTimeout(() => {
      const randomAction = getRandomAction(strahdActions);
      performStrahdAction(randomAction);
      
      // Reappear after action completes
      setTimeout(() => {
        eyesContainer.classList.remove('disappearing');
      }, 1500);
    }, 500);
  });

  function getRandomAction(actions) {
    const rand = Math.random();
    let cumulativeProbability = 0;
    
    for (const action of actions) {
      cumulativeProbability += action.probability;
      if (rand <= cumulativeProbability) {
        return action.name;
      }
    }
    
    return actions[0].name; // fallback
  }

  function performStrahdAction(action) {
    switch(action) {
      case 'disappear':
        // Already handled by the disappearing class
        break;
        
      case 'laugh':
        // Show red glow and play laugh sound
        eyesContainer.classList.add('laughing');
        playSound('https://www.soundjay.com/human/sounds/laugh-evil-01.mp3');
        setTimeout(() => {
          eyesContainer.classList.remove('laughing');
        }, 2000);
        break;
        
      case 'threaten':
        // Show fangs and red eyes
        eyesContainer.classList.add('threatening');
        playSound('https://www.soundjay.com/human/sounds/growl-01.mp3');
        setTimeout(() => {
          eyesContainer.classList.remove('threatening');
        }, 1500);
        break;
        
      case 'transform':
        // Bat transformation effect
        eyesContainer.classList.add('transforming');
        playSound('https://www.soundjay.com/nature/sounds/bat-01.mp3');
        setTimeout(() => {
          eyesContainer.classList.remove('transforming');
        }, 2000);
        break;
    }
  }

  function playSound(url) {
    const audio = new Audio(url);
    audio.volume = 0.3;
    audio.play().catch(e => console.log("Audio play failed:", e));
  }

  // Eye animation controller (same as before)
  function setRandomEyeBehavior() {
    // Random blinking (more frequent)
    setTimeout(() => {
      eyesContainer.classList.add('blinking');
      setTimeout(() => {
        eyesContainer.classList.remove('blinking');
        setRandomEyeBehavior();
      }, 200);
    }, 3000 + Math.random() * 5000);

    // Random squinting (20% chance when not blinking)
    if (Math.random() < 0.2 && !eyesContainer.classList.contains('blinking')) {
      setTimeout(() => {
        eyesContainer.classList.add('squinting');
        setTimeout(() => {
          eyesContainer.classList.remove('squinting');
        }, 1000 + Math.random() * 2000);
      }, 100);
    }

    // Random fang appearance (15% chance)
    if (Math.random() < 0.5) {
      setTimeout(() => {
        eyesContainer.classList.add('showing-fangs');
        
        if (Math.random() < 0.5) {
          eyesContainer.classList.add('squinting');
        }
        
        setTimeout(() => {
          eyesContainer.classList.remove('showing-fangs');
          eyesContainer.classList.remove('squinting');
        }, 800 + Math.random() * 1200);
      }, 200);
    }
  }

  // Start the eye behavior cycle
  setRandomEyeBehavior();
});

// Player tracker functionality
document.addEventListener('DOMContentLoaded', function() {
    // Check for saved players
    loadPlayers();
    
    // Add player button functionality
    document.getElementById('add-player').addEventListener('click', function() {
        addNewPlayer();
    });
    
    // Initialize sidebar toggle button if it doesn't exist
    if (!document.querySelector('.sidebar-toggle')) {
        const toggleBtn = document.createElement('button');
        toggleBtn.className = 'sidebar-toggle';
        toggleBtn.textContent = 'PLAYERS ‚ñ∫';
        toggleBtn.onclick = toggleSidebar;
        toggleBtn.style.position = 'fixed';
        toggleBtn.style.right = '20px';
        toggleBtn.style.top = '20px';
        toggleBtn.style.zIndex = '1001';
        document.body.appendChild(toggleBtn);
    }
    
    // Ensure sidebar starts closed
    const sidebar = document.getElementById('player-sidebar');
    if (sidebar) sidebar.classList.remove('open');
});

// Sidebar toggle functionality
function toggleSidebar() {
    const sidebar = document.getElementById('player-sidebar');
    if (!sidebar) return;
    
    sidebar.classList.toggle('open');
    
    const toggleBtn = document.querySelector('.sidebar-toggle');
    if (toggleBtn) {
        if (sidebar.classList.contains('open')) {
            toggleBtn.textContent = '‚óÑ';
            toggleBtn.style.right = '320px'; // Adjusted for wider sidebar
        } else {
            toggleBtn.textContent = 'PLAYERS ‚ñ∫';
            toggleBtn.style.right = '20px';
        }
    }
}

// Create new player card
function addNewPlayer(playerData = null) {
    const playerList = document.getElementById('player-list');
    const newPlayerCard = createPlayerCard(playerData);
    playerList.appendChild(newPlayerCard);
    savePlayers();
}

// Create player card with all necessary elements
function createPlayerCard(playerData = null) {
    const playerCard = document.createElement('div');
    playerCard.className = 'player-card';
    
    // Default values
    const defaults = {
        name: 'New Player',
        ac: '',
        hp: '',
        maxHp: '',
        despair: 'None',
        despairDays: 0,
        madness: 'None',
        madnessEffect: '',
        corruption: 0,
        fear: 'None',
        hope: 0,
        notes: ''
    };
    
    const data = playerData || defaults;
    
    // Player Header (Name + Remove)
    const playerHeader = document.createElement('div');
    playerHeader.className = 'player-header';
    
    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.className = 'player-name';
    nameInput.value = data.name;
    nameInput.addEventListener('change', savePlayers);
    playerHeader.appendChild(nameInput);
    
    const removeBtn = document.createElement('button');
    removeBtn.className = 'remove-player';
    removeBtn.textContent = '√ó';
    removeBtn.addEventListener('click', function() {
        playerCard.remove();
        savePlayers();
    });
    playerHeader.appendChild(removeBtn);
    
    playerCard.appendChild(playerHeader);
    
    // Vitals (AC, HP)
    const vitalsRow = document.createElement('div');
    vitalsRow.className = 'vitals';
    
    // AC
    const acContainer = document.createElement('div');
    acContainer.className = 'vital-stat';
    
    const acLabel = document.createElement('div');
    acLabel.className = 'vital-label';
    acLabel.textContent = 'AC';
    acContainer.appendChild(acLabel);
    
    const acInput = document.createElement('input');
    acInput.type = 'text';
    acInput.className = 'vital-value';
    acInput.value = data.ac;
    acInput.addEventListener('change', savePlayers);
    acContainer.appendChild(acInput);
    
    vitalsRow.appendChild(acContainer);
    
    // Current HP
    const hpContainer = document.createElement('div');
    hpContainer.className = 'vital-stat';
    
    const hpLabel = document.createElement('div');
    hpLabel.className = 'vital-label';
    hpLabel.textContent = 'HP';
    hpContainer.appendChild(hpLabel);
    
    const hpInput = document.createElement('input');
    hpInput.type = 'text';
    hpInput.className = 'vital-value';
    hpInput.value = data.hp;
    hpInput.addEventListener('change', savePlayers);
    hpContainer.appendChild(hpInput);
    
    vitalsRow.appendChild(hpContainer);
    
    // Max HP
    const maxHpContainer = document.createElement('div');
    maxHpContainer.className = 'vital-stat';
    
    const maxHpLabel = document.createElement('div');
    maxHpLabel.className = 'vital-label';
    maxHpLabel.textContent = 'Max HP';
    maxHpContainer.appendChild(maxHpLabel);
    
    const maxHpInput = document.createElement('input');
    maxHpInput.type = 'text';
    maxHpInput.className = 'vital-value';
    maxHpInput.value = data.maxHp || '';
    maxHpInput.addEventListener('change', savePlayers);
    maxHpContainer.appendChild(maxHpInput);
    
    vitalsRow.appendChild(maxHpContainer);
    
    playerCard.appendChild(vitalsRow);
    
    // Despair tracking
    const despairRow = createStatusRow('Despair', [
        'None', 'Apathy', 'Dread', 'Insanity', 'Paranoia', 'Nihilism'
    ], data.despair);
    playerCard.appendChild(despairRow);
    
    // Days with despair
    const daysRow = document.createElement('div');
    daysRow.className = 'status-row';
    
    const daysLabel = document.createElement('span');
    daysLabel.className = 'status-label';
    daysLabel.textContent = 'Days:';
    daysRow.appendChild(daysLabel);
    
    const daysSliderContainer = document.createElement('div');
    daysSliderContainer.className = 'slider-container';
    
    const daysSlider = document.createElement('div');
    daysSlider.className = 'corruption-slider';
    
    const daysThumb = document.createElement('div');
    daysThumb.className = 'slider-thumb';
    daysThumb.style.left = `${(data.despairDays / 7) * 100}%`;
    
    daysSlider.appendChild(daysThumb);
    daysSliderContainer.appendChild(daysSlider);
    daysRow.appendChild(daysSliderContainer);
    
    const daysInput = document.createElement('input');
    daysInput.type = 'number';
    daysInput.min = 0;
    daysInput.max = 7;
    daysInput.value = data.despairDays;
    daysInput.className = 'counter-input';
    daysInput.addEventListener('change', function() {
        daysThumb.style.left = `${(this.value / 7) * 100}%`;
        updateDayEffectText(dayEffect, this.value);
        savePlayers();
    });
    daysRow.appendChild(daysInput);
    
    // Day effects display
    const dayEffect = document.createElement('span');
    dayEffect.className = 'madness-effect';
    updateDayEffectText(dayEffect, data.despairDays);
    daysRow.appendChild(dayEffect);
    
    playerCard.appendChild(daysRow);
    
    // Madness tracking
    const madnessRow = createStatusRow('Madness', [
        'None', 'Short-term', 'Long-term', 'Indefinite'
    ], data.madness);
    playerCard.appendChild(madnessRow);
    
    // Madness effect notes
    const madnessEffectRow = document.createElement('div');
    madnessEffectRow.className = 'status-row';
    
    const madnessEffectInput = document.createElement('input');
    madnessEffectInput.type = 'text';
    madnessEffectInput.placeholder = 'Madness effect...';
    madnessEffectInput.className = 'player-name';
    madnessEffectInput.style.margin = '0';
    madnessEffectInput.value = data.madnessEffect;
    madnessEffectInput.addEventListener('change', savePlayers);
    madnessEffectRow.appendChild(madnessEffectInput);
    
    // Add madness roll button
    const rollMadnessBtn = document.createElement('button');
    rollMadnessBtn.textContent = 'Roll';
    rollMadnessBtn.className = 'add-player-btn';
    rollMadnessBtn.style.marginLeft = '10px';
    rollMadnessBtn.style.fontSize = '0.8em';
    rollMadnessBtn.addEventListener('click', function() {
        const type = madnessRow.querySelector('select').value;
        if (type === 'None') return;
        
        const effects = {
            'Short-term': [
                "Incorrigible Flirt: Must compliment everyone excessively",
                "Nervous Laughter: Can't stop giggling inappropriately",
                "Selective Mutism: Can only whisper for 1d10 minutes",
                "Paranoia: Convinced someone is watching (might be true)",
                "Flashbacks: Relives traumatic event (disadvantage on next check)",
                "Hyperactivity: Can't stop moving/talking (disadvantage on Stealth)",
                "Catatonia: Stares blankly for 1d10 minutes",
                "Phobia: Develops temporary fear of something nearby",
                "Echolalia: Repeats last words heard (disadvantage on social checks)",
                "Synesthesia: Experiences crossed senses ('I can taste the color red')"
            ],
            'Long-term': [
                "Phantom Pain: Random limbs hurt (disadvantage on physical checks 1/day)",
                "Face Blindness: Can't recognize friends (Wisdom check to identify)",
                "Time Skips: Loses minutes/hours with no memory",
                "Compulsive Ritual: Must perform specific action when stressed",
                "Emotional Inversion: Laughs at sad things, cries at happy things",
                "Doppelg√§nger Fear: Convinced someone has been replaced",
                "Blood Fascination: Compelled to touch/stare at blood",
                "Mirror Phobia: Can't look at reflections without panic",
                "Sleepwalker: Acts out dreams with no memory",
                "Psychic Echo: Hears thoughts of nearby creatures occasionally"
            ],
            'Indefinite': [
                "Split Personality: Alternate identity emerges under stress",
                "Reality Fracture: Sees ghosts of possible futures/pasts",
                "Corpse Empathy: Believes dead bodies are just 'resting'",
                "Vampiric Delusion: Convinced they're becoming a vampire",
                "Strahd Worship: Develops twisted admiration for the Count",
                "Body Dysmorphia: Convinced body parts aren't theirs",
                "Pica: Craves eating non-food items (dirt, bones, etc.)",
                "Savior Complex: Believes they alone can redeem Strahd",
                "Death Seeker: Takes increasingly reckless risks",
                "Living Nightmare: Can't distinguish dreams from reality"
            ]
        };
        
        const randomEffect = effects[type][Math.floor(Math.random() * effects[type].length)];
        madnessEffectInput.value = randomEffect;
        savePlayers();
    });
    madnessEffectRow.appendChild(rollMadnessBtn);
    
    playerCard.appendChild(madnessEffectRow);
    
    // Divider
    const divider1 = document.createElement('div');
    divider1.className = 'status-divider';
    playerCard.appendChild(divider1);
    
    // Corruption tracking with slider
    const corruptionRow = document.createElement('div');
    corruptionRow.className = 'status-row';
    
    const corruptionLabel = document.createElement('span');
    corruptionLabel.className = 'status-label';
    corruptionLabel.textContent = 'Corruption:';
    corruptionRow.appendChild(corruptionLabel);
    
    const corruptionSliderContainer = document.createElement('div');
    corruptionSliderContainer.className = 'slider-container';
    
    const corruptionSlider = document.createElement('div');
    corruptionSlider.className = 'corruption-slider';
    
    const corruptionThumb = document.createElement('div');
    corruptionThumb.className = 'slider-thumb';
    corruptionThumb.style.left = `${(data.corruption / 10) * 100}%`;
    
    corruptionSlider.appendChild(corruptionThumb);
    corruptionSliderContainer.appendChild(corruptionSlider);
    corruptionRow.appendChild(corruptionSliderContainer);
    
    const corruptionInput = document.createElement('input');
    corruptionInput.type = 'number';
    corruptionInput.min = 0;
    corruptionInput.max = 10;
    corruptionInput.value = data.corruption;
    corruptionInput.className = 'counter-input';
    corruptionInput.addEventListener('change', function() {
        corruptionThumb.style.left = `${(this.value / 10) * 100}%`;
        savePlayers();
    });
    corruptionRow.appendChild(corruptionInput);
    
    playerCard.appendChild(corruptionRow);
    
    // Fear tracking
    const fearRow = createStatusRow('Fear', [
        'None', 'Frightened', 'Horror'
    ], data.fear);
    playerCard.appendChild(fearRow);
    
    // Hope tracking with slider
    const hopeRow = document.createElement('div');
    hopeRow.className = 'status-row';
    
    const hopeLabel = document.createElement('span');
    hopeLabel.className = 'status-label';
    hopeLabel.textContent = 'Hope:';
    hopeRow.appendChild(hopeLabel);
    
    const hopeSliderContainer = document.createElement('div');
    hopeSliderContainer.className = 'slider-container';
    
    const hopeSlider = document.createElement('div');
    hopeSlider.className = 'hope-slider';
    
    const hopeThumb = document.createElement('div');
    hopeThumb.className = 'slider-thumb';
    hopeThumb.style.left = `${(data.hope / 10) * 100}%`;
    
    hopeSlider.appendChild(hopeThumb);
    hopeSliderContainer.appendChild(hopeSlider);
    hopeRow.appendChild(hopeSliderContainer);
    
    const hopeInput = document.createElement('input');
    hopeInput.type = 'number';
    hopeInput.min = 0;
    hopeInput.max = 10;
    hopeInput.value = data.hope;
    hopeInput.className = 'counter-input';
    hopeInput.addEventListener('change', function() {
        hopeThumb.style.left = `${(this.value / 10) * 100}%`;
        savePlayers();
    });
    hopeRow.appendChild(hopeInput);
    
    playerCard.appendChild(hopeRow);
    
    // Divider
    const divider2 = document.createElement('div');
    divider2.className = 'status-divider';
    playerCard.appendChild(divider2);
    
    // Notes section
    const notesSection = document.createElement('div');
    notesSection.className = 'player-notes';
    
    const notesTextarea = document.createElement('textarea');
    notesTextarea.placeholder = 'Player notes, afflictions, physical manifestations, etc...';
    notesTextarea.value = data.notes;
    notesTextarea.addEventListener('change', savePlayers);
    notesSection.appendChild(notesTextarea);
    
    playerCard.appendChild(notesSection);
    
    return playerCard;
}


// Create a status row with label and dropdown
function createStatusRow(label, options, selectedValue = 'None') {
    const row = document.createElement('div');
    row.className = 'status-row';
    
    const labelElement = document.createElement('span');
    labelElement.className = 'status-label';
    labelElement.textContent = label + ':';
    row.appendChild(labelElement);
    
    const select = document.createElement('select');
    select.className = 'status-select';
    
    options.forEach(option => {
        const optElement = document.createElement('option');
        optElement.value = option;
        optElement.textContent = option;
        select.appendChild(optElement);
    });
    
    select.value = selectedValue;
    select.setAttribute('data-value', selectedValue);
    select.addEventListener('change', function() {
        this.setAttribute('data-value', this.value);
        savePlayers();
    });
    
    row.appendChild(select);
    
    return row;
}

// Update day effects based on days count
function updateDayEffects(daysInput) {
    const dayEffect = daysInput.parentElement.querySelector('.madness-note');
    updateDayEffectText(dayEffect, daysInput.value);
}

// Set day effect text based on value
function updateDayEffectText(element, days) {
    const effects = [
        '',
        'Disadvantage on one type of roll',
        'Disadvantage expands to related rolls',
        'Physical symptoms appear',
        'Risk of indefinite madness',
        'Risk of indefinite madness',
        'Risk of indefinite madness',
        'Risk of indefinite madness'
    ];
    
    element.textContent = days > 0 && days <= 7 ? effects[days] : '';
}

// Save players to localStorage
function savePlayers() {
    const playerCards = document.querySelectorAll('.player-card');
    const players = [];
    
    playerCards.forEach(card => {
        const player = {
            name: card.querySelector('.player-name').value,
            ac: card.querySelectorAll('.vital-value')[0].value,
            hp: card.querySelectorAll('.vital-value')[1].value,
            maxHp: card.querySelectorAll('.vital-value')[2].value,
            despair: card.querySelectorAll('.status-select')[0].value,
            despairDays: parseInt(card.querySelectorAll('.counter-input')[0].value) || 0,
            madness: card.querySelectorAll('.status-select')[1].value,
            madnessEffect: card.querySelectorAll('input[type="text"]')[1].value,
            corruption: parseInt(card.querySelectorAll('.counter-input')[1].value) || 0,
            fear: card.querySelectorAll('.status-select')[2].value,
            hope: parseInt(card.querySelectorAll('.counter-input')[2].value) || 0,
            notes: card.querySelector('textarea').value
        };
        
        players.push(player);
    });
    
    localStorage.setItem('dmCheatSheetPlayers', JSON.stringify(players));
}

// Load players from localStorage
function loadPlayers() {
    const savedPlayers = localStorage.getItem('dmCheatSheetPlayers');
    const playerList = document.getElementById('player-list');
    
    playerList.innerHTML = '';
    
    if (savedPlayers) {
        const players = JSON.parse(savedPlayers);
        players.forEach(player => {
            addNewPlayer(player);
        });
    } else {
        addNewPlayer();
    }
}

// ====================== ENHANCED PRINT FUNCTIONALITY ======================
let isPrinting = false;

document.addEventListener('DOMContentLoaded', function() {
    restoreSelections();
    setupPrintButton();
    setupSectionCheckboxes();
    
    // Add print button if it doesn't exist
    if (!document.querySelector('.print-control')) {
        const printBtn = document.createElement('button');
        printBtn.className = 'print-control';
        printBtn.innerHTML = 'üñ®Ô∏è';
        printBtn.title = 'Print Selected Sections';
        printBtn.addEventListener('click', preparePrint);
        document.body.appendChild(printBtn);
    }
    
    // ===== NEW: Add checkboxes to each box =====
    document.querySelectorAll('.box').forEach(box => {
        if (!box.querySelector('.box-checkbox')) {
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'box-checkbox';
            box.prepend(checkbox);
        }
    });
});

function saveSelections() {
    const selectedSections = Array.from(document.querySelectorAll('.section-checkbox:checked'))
        .map(checkbox => checkbox.getAttribute('data-section'));
    localStorage.setItem('printSections', JSON.stringify(selectedSections));
}

function restoreSelections() {
    const selectedSections = JSON.parse(localStorage.getItem('printSections')) || [];
    selectedSections.forEach(sectionId => {
        const checkbox = document.querySelector(`.section-checkbox[data-section="${sectionId}"]`);
        if (checkbox) {
            checkbox.checked = true;
            const sectionTitle = document.getElementById(sectionId);
            if (sectionTitle) {
                sectionTitle.classList.add('print-selected');
            }
        }
    });
}

// ===== UPDATED PRINT FUNCTION =====
function preparePrint() {
    if (isPrinting) return;
    isPrinting = true;

    // Save selections
    saveSelections();
    
    const selectedBoxes = Array.from(document.querySelectorAll('.box-checkbox:checked'));
    const selectedSections = Array.from(document.querySelectorAll('.section-checkbox:checked'));

    if (selectedBoxes.length === 0 && selectedSections.length === 0) {
        alert('Please select at least one section or box to print');
        isPrinting = false;
        return;
    }

    // Create print container
    const printContainer = document.createElement('div');
    printContainer.id = 'print-container';
    printContainer.style.width = '210mm';
    printContainer.style.padding = '15mm';
    printContainer.style.background = 'white';
// Don't hide it off-screen!
    printContainer.style.position = 'static';
    printContainer.style.left = '0';
    document.body.appendChild(printContainer);

    // Process selected boxes first
    if (selectedBoxes.length > 0) {
        selectedBoxes.forEach(checkbox => {
            const box = checkbox.closest('.box');
            const clone = box.cloneNode(true);
            clone.querySelector('.box-checkbox')?.remove();
            printContainer.appendChild(clone);
        });
    } 
    // Fall back to sections if no boxes selected
    else {
        selectedSections.forEach(checkbox => {
            const sectionId = checkbox.getAttribute('data-section');
            const sectionTitle = document.getElementById(sectionId);
            if (sectionTitle) {
                const titleClone = sectionTitle.cloneNode(true);
                titleClone.querySelector('.print-selector')?.remove();
                printContainer.appendChild(titleClone);
                
                const content = sectionTitle.nextElementSibling;
                if (content && content.classList.contains('collapsible-content')) {
                    const contentClone = content.cloneNode(true);
                    contentClone.querySelectorAll('.box-checkbox').forEach(cb => cb.remove());
                    printContainer.appendChild(contentClone);
                }
            }
        });
    }

    const footer = document.createElement('div');
footer.className = 'print-footer';
footer.innerHTML = `
    <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
        <img src="images/qr-code.png" alt="Nat20 Logo" style="height: 40px;">
        <p><h4>Curse of Strahd DM Screen - Courtesy of Nat20 ‚Ä¢ Printed on ${new Date().toLocaleDateString()}</h4></p>
    </div>
`;
printContainer.appendChild(footer);

    // Print with delay
    setTimeout(() => {
        window.print();
        
        // Cleanup
        setTimeout(() => {
            printContainer.remove();
            isPrinting = false;
        }, 1000);
    }, 500);
}

function setupPrintButton() {
    const printBtns = document.querySelectorAll('.print-control, .print-selections-btn');
    printBtns.forEach(btn => {
        btn.addEventListener('click', preparePrint);
    });
}

function setupSectionCheckboxes() {
    document.querySelectorAll('.section-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const sectionId = this.getAttribute('data-section');
            const sectionTitle = document.getElementById(sectionId);
            if (sectionTitle) {
                sectionTitle.classList.toggle('print-selected', this.checked);
            }
            saveSelections();
        });
    });
}

// ====================== PRINT EVENT HANDLERS ======================
window.addEventListener('beforeprint', function() {
    // Ensure only selected sections are visible for printing
    const selectedSections = JSON.parse(localStorage.getItem('printSections')) || [];
    
    document.querySelectorAll('.section-title').forEach(title => {
        title.classList.toggle('print-selected', 
            selectedSections.includes(title.id));
    });
});

window.addEventListener('afterprint', function() {
    // Clean up after printing
    document.querySelectorAll('.section-title').forEach(title => {
        title.classList.remove('print-selected');
    });
});

// ====================== TAB FUNCTIONALITY ======================
function showTab(tabId) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });
    
    // Show selected tab
    const selectedTab = document.getElementById(tabId);
    if (selectedTab) {
        selectedTab.style.display = 'block';
    }
    
    // Update active tab button
    document.querySelectorAll('.tab-buttons .roll-button').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('onclick') === `showTab('${tabId}')`);
    });
}

// Initialize first tab as active
document.addEventListener('DOMContentLoaded', function() {
    showTab('core'); // Default to Core Mechanics tab
});



</script>
